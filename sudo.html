<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruCash | SUDO Super Control Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ===== macOS Theme CSS Reset ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', 
                       'Helvetica Neue', 'Segoe UI', Roboto, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :root {
            --macos-gray-100: #f5f5f7;
            --macos-gray-200: #e5e5e7;
            --macos-gray-300: #d2d2d7;
            --macos-gray-400: #86868b;
            --macos-gray-500: #515154;
            --macos-gray-600: #1d1d1f;
            --macos-blue: #007AFF;
            --macos-blue-light: #409cff;
            --macos-blue-dark: #0056cc;
            --macos-green: #34c759;
            --macos-red: #ff3b30;
            --macos-purple: #5856d6;
            --macos-yellow: #ffcc00;
            --macos-orange: #ff9500;
            --macos-pink: #ff2d55;
            --macos-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --macos-shadow-heavy: 0 8px 24px rgba(0, 0, 0, 0.12);
            --macos-shadow-light: 0 2px 6px rgba(0, 0, 0, 0.04);
            --macos-border-radius: 12px;
            --macos-border-radius-small: 8px;
            --macos-border-radius-large: 16px;
            --macos-transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            --macos-glass: rgba(255, 255, 255, 0.85);
            --macos-glass-border: rgba(255, 255, 255, 0.2);
            --macos-danger-bg: rgba(255, 59, 48, 0.1);
            --macos-warning-bg: rgba(255, 204, 0, 0.1);
            --macos-success-bg: rgba(52, 199, 89, 0.1);
            --macos-info-bg: rgba(0, 122, 255, 0.1);
            --macos-sidebar-width: 280px;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--macos-gray-600);
            min-height: 100vh;
            line-height: 1.4;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(at 10% 20%, rgba(120, 119, 198, 0.03) 0px, transparent 50%),
                radial-gradient(at 90% 10%, rgba(0, 122, 255, 0.03) 0px, transparent 50%),
                radial-gradient(at 50% 90%, rgba(76, 175, 80, 0.03) 0px, transparent 50%);
            z-index: -1;
        }

        /* ===== SUDO Header ===== */
        .sudo-header {
            background: var(--macos-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--macos-glass-border);
            padding: 0 24px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: var(--macos-shadow-light);
        }

        .sudo-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sudo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--macos-red) 0%, var(--macos-orange) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(255, 59, 48, 0.3);
        }

        .sudo-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--macos-gray-600);
            letter-spacing: -0.3px;
        }

        .sudo-subtitle {
            font-size: 11px;
            color: var(--macos-gray-400);
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            margin-left: 8px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .live-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            padding: 6px 12px;
            background: var(--macos-success-bg);
            color: var(--macos-green);
            border-radius: 20px;
            font-weight: 600;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--macos-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--macos-blue) 0%, var(--macos-purple) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        /* ===== Main Layout ===== */
        .sudo-container {
            display: flex;
            min-height: calc(100vh - 60px);
            margin-top: 60px;
        }

        /* ===== Sidebar Navigation ===== */
        .sudo-sidebar {
            width: var(--macos-sidebar-width);
            background: var(--macos-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid var(--macos-glass-border);
            padding: 24px 0;
            position: fixed;
            top: 60px;
            left: 0;
            bottom: 0;
            overflow-y: auto;
            z-index: 900;
        }

        .nav-section {
            margin-bottom: 24px;
            padding: 0 20px;
        }

        .nav-title {
            font-size: 11px;
            color: var(--macos-gray-400);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding-left: 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--macos-gray-500);
            text-decoration: none;
            border-radius: var(--macos-border-radius);
            transition: var(--macos-transition);
            margin-bottom: 4px;
            cursor: pointer;
            user-select: none;
        }

        .nav-item:hover {
            background: rgba(0, 0, 0, 0.03);
            color: var(--macos-gray-600);
        }

        .nav-item.active {
            background: var(--macos-blue);
            color: white;
        }

        .nav-item.active .nav-icon {
            color: white;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--macos-gray-400);
        }

        .nav-text {
            font-size: 13px;
            font-weight: 500;
            flex: 1;
        }

        .nav-badge {
            background: var(--macos-red);
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            font-weight: 600;
        }

        /* ===== Main Content ===== */
        .sudo-main {
            flex: 1;
            margin-left: var(--macos-sidebar-width);
            padding: 24px;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--macos-gray-600);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .section-subtitle {
            font-size: 13px;
            color: var(--macos-gray-400);
        }

        /* ===== Stats Grid ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--macos-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--macos-glass-border);
            border-radius: var(--macos-border-radius);
            padding: 20px;
            transition: var(--macos-transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--macos-shadow);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .stat-icon.users { background: var(--macos-info-bg); color: var(--macos-blue); }
        .stat-icon.agents { background: var(--macos-success-bg); color: var(--macos-green); }
        .stat-icon.transactions { background: var(--macos-warning-bg); color: var(--macos-yellow); }
        .stat-icon.revenue { background: var(--macos-danger-bg); color: var(--macos-red); }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--macos-gray-600);
            line-height: 1;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--macos-gray-400);
            font-weight: 500;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .stat-change.positive {
            color: var(--macos-green);
        }

        .stat-change.negative {
            color: var(--macos-red);
        }

        /* ===== Cards Grid ===== */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--macos-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--macos-glass-border);
            border-radius: var(--macos-border-radius-large);
            overflow: hidden;
            transition: var(--macos-transition);
        }

        .card:hover {
            box-shadow: var(--macos-shadow);
            transform: translateY(-2px);
        }

        .card-header {
            padding: 20px;
            border-bottom: 1px solid var(--macos-gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--macos-gray-600);
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .card-body {
            padding: 20px;
        }

        /* ===== Form Elements ===== */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--macos-gray-500);
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 14px;
            font-size: 14px;
            border: 1px solid var(--macos-gray-200);
            border-radius: var(--macos-border-radius-small);
            background: rgba(255, 255, 255, 0.9);
            transition: var(--macos-transition);
            color: var(--macos-gray-600);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--macos-blue);
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15);
        }

        .form-control::placeholder {
            color: var(--macos-gray-400);
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2386868b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* ===== Tables ===== */
        .table-container {
            background: var(--macos-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--macos-glass-border);
            border-radius: var(--macos-border-radius);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: rgba(0, 0, 0, 0.02);
            padding: 12px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: var(--macos-gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--macos-gray-200);
        }

        .table td {
            padding: 16px;
            font-size: 13px;
            color: var(--macos-gray-600);
            border-bottom: 1px solid var(--macos-gray-200);
        }

        .table tbody tr:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 20px;
        }

        .status-active { background: var(--macos-success-bg); color: var(--macos-green); }
        .status-inactive { background: var(--macos-gray-200); color: var(--macos-gray-500); }
        .status-suspended { background: var(--macos-warning-bg); color: var(--macos-yellow); }
        .status-banned { background: var(--macos-danger-bg); color: var(--macos-red); }
        .status-pending { background: rgba(0, 122, 255, 0.1); color: var(--macos-blue); }

        .role-badge {
            display: inline-block;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 20px;
            background: var(--macos-info-bg);
            color: var(--macos-blue);
        }

        /* ===== Buttons ===== */
        .btn {
            padding: 10px 18px;
            border-radius: var(--macos-border-radius-small);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--macos-transition);
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--macos-blue) 0%, var(--macos-blue-light) 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.25);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--macos-blue-dark) 0%, var(--macos-blue) 100%);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.35);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--macos-red) 0%, #ff5a5a 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(255, 59, 48, 0.25);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #cc2e25 0%, var(--macos-red) 100%);
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.35);
            transform: translateY(-1px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--macos-green) 0%, #2db867 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(52, 199, 89, 0.25);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #27ae60 0%, var(--macos-green) 100%);
            box-shadow: 0 4px 12px rgba(52, 199, 89, 0.35);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border: 1.5px solid var(--macos-gray-300);
            color: var(--macos-gray-600);
        }

        .btn-outline:hover {
            background: rgba(0, 0, 0, 0.03);
            border-color: var(--macos-gray-400);
            transform: translateY(-1px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            padding: 0;
            justify-content: center;
            border-radius: 50%;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        /* ===== Toggle Switches ===== */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--macos-gray-300);
            transition: var(--macos-transition);
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--macos-transition);
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--macos-green);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* ===== Charts ===== */
        .chart-container {
            background: var(--macos-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--macos-glass-border);
            border-radius: var(--macos-border-radius);
            padding: 20px;
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--macos-gray-600);
            margin-bottom: 16px;
        }

        /* ===== Modals ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            display: flex;
            opacity: 1;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--macos-glass);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-radius: var(--macos-border-radius-large);
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--macos-shadow-heavy);
            border: 1px solid var(--macos-glass-border);
            animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideUp {
            from { opacity: 0; transform: translateY(100px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--macos-glass);
            backdrop-filter: blur(40px);
            z-index: 10;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--macos-gray-600);
        }

        .modal-close {
            background: rgba(0, 0, 0, 0.05);
            border: none;
            font-size: 16px;
            color: var(--macos-gray-500);
            cursor: pointer;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--macos-transition);
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 20px 24px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* ===== Loading Overlay ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            flex-direction: column;
            gap: 16px;
        }

        .loading-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--macos-gray-200);
            border-top-color: var(--macos-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 14px;
            color: var(--macos-gray-600);
            font-weight: 500;
        }

        /* ===== Notifications ===== */
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: 16px 20px;
            border-radius: var(--macos-border-radius);
            background: var(--macos-glass);
            backdrop-filter: blur(40px);
            box-shadow: var(--macos-shadow-heavy);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1500;
            transform: translateX(calc(100% + 24px));
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 320px;
            border: 1px solid var(--macos-glass-border);
        }

        .notification.active {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--macos-green);
        }

        .notification.error {
            border-left: 4px solid var(--macos-red);
        }

        .notification.info {
            border-left: 4px solid var(--macos-blue);
        }

        .notification.warning {
            border-left: 4px solid var(--macos-yellow);
        }

        .notification-icon {
            font-size: 20px;
        }

        .notification.success .notification-icon {
            color: var(--macos-green);
        }

        .notification.error .notification-icon {
            color: var(--macos-red);
        }

        .notification.info .notification-icon {
            color: var(--macos-blue);
        }

        .notification.warning .notification-icon {
            color: var(--macos-yellow);
        }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-title {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 2px;
            color: var(--macos-gray-600);
        }

        .notification-message {
            font-size: 12px;
            color: var(--macos-gray-500);
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--macos-gray-400);
            cursor: pointer;
            font-size: 16px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: var(--macos-transition);
        }

        .notification-close:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--macos-gray-600);
        }

        /* ===== Code Editor ===== */
        .code-editor {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            border-radius: var(--macos-border-radius);
            overflow: hidden;
            margin-bottom: 16px;
        }

        .code-header {
            background: #252526;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #3e3e42;
        }

        .code-language {
            font-size: 11px;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
        }

        .code-body {
            padding: 16px;
            font-size: 13px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
        }

        .code-body pre {
            margin: 0;
        }

        /* ===== Alert Boxes ===== */
        .alert {
            padding: 16px;
            border-radius: var(--macos-border-radius);
            margin-bottom: 16px;
            border-left: 4px solid;
        }

        .alert-danger {
            background: var(--macos-danger-bg);
            border-left-color: var(--macos-red);
            color: var(--macos-red);
        }

        .alert-warning {
            background: var(--macos-warning-bg);
            border-left-color: var(--macos-yellow);
            color: var(--macos-yellow);
        }

        .alert-success {
            background: var(--macos-success-bg);
            border-left-color: var(--macos-green);
            color: var(--macos-green);
        }

        .alert-info {
            background: var(--macos-info-bg);
            border-left-color: var(--macos-blue);
            color: var(--macos-blue);
        }

        /* ===== Responsive Design ===== */
        @media (max-width: 1200px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sudo-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sudo-sidebar.active {
                transform: translateX(0);
            }

            .sudo-main {
                margin-left: 0;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .sudo-header {
                padding: 0 16px;
            }

            .sudo-main {
                padding: 16px;
            }

            .card-header, .card-body {
                padding: 16px;
            }

            .action-buttons {
                flex-wrap: wrap;
            }
        }

        /* ===== Utility Classes ===== */
        .d-none { display: none !important; }
        .d-flex { display: flex !important; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-end { justify-content: flex-end; }
        .flex-wrap { flex-wrap: wrap; }
        .gap-8 { gap: 8px; }
        .gap-12 { gap: 12px; }
        .gap-16 { gap: 16px; }
        .w-100 { width: 100%; }
        .mt-16 { margin-top: 16px; }
        .mb-16 { margin-bottom: 16px; }
        .mb-24 { margin-bottom: 24px; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-muted { color: var(--macos-gray-400); }
        .text-success { color: var(--macos-green); }
        .text-danger { color: var(--macos-red); }
        .text-warning { color: var(--macos-yellow); }
        .text-info { color: var(--macos-blue); }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }

        /* ===== Custom Scrollbar ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--macos-gray-100);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--macos-gray-300);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--macos-gray-400);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Loading SUDO Control Panel...</div>
    </div>

    <!-- SUDO Header -->
    <header class="sudo-header">
        <div class="sudo-logo">
            <div class="sudo-icon">SU</div>
            <div>
                <div class="sudo-title">TruCash SUDO</div>
                <div class="sudo-subtitle">Super Control Admin</div>
            </div>
        </div>
        <div class="header-actions">
            <div class="live-status">
                <div class="live-dot"></div>
                <span>LIVE</span>
            </div>
            <div class="user-info">
                <div class="user-avatar">SU</div>
                <div>
                    <div style="font-size: 13px; font-weight: 600;">SUDO Admin</div>
                    <div style="font-size: 11px; color: var(--macos-gray-400);">Full System Control</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="sudo-container">
        <!-- Sidebar Navigation -->
        <nav class="sudo-sidebar">
            <div class="nav-section">
                <div class="nav-title">Dashboard</div>
                <div class="nav-item active" data-section="dashboard">
                    <div class="nav-icon"><i class="fas fa-tachometer-alt"></i></div>
                    <div class="nav-text">Overview</div>
                </div>
                <div class="nav-item" data-section="analytics">
                    <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="nav-text">Analytics</div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">User Management</div>
                <div class="nav-item" data-section="admins">
                    <div class="nav-icon"><i class="fas fa-user-shield"></i></div>
                    <div class="nav-text">Admin Accounts</div>
                </div>
                <div class="nav-item" data-section="agents">
                    <div class="nav-icon"><i class="fas fa-id-badge"></i></div>
                    <div class="nav-text">Agent Accounts</div>
                </div>
                <div class="nav-item" data-section="customers">
                    <div class="nav-icon"><i class="fas fa-users"></i></div>
                    <div class="nav-text">Customer Accounts</div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">System Control</div>
                <div class="nav-item" data-section="features">
                    <div class="nav-icon"><i class="fas fa-toggle-on"></i></div>
                    <div class="nav-text">Feature Flags</div>
                </div>
                <div class="nav-item" data-section="financial">
                    <div class="nav-icon"><i class="fas fa-money-bill-wave"></i></div>
                    <div class="nav-text">Financial Settings</div>
                </div>
                <div class="nav-item" data-section="repayment">
                    <div class="nav-icon"><i class="fas fa-calendar-check"></i></div>
                    <div class="nav-text">Repayment Plans</div>
                </div>
                <div class="nav-item" data-section="notifications">
                    <div class="nav-icon"><i class="fas fa-bell"></i></div>
                    <div class="nav-text">Notifications</div>
                </div>
                <div class="nav-item" data-section="ui-settings">
                    <div class="nav-icon"><i class="fas fa-sliders-h"></i></div>
                    <div class="nav-text">UI Behavior</div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Security & Monitoring</div>
                <div class="nav-item" data-section="security">
                    <div class="nav-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="nav-text">Security Settings</div>
                </div>
                <div class="nav-item" data-section="audit">
                    <div class="nav-icon"><i class="fas fa-history"></i></div>
                    <div class="nav-text">Audit Logs</div>
                    <div class="nav-badge" id="auditBadge">0</div>
                </div>
                <div class="nav-item" data-section="backup">
                    <div class="nav-icon"><i class="fas fa-database"></i></div>
                    <div class="nav-text">Backup & Export</div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Manual Intervention</div>
                <div class="nav-item" data-section="manual">
                    <div class="nav-icon"><i class="fas fa-hands-helping"></i></div>
                    <div class="nav-text">Manual Adjustments</div>
                </div>
                <div class="nav-item" data-section="disputes">
                    <div class="nav-icon"><i class="fas fa-gavel"></i></div>
                    <div class="nav-text">Dispute Resolution</div>
                    <div class="nav-badge" id="disputeBadge">0</div>
                </div>
            </div>

            <div class="nav-section" style="margin-top: auto;">
                <div class="nav-item" data-action="logout">
                    <div class="nav-icon"><i class="fas fa-sign-out-alt"></i></div>
                    <div class="nav-text">Logout</div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="sudo-main">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="section-header">
                    <h1 class="section-title">System Overview</h1>
                    <div class="section-subtitle">Real-time monitoring of the entire TruCash platform</div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Total Users</div>
                                <div class="stat-value" id="totalUsers">0</div>
                            </div>
                            <div class="stat-icon users"><i class="fas fa-users"></i></div>
                        </div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="userGrowth">0%</span> this week
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Active Agents</div>
                                <div class="stat-value" id="activeAgents">0</div>
                            </div>
                            <div class="stat-icon agents"><i class="fas fa-id-badge"></i></div>
                        </div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="agentGrowth">0%</span> this week
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Transactions Today</div>
                                <div class="stat-value" id="todayTransactions">0</div>
                            </div>
                            <div class="stat-icon transactions"><i class="fas fa-exchange-alt"></i></div>
                        </div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="transactionGrowth">0%</span> vs yesterday
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Platform Revenue</div>
                                <div class="stat-value" id="platformRevenue">$0</div>
                            </div>
                            <div class="stat-icon revenue"><i class="fas fa-money-bill-wave"></i></div>
                        </div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="revenueGrowth">0%</span> this month
                        </div>
                    </div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">System Health</div>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-outline" onclick="refreshSystemHealth()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Database Connection</label>
                                <div class="d-flex align-center justify-between">
                                    <span>Firebase Realtime Database</span>
                                    <span class="status-badge status-active" id="dbStatus">Connected</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Authentication Service</label>
                                <div class="d-flex align-center justify-between">
                                    <span>Firebase Auth</span>
                                    <span class="status-badge status-active" id="authStatus">Online</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Active Sessions</label>
                                <div class="d-flex align-center justify-between">
                                    <span>Current Active Users</span>
                                    <span class="font-semibold" id="activeSessions">0</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">System Load</label>
                                <div class="d-flex align-center justify-between">
                                    <span>API Response Time</span>
                                    <span class="font-semibold" id="apiResponseTime">0ms</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Quick Actions</div>
                        </div>
                        <div class="card-body">
                            <div class="d-flex flex-wrap gap-8 mb-16">
                                <button class="btn btn-primary" onclick="openCreateAdminModal()">
                                    <i class="fas fa-user-plus"></i> Create Admin
                                </button>
                                <button class="btn btn-success" onclick="openCreateAgentModal()">
                                    <i class="fas fa-id-card"></i> Create Agent
                                </button>
                                <button class="btn btn-outline" onclick="openManualAdjustmentModal()">
                                    <i class="fas fa-edit"></i> Manual Adjustment
                                </button>
                            </div>
                            <div class="d-flex flex-wrap gap-8">
                                <button class="btn btn-outline" onclick="openFeatureFlagModal()">
                                    <i class="fas fa-toggle-on"></i> Feature Flags
                                </button>
                                <button class="btn btn-outline" onclick="viewAuditLogs()">
                                    <i class="fas fa-history"></i> View Audit Logs
                                </button>
                                <button class="btn btn-outline" onclick="openBackupModal()">
                                    <i class="fas fa-download"></i> Export Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Real-time System Activity</div>
                    <canvas id="activityChart"></canvas>
                </div>
            </section>

            <!-- Admin Management Section -->
            <section id="admins" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Admin Accounts Management</h1>
                    <div class="section-subtitle">Create, edit, suspend, and delete admin accounts</div>
                </div>

                <div class="d-flex justify-between align-center mb-24">
                    <div>
                        <button class="btn btn-primary" onclick="openCreateAdminModal()">
                            <i class="fas fa-user-plus"></i> Create New Admin
                        </button>
                    </div>
                    <div class="d-flex gap-8">
                        <input type="text" class="form-control" style="width: 300px;" placeholder="Search admins..." id="adminSearch">
                        <button class="btn btn-outline" onclick="refreshAdminList()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="table" id="adminsTable">
                        <thead>
                            <tr>
                                <th>Admin ID</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Last Login</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminsTableBody">
                            <!-- Admin rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Agent Management Section -->
            <section id="agents" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Agent Accounts Management</h1>
                    <div class="section-subtitle">Manage all agent accounts and their permissions</div>
                </div>

                <div class="d-flex justify-between align-center mb-24">
                    <div class="d-flex gap-8">
                        <button class="btn btn-primary" onclick="openCreateAgentModal()">
                            <i class="fas fa-user-plus"></i> Create Agent
                        </button>
                        <button class="btn btn-outline" onclick="openBulkAgentActions()">
                            <i class="fas fa-users-cog"></i> Bulk Actions
                        </button>
                    </div>
                    <div class="d-flex gap-8">
                        <select class="form-control" style="width: 200px;" id="agentStatusFilter">
                            <option value="all">All Status</option>
                            <option value="active">Active</option>
                            <option value="suspended">Suspended</option>
                            <option value="inactive">Inactive</option>
                        </select>
                        <input type="text" class="form-control" style="width: 250px;" placeholder="Search agents..." id="agentSearch">
                    </div>
                </div>

                <div class="table-container">
                    <table class="table" id="agentsTable">
                        <thead>
                            <tr>
                                <th>Agent ID</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Total Clients</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="agentsTableBody">
                            <!-- Agent rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Customer Management Section -->
            <section id="customers" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Customer Accounts Management</h1>
                    <div class="section-subtitle">Manage customer access controls and permissions</div>
                </div>

                <div class="cards-grid mb-24">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex align-center justify-between mb-16">
                                <div>
                                    <div class="font-semibold">Transaction Limits</div>
                                    <div class="text-muted" style="font-size: 12px;">Configure customer transaction caps</div>
                                </div>
                                <button class="btn btn-sm btn-outline" onclick="configureTransactionLimits()">
                                    <i class="fas fa-cog"></i> Configure
                                </button>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Maximum Daily Limit</label>
                                <input type="number" class="form-control" id="dailyLimit" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Maximum Single Transaction</label>
                                <input type="number" class="form-control" id="singleTransactionLimit" placeholder="Enter amount">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex align-center justify-between mb-16">
                                <div>
                                    <div class="font-semibold">Account Verification</div>
                                    <div class="text-muted" style="font-size: 12px;">Set verification requirements</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="autoVerification" checked>
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Required Documents</label>
                                <select class="form-control" id="requiredDocs" multiple style="height: 120px;">
                                    <option value="nrc" selected>National ID (NRC)</option>
                                    <option value="passport" selected>Passport</option>
                                    <option value="drivers_license">Driver's License</option>
                                    <option value="proof_of_address">Proof of Address</option>
                                    <option value="employment_letter">Employment Letter</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <table class="table" id="customersTable">
                        <thead>
                            <tr>
                                <th>Customer ID</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Verification</th>
                                <th>Status</th>
                                <th>Loan Limit</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customersTableBody">
                            <!-- Customer rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Feature Flags Section -->
            <section id="features" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Feature Flags & Module Control</h1>
                    <div class="section-subtitle">Enable or disable features across the platform in real-time</div>
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Changes to feature flags are applied immediately across all interfaces without requiring redeployment.
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Customer Features</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Loan Applications</div>
                                    <div class="text-muted" style="font-size: 12px;">Allow customers to apply for loans</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="feature_loan_applications" checked data-feature="loan_applications">
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Online Repayments</div>
                                    <div class="text-muted" style="font-size: 12px;">Enable online loan repayments</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="feature_online_repayments" checked data-feature="online_repayments">
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Collateral Upload</div>
                                    <div class="text-muted" style="font-size: 12px;">Allow collateral document upload</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="feature_collateral_upload" checked data-feature="collateral_upload">
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Agent Features</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Client Verification</div>
                                    <div class="text-muted" style="font-size: 12px;">Allow agents to verify clients</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="feature_client_verification" checked data-feature="client_verification">
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Loan Processing</div>
                                    <div class="text-muted" style="font-size: 12px;">Enable loan processing by agents</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="feature_loan_processing" checked data-feature="loan_processing">
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Commission Tracking</div>
                                    <div class="text-muted" style="font-size: 12px;">Show commission calculations</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="feature_commission_tracking" checked data-feature="commission_tracking">
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">System Features</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Maintenance Mode</div>
                                    <div class="text-muted" style="font-size: 12px;">Put system under maintenance</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="feature_maintenance_mode" data-feature="maintenance_mode">
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">New User Registration</div>
                                    <div class="text-muted" style="font-size: 12px;">Allow new user registrations</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="feature_new_registrations" checked data-feature="new_registrations">
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Audit Logging</div>
                                    <div class="text-muted" style="font-size: 12px;">Enable system audit logs</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="feature_audit_logging" checked data-feature="audit_logging">
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-16">
                    <div class="card-header">
                        <div class="card-title">Feature Configuration Details</div>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Feature JSON Configuration</label>
                            <div class="code-editor">
                                <div class="code-header">
                                    <div class="code-language">JSON</div>
                                    <button class="btn btn-sm btn-outline" onclick="updateFeatureFlags()">
                                        <i class="fas fa-save"></i> Save Configuration
                                    </button>
                                </div>
                                <div class="code-body">
                                    <pre id="featureJsonEditor">{
  "customer_features": {
    "loan_applications": true,
    "online_repayments": true,
    "collateral_upload": true
  },
  "agent_features": {
    "client_verification": true,
    "loan_processing": true,
    "commission_tracking": true
  },
  "system_features": {
    "maintenance_mode": false,
    "new_registrations": true,
    "audit_logging": true
  }
}</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Financial Settings Section -->
            <section id="financial" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Financial System Configuration</h1>
                    <div class="section-subtitle">Control all financial parameters and transaction rules</div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Transaction Limits</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Minimum Loan Amount</label>
                                <input type="number" class="form-control" id="minLoanAmount" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Maximum Loan Amount</label>
                                <input type="number" class="form-control" id="maxLoanAmount" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Daily Transaction Limit</label>
                                <input type="number" class="form-control" id="dailyTransactionLimit" placeholder="Enter amount">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Fees & Commissions</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Service Charge (%)</label>
                                <input type="number" class="form-control" id="serviceCharge" placeholder="Enter percentage" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Agent Commission (%)</label>
                                <input type="number" class="form-control" id="agentCommission" placeholder="Enter percentage" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Late Payment Fee (%)</label>
                                <input type="number" class="form-control" id="latePaymentFee" placeholder="Enter percentage" step="0.01">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Approval Thresholds</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Auto-approval Limit</label>
                                <input type="number" class="form-control" id="autoApprovalLimit" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Manual Review Threshold</label>
                                <input type="number" class="form-control" id="manualReviewThreshold" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Risk Threshold (%)</label>
                                <input type="number" class="form-control" id="riskThreshold" placeholder="Enter percentage" step="0.01">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-16">
                    <div class="card-header">
                        <div class="card-title">Currency & Formatting</div>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Default Currency</label>
                                <select class="form-control" id="defaultCurrency">
                                    <option value="USD">USD ($)</option>
                                    <option value="ZMW">ZMW (K)</option>
                                    <option value="EUR">EUR ()</option>
                                    <option value="GBP">GBP ()</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Decimal Places</label>
                                <select class="form-control" id="decimalPlaces">
                                    <option value="0">0 (e.g., 100)</option>
                                    <option value="2" selected>2 (e.g., 100.00)</option>
                                    <option value="3">3 (e.g., 100.000)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Currency Format</label>
                            <select class="form-control" id="currencyFormat">
                                <option value="symbol_before">Symbol before ($100)</option>
                                <option value="symbol_after">Symbol after (100$)</option>
                                <option value="code_before">Code before (USD 100)</option>
                                <option value="code_after">Code after (100 USD)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="text-right mt-16">
                    <button class="btn btn-primary" onclick="saveFinancialSettings()">
                        <i class="fas fa-save"></i> Save All Financial Settings
                    </button>
                </div>
            </section>

            <!-- Repayment Plans Section -->
            <section id="repayment" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Repayment Plans & Penalty Systems</h1>
                    <div class="section-subtitle">Define repayment timelines, installment structures, and penalty rules</div>
                </div>

                <div class="d-flex justify-between align-center mb-24">
                    <div>
                        <button class="btn btn-primary" onclick="openCreateRepaymentPlanModal()">
                            <i class="fas fa-plus-circle"></i> Create New Plan
                        </button>
                    </div>
                </div>

                <div class="cards-grid mb-24">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Penalty Configuration</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Late Payment Penalty (%)</label>
                                <input type="number" class="form-control" id="latePenaltyRate" placeholder="Enter percentage" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Grace Period (Days)</label>
                                <input type="number" class="form-control" id="gracePeriodDays" placeholder="Enter days">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Default Interest Rate (%)</label>
                                <input type="number" class="form-control" id="defaultInterestRate" placeholder="Enter percentage" step="0.01">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Escalation Rules</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Days to Auto-Restriction</label>
                                <input type="number" class="form-control" id="autoRestrictionDays" placeholder="Enter days">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Escalation Threshold (%)</label>
                                <input type="number" class="form-control" id="escalationThreshold" placeholder="Enter percentage" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Collection Agency Trigger</label>
                                <input type="number" class="form-control" id="collectionTriggerDays" placeholder="Enter days">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <table class="table" id="repaymentPlansTable">
                        <thead>
                            <tr>
                                <th>Plan ID</th>
                                <th>Plan Name</th>
                                <th>Duration</th>
                                <th>Interest Rate</th>
                                <th>Installments</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="repaymentPlansBody">
                            <!-- Repayment plan rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Notifications Section -->
            <section id="notifications" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Notification System Configuration</h1>
                    <div class="section-subtitle">Configure automated notifications and alerts</div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Payment Reminders</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Enable Payment Reminders</div>
                                    <div class="text-muted" style="font-size: 12px;">Send automatic payment reminders</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_payment_reminders" checked>
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Days Before Due Date</label>
                                <input type="number" class="form-control" id="reminderDaysBefore" placeholder="Enter days">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Reminder Frequency</label>
                                <select class="form-control" id="reminderFrequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="biweekly">Bi-weekly</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Overdue Alerts</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Enable Overdue Alerts</div>
                                    <div class="text-muted" style="font-size: 12px;">Send alerts for overdue payments</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_overdue_alerts" checked>
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Alert After (Days)</label>
                                <input type="number" class="form-control" id="overdueAlertDays" placeholder="Enter days">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Maximum Alerts</label>
                                <input type="number" class="form-control" id="maxOverdueAlerts" placeholder="Enter number">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Security Notifications</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Login Alerts</div>
                                    <div class="text-muted" style="font-size: 12px;">Notify on new device login</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_login_alerts" checked>
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Account Changes</div>
                                    <div class="text-muted" style="font-size: 12px;">Notify on account modifications</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_account_changes" checked>
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Security Warnings</div>
                                    <div class="text-muted" style="font-size: 12px;">Send security warnings</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_security_warnings" checked>
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-16">
                    <div class="card-header">
                        <div class="card-title">Notification Templates</div>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Payment Reminder Template</label>
                            <textarea class="form-control form-textarea" id="paymentReminderTemplate" rows="4">Dear {customer_name}, your payment of {amount} is due on {due_date}. Please make payment to avoid penalties.</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Overdue Alert Template</label>
                            <textarea class="form-control form-textarea" id="overdueAlertTemplate" rows="4">URGENT: Your payment of {amount} is overdue by {days_overdue} days. Please make immediate payment to avoid account restrictions.</textarea>
                        </div>
                        <div class="text-right">
                            <button class="btn btn-primary" onclick="saveNotificationSettings()">
                                <i class="fas fa-save"></i> Save Notification Settings
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- UI Behavior Section -->
            <section id="ui-settings" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">UI Behavior & Layout Configuration</h1>
                    <div class="section-subtitle">Control dashboard layouts, visible modules, and interface behavior</div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Dashboard Layouts</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Customer Dashboard</label>
                                <select class="form-control" id="customerDashboardLayout">
                                    <option value="standard">Standard Layout</option>
                                    <option value="compact">Compact Layout</option>
                                    <option value="detailed">Detailed Layout</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Agent Dashboard</label>
                                <select class="form-control" id="agentDashboardLayout">
                                    <option value="standard">Standard Layout</option>
                                    <option value="analytics">Analytics Focus</option>
                                    <option value="client_management">Client Management Focus</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Admin Dashboard</label>
                                <select class="form-control" id="adminDashboardLayout">
                                    <option value="standard">Standard Layout</option>
                                    <option value="monitoring">Monitoring Focus</option>
                                    <option value="approval">Approval Focus</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Visible Modules</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Customer Modules</label>
                                <select class="form-control" id="customerModules" multiple style="height: 150px;">
                                    <option value="loans" selected>Loans</option>
                                    <option value="repayments" selected>Repayments</option>
                                    <option value="transactions" selected>Transactions</option>
                                    <option value="collateral" selected>Collateral</option>
                                    <option value="profile" selected>Profile</option>
                                    <option value="notifications" selected>Notifications</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">UI Behavior</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Auto-refresh Data</div>
                                    <div class="text-muted" style="font-size: 12px;">Auto-refresh dashboard data</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="ui_auto_refresh" checked>
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Show Tutorials</div>
                                    <div class="text-muted" style="font-size: 12px;">Show onboarding tutorials</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="ui_show_tutorials" checked>
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Animations</div>
                                    <div class="text-muted" style="font-size: 12px;">Enable UI animations</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="ui_animations" checked>
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-right mt-16">
                    <button class="btn btn-primary" onclick="saveUISettings()">
                        <i class="fas fa-save"></i> Save UI Configuration
                    </button>
                </div>
            </section>

            <!-- Security Settings Section -->
            <section id="security" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Security System Configuration</h1>
                    <div class="section-subtitle">Configure security parameters and access controls</div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Session Management</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Session Timeout (Minutes)</label>
                                <input type="number" class="form-control" id="sessionTimeout" placeholder="Enter minutes">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Max Concurrent Sessions</label>
                                <input type="number" class="form-control" id="maxConcurrentSessions" placeholder="Enter number">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Force Logout on Inactivity</label>
                                <select class="form-control" id="forceLogout">
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Login Security</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Max Login Attempts</label>
                                <input type="number" class="form-control" id="maxLoginAttempts" placeholder="Enter number">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Account Lockout Duration (Minutes)</label>
                                <input type="number" class="form-control" id="lockoutDuration" placeholder="Enter minutes">
                            </div>
                            <div class="form-group">
                                <label class="form-label">IP Lockout Threshold</label>
                                <input type="number" class="form-control" id="ipLockoutThreshold" placeholder="Enter number">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Password Policies</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Minimum Password Length</label>
                                <input type="number" class="form-control" id="minPasswordLength" placeholder="Enter length">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Password Expiry (Days)</label>
                                <input type="number" class="form-control" id="passwordExpiryDays" placeholder="Enter days">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Password History</label>
                                <input type="number" class="form-control" id="passwordHistoryCount" placeholder="Enter number">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-16">
                    <div class="card-header">
                        <div class="card-title">Advanced Security</div>
                    </div>
                    <div class="card-body">
                        <div class="form-group d-flex align-center justify-between">
                            <div>
                                <div class="font-semibold">Two-Factor Authentication</div>
                                <div class="text-muted" style="font-size: 12px;">Require 2FA for admin access</div>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="security_2fa">
                                <label class="toggle-slider"></label>
                            </div>
                        </div>
                        <div class="form-group d-flex align-center justify-between">
                            <div>
                                <div class="font-semibold">IP Whitelisting</div>
                                <div class="text-muted" style="font-size: 12px;">Restrict access to specific IPs</div>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="security_ip_whitelist">
                                <label class="toggle-slider"></label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Allowed IP Addresses (Comma-separated)</label>
                            <textarea class="form-control form-textarea" id="allowedIPs" rows="3" placeholder="192.168.1.1, 10.0.0.1"></textarea>
                        </div>
                    </div>
                </div>

                <div class="text-right mt-16">
                    <button class="btn btn-primary" onclick="saveSecuritySettings()">
                        <i class="fas fa-save"></i> Save Security Settings
                    </button>
                </div>
            </section>

            <!-- Audit Logs Section -->
            <section id="audit" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">System Audit Logs</h1>
                    <div class="section-subtitle">Complete audit trail of all system activities</div>
                </div>

                <div class="d-flex justify-between align-center mb-24">
                    <div class="d-flex gap-8">
                        <select class="form-control" style="width: 200px;" id="auditUserType">
                            <option value="all">All Users</option>
                            <option value="admin">Admins</option>
                            <option value="agent">Agents</option>
                            <option value="customer">Customers</option>
                            <option value="system">System</option>
                        </select>
                        <select class="form-control" style="width: 200px;" id="auditActionType">
                            <option value="all">All Actions</option>
                            <option value="login">Logins</option>
                            <option value="create">Creations</option>
                            <option value="update">Updates</option>
                            <option value="delete">Deletions</option>
                            <option value="financial">Financial</option>
                            <option value="security">Security</option>
                        </select>
                        <input type="date" class="form-control" style="width: 150px;" id="auditDateFrom">
                        <input type="date" class="form-control" style="width: 150px;" id="auditDateTo">
                    </div>
                    <div class="d-flex gap-8">
                        <button class="btn btn-outline" onclick="exportAuditLogs()">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="btn btn-primary" onclick="refreshAuditLogs()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="table" id="auditLogsTable">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>User Type</th>
                                <th>User ID</th>
                                <th>Action</th>
                                <th>Details</th>
                                <th>IP Address</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="auditLogsBody">
                            <!-- Audit log rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Backup & Export Section -->
            <section id="backup" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Backup & Data Export</h1>
                    <div class="section-subtitle">Manage data backups, exports, and archival rules</div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Backup Configuration</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Auto Backup Frequency</label>
                                <select class="form-control" id="backupFrequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Retention Period (Days)</label>
                                <input type="number" class="form-control" id="retentionPeriod" placeholder="Enter days">
                            </div>
                            <div class="form-group d-flex align-center justify-between">
                                <div>
                                    <div class="font-semibold">Enable Auto Backup</div>
                                    <div class="text-muted" style="font-size: 12px;">Automatic database backups</div>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="backup_auto_enable" checked>
                                    <label class="toggle-slider"></label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Manual Backup</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Select Data to Backup</label>
                                <select class="form-control" id="backupDataType" multiple style="height: 120px;">
                                    <option value="users" selected>User Data</option>
                                    <option value="transactions" selected>Transactions</option>
                                    <option value="loans" selected>Loans</option>
                                    <option value="audit_logs" selected>Audit Logs</option>
                                    <option value="system_settings">System Settings</option>
                                    <option value="financial_data">Financial Data</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Backup Format</label>
                                <select class="form-control" id="backupFormat">
                                    <option value="json">JSON</option>
                                    <option value="csv">CSV</option>
                                    <option value="excel">Excel</option>
                                </select>
                            </div>
                            <button class="btn btn-primary w-100" onclick="createManualBackup()">
                                <i class="fas fa-database"></i> Create Backup Now
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Data Export</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Export Type</label>
                                <select class="form-control" id="exportType">
                                    <option value="all_data">All Data</option>
                                    <option value="user_data">User Data</option>
                                    <option value="transaction_data">Transaction Data</option>
                                    <option value="financial_reports">Financial Reports</option>
                                    <option value="audit_trail">Audit Trail</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date Range</label>
                                <div class="form-row">
                                    <input type="date" class="form-control" id="exportDateFrom" placeholder="From">
                                    <input type="date" class="form-control" id="exportDateTo" placeholder="To">
                                </div>
                            </div>
                            <button class="btn btn-success w-100" onclick="exportData()">
                                <i class="fas fa-file-export"></i> Export Data
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card mt-16">
                    <div class="card-header">
                        <div class="card-title">Backup History</div>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Backup ID</th>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Size</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="backupHistoryBody">
                                <!-- Backup history will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Manual Intervention Section -->
            <section id="manual" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Manual System Intervention</h1>
                    <div class="section-subtitle">Direct intervention tools for account and transaction management</div>
                </div>

                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i> Warning: Manual interventions are logged and require proper authorization. Use with extreme caution.
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Account Balance Adjustment</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">User Type</label>
                                <select class="form-control" id="adjustmentUserType">
                                    <option value="customer">Customer</option>
                                    <option value="agent">Agent</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">User ID/Email</label>
                                <input type="text" class="form-control" id="adjustmentUserId" placeholder="Enter user ID or email">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Adjustment Type</label>
                                <select class="form-control" id="adjustmentType">
                                    <option value="add">Add Funds</option>
                                    <option value="deduct">Deduct Funds</option>
                                    <option value="set">Set Balance</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Amount</label>
                                <input type="number" class="form-control" id="adjustmentAmount" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Reason</label>
                                <textarea class="form-control form-textarea" id="adjustmentReason" rows="3" placeholder="Enter reason for adjustment"></textarea>
                            </div>
                            <button class="btn btn-primary w-100" onclick="processManualAdjustment()">
                                <i class="fas fa-check-circle"></i> Process Adjustment
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Transaction Reversal</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Transaction ID</label>
                                <input type="text" class="form-control" id="reversalTransactionId" placeholder="Enter transaction ID">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Reversal Type</label>
                                <select class="form-control" id="reversalType">
                                    <option value="full">Full Reversal</option>
                                    <option value="partial">Partial Reversal</option>
                                </select>
                            </div>
                            <div class="form-group" id="partialAmountGroup" style="display: none;">
                                <label class="form-label">Partial Amount</label>
                                <input type="number" class="form-control" id="partialReversalAmount" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Reason for Reversal</label>
                                <textarea class="form-control form-textarea" id="reversalReason" rows="3" placeholder="Enter reason for reversal"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Authorization Code</label>
                                <input type="password" class="form-control" id="reversalAuthCode" placeholder="Enter authorization code">
                            </div>
                            <button class="btn btn-danger w-100" onclick="processTransactionReversal()">
                                <i class="fas fa-undo"></i> Reverse Transaction
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Repayment Schedule Adjustment</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Loan ID</label>
                                <input type="text" class="form-control" id="adjustmentLoanId" placeholder="Enter loan ID">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Adjustment Type</label>
                                <select class="form-control" id="repaymentAdjustmentType">
                                    <option value="extend">Extend Term</option>
                                    <option value="reduce">Reduce Term</option>
                                    <option value="reschedule">Reschedule</option>
                                    <option value="waive_penalty">Waive Penalty</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">New Due Date</label>
                                <input type="date" class="form-control" id="newDueDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">New Installment Amount</label>
                                <input type="number" class="form-control" id="newInstallmentAmount" placeholder="Enter new amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Justification</label>
                                <textarea class="form-control form-textarea" id="repaymentAdjustmentJustification" rows="3" placeholder="Enter justification"></textarea>
                            </div>
                            <button class="btn btn-primary w-100" onclick="processRepaymentAdjustment()">
                                <i class="fas fa-calendar-edit"></i> Adjust Repayment
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">System Analytics</h1>
                    <div class="section-subtitle">Real-time analytics and performance metrics</div>
                </div>

                <div class="cards-grid">
                    <div class="chart-container">
                        <div class="chart-title">User Growth Trend</div>
                        <canvas id="userGrowthChart"></canvas>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Transaction Volume</div>
                        <canvas id="transactionVolumeChart"></canvas>
                    </div>
                </div>

                <div class="cards-grid mt-16">
                    <div class="chart-container">
                        <div class="chart-title">Revenue Analysis</div>
                        <canvas id="revenueChart"></canvas>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Agent Performance</div>
                        <canvas id="agentPerformanceChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Dispute Resolution Section -->
            <section id="disputes" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Dispute Resolution Center</h1>
                    <div class="section-subtitle">Manage customer-agent disputes and conflicts</div>
                </div>

                <div class="table-container">
                    <table class="table" id="disputesTable">
                        <thead>
                            <tr>
                                <th>Dispute ID</th>
                                <th>Type</th>
                                <th>Customer</th>
                                <th>Agent</th>
                                <th>Amount</th>
                                <th>Severity</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="disputesTableBody">
                            <!-- Dispute rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Create Admin Modal -->
    <div class="modal" id="createAdminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Admin Account</h3>
                <button class="modal-close" onclick="closeModal('createAdminModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Full Name *</label>
                    <input type="text" class="form-control" id="adminFullName" placeholder="Enter full name">
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address *</label>
                    <input type="email" class="form-control" id="adminEmail" placeholder="Enter email address">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" class="form-control" id="adminPassword" placeholder="Enter password">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password *</label>
                        <input type="password" class="form-control" id="adminConfirmPassword" placeholder="Confirm password">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Admin Role</label>
                    <select class="form-control" id="adminRole">
                        <option value="super_admin">Super Admin</option>
                        <option value="financial_admin">Financial Admin</option>
                        <option value="user_admin">User Admin</option>
                        <option value="support_admin">Support Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Permissions</label>
                    <select class="form-control" id="adminPermissions" multiple style="height: 150px;">
                        <option value="user_management">User Management</option>
                        <option value="financial_management">Financial Management</option>
                        <option value="agent_approval">Agent Approval</option>
                        <option value="dispute_resolution">Dispute Resolution</option>
                        <option value="system_settings">System Settings</option>
                        <option value="audit_logs">Audit Logs</option>
                        <option value="backup_export">Backup & Export</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('createAdminModal')">Cancel</button>
                <button class="btn btn-primary" onclick="createAdminAccount()">
                    <i class="fas fa-user-plus"></i> Create Admin Account
                </button>
            </div>
        </div>
    </div>

    <!-- Create Agent Modal -->
    <div class="modal" id="createAgentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Agent Account</h3>
                <button class="modal-close" onclick="closeModal('createAgentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Full Name *</label>
                    <input type="text" class="form-control" id="agentFullName" placeholder="Enter full name">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone Number *</label>
                    <input type="tel" class="form-control" id="agentPhone" placeholder="Enter phone number">
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address *</label>
                    <input type="email" class="form-control" id="agentEmail" placeholder="Enter email address">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" class="form-control" id="agentPassword" placeholder="Enter password">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password *</label>
                        <input type="password" class="form-control" id="agentConfirmPassword" placeholder="Confirm password">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Agent ID (Auto-generated)</label>
                    <input type="text" class="form-control" id="agentId" placeholder="Will be auto-generated" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Commission Rate (%)</label>
                    <input type="number" class="form-control" id="agentCommissionRate" placeholder="Enter commission rate" step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">Initial Status</label>
                    <select class="form-control" id="agentInitialStatus">
                        <option value="active">Active</option>
                        <option value="pending">Pending Verification</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('createAgentModal')">Cancel</button>
                <button class="btn btn-primary" onclick="createAgentAccount()">
                    <i class="fas fa-id-card"></i> Create Agent Account
                </button>
            </div>
        </div>
    </div>

    <!-- Manual Adjustment Modal -->
    <div class="modal" id="manualAdjustmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Manual System Adjustment</h3>
                <button class="modal-close" onclick="closeModal('manualAdjustmentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Feature Flag Modal -->
    <div class="modal" id="featureFlagModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Feature Flag Management</h3>
                <button class="modal-close" onclick="closeModal('featureFlagModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Backup Modal -->
    <div class="modal" id="backupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Backup & Data Export</h3>
                <button class="modal-close" onclick="closeModal('backupModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmationTitle">Confirm Action</h3>
                <button class="modal-close" onclick="closeModal('confirmationModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('confirmationModal')">Cancel</button>
                <button class="btn" id="confirmationButton">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- JavaScript Implementation -->
    <script>
        // ===== Firebase Configuration =====
        const firebaseConfig = {
            apiKey: "AIzaSyCWm9yvg5he7Lncy3h51n7ytOq7AZrA9gs",
            authDomain: "trucash-9fee8.firebaseapp.com",
            databaseURL: "https://trucash-9fee8-default-rtdb.firebaseio.com",
            projectId: "trucash-9fee8",
            storageBucket: "trucash-9fee8.firebasestorage.app",
            messagingSenderId: "622416212225",
            appId: "1:622416212225:web:07418a9b16f955c330ab00",
            measurementId: "G-6TEZFNFDBK"
        };

        // Initialize Firebase
        let firebaseApp, auth, db;
        
        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.database();
            console.log("SUDO: Firebase initialized successfully");
        } catch (error) {
            console.error("SUDO: Firebase initialization error:", error);
            showNotification('Firebase Error', 'Failed to initialize Firebase. Please refresh the page.', 'error');
        }

        // ===== Application State =====
        const AppState = {
            currentUser: null,
            isAuthenticated: false,
            systemStats: {
                totalUsers: 0,
                activeAgents: 0,
                todayTransactions: 0,
                platformRevenue: 0,
                activeSessions: 0
            },
            listeners: {},
            auditLogs: [],
            disputes: [],
            featureFlags: {},
            financialSettings: {},
            securitySettings: {},
            uiSettings: {},
            notificationSettings: {},
            repaymentPlans: []
        };

        // ===== Utility Functions =====
        const Utils = {
            showNotification(title, message, type = 'info', duration = 5000) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas ${
                            type === 'success' ? 'fa-check-circle' :
                            type === 'error' ? 'fa-exclamation-circle' :
                            type === 'warning' ? 'fa-exclamation-triangle' :
                            'fa-info-circle'
                        }"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${title}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                document.getElementById('notificationContainer').appendChild(notification);
                
                setTimeout(() => notification.classList.add('active'), 10);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.classList.remove('active');
                        setTimeout(() => notification.remove(), 300);
                    }
                }, duration);
            },

            showLoading(message = 'Processing...') {
                document.getElementById('loadingText').textContent = message;
                document.getElementById('loadingOverlay').classList.add('active');
            },

            hideLoading() {
                document.getElementById('loadingOverlay').classList.remove('active');
            },

            formatCurrency(amount, currency = 'USD') {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: currency
                }).format(amount);
            },

            formatDate(date) {
                return new Date(date).toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },

            generateId(prefix = '') {
                return prefix + Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
            },

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            },

            validatePassword(password) {
                return password.length >= 6;
            },

            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
                document.body.style.overflow = 'hidden';
            },

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
                document.body.style.overflow = 'auto';
            },

            confirmAction(title, message, confirmCallback, confirmText = 'Confirm', confirmType = 'primary') {
                document.getElementById('confirmationTitle').textContent = title;
                document.getElementById('confirmationMessage').textContent = message;
                const button = document.getElementById('confirmationButton');
                button.textContent = confirmText;
                button.className = `btn btn-${confirmType}`;
                
                // Remove existing event listeners
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                
                newButton.onclick = () => {
                    confirmCallback();
                    this.closeModal('confirmationModal');
                };
                
                this.openModal('confirmationModal');
            }
        };

        // ===== Firebase Service =====
    async checkSudoAccess() {
    try {
        // Wait for auth to be ready
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        const user = auth.currentUser;
        console.log("Current user:", user);
        
        if (!user) {
            console.log("No user found, redirecting to login");
            window.location.href = 'login.html';
            return false;
        }
        
        console.log("User email:", user.email);
        
        // Allow login with ANY admin email (for testing)
        const allowedEmails = ['sudo@gmail.com', 'admin@trucash.com', 'admin@gmail.com'];
        
        if (!allowedEmails.includes(user.email.toLowerCase())) {
            console.log("Email not in allowed list, checking database...");
            
            // Check database for user type
            const userRef = db.ref('users/' + user.uid);
            const snapshot = await userRef.once('value');
            
            if (snapshot.exists()) {
                const userData = snapshot.val();
                console.log("User data from DB:", userData);
                
                if (userData.userType === 'sudo' || userData.role === 'super_admin') {
                    console.log("User has sudo role, allowing access");
                    AppState.currentUser = user;
                    AppState.isAuthenticated = true;
                    return true;
                }
            }
            
            Utils.showNotification('Access Denied', 'Only SUDO admin can access this page.', 'error');
            setTimeout(() => window.location.href = 'admin.html', 2000);
            return false;
        }
        
        AppState.currentUser = user;
        AppState.isAuthenticated = true;
        console.log("Access granted to:", user.email);
        return true;
    } catch (error) {
        console.error('SUDO: Authentication error:', error);
        window.location.href = 'login.html';
        return false;
    }
}

            // System Stats
            async loadSystemStats() {
                try {
                    // Load total users
                    const usersRef = db.ref('users');
                    usersRef.once('value').then(snapshot => {
                        const users = snapshot.val() || {};
                        AppState.systemStats.totalUsers = Object.keys(users).length;
                        document.getElementById('totalUsers').textContent = AppState.systemStats.totalUsers;
                    });

                    // Load active agents
                    const agentsRef = db.ref('agents');
                    agentsRef.once('value').then(snapshot => {
                        const agents = snapshot.val() || {};
                        const activeAgents = Object.values(agents).filter(agent => agent.status === 'active').length;
                        AppState.systemStats.activeAgents = activeAgents;
                        document.getElementById('activeAgents').textContent = activeAgents;
                    });

                    // Load today's transactions
                    const today = new Date().toISOString().split('T')[0];
                    const transactionsRef = db.ref('transactions');
                    transactionsRef.orderByChild('date').equalTo(today).once('value').then(snapshot => {
                        const transactions = snapshot.val() || {};
                        AppState.systemStats.todayTransactions = Object.keys(transactions).length;
                        document.getElementById('todayTransactions').textContent = AppState.systemStats.todayTransactions;
                    });

                    // Load platform revenue
                    const revenueRef = db.ref('systemStats/revenue');
                    revenueRef.once('value').then(snapshot => {
                        const revenue = snapshot.val() || 0;
                        AppState.systemStats.platformRevenue = revenue;
                        document.getElementById('platformRevenue').textContent = Utils.formatCurrency(revenue);
                    });

                    // Load active sessions
                    const sessionsRef = db.ref('activeSessions');
                    sessionsRef.once('value').then(snapshot => {
                        const sessions = snapshot.val() || {};
                        AppState.systemStats.activeSessions = Object.keys(sessions).length;
                        document.getElementById('activeSessions').textContent = AppState.systemStats.activeSessions;
                    });

                } catch (error) {
                    console.error('SUDO: Error loading system stats:', error);
                }
            },

            // Admin Management
            async loadAdmins() {
                try {
                    const adminsRef = db.ref('users');
                    adminsRef.orderByChild('userType').equalTo('admin').once('value').then(snapshot => {
                        const admins = snapshot.val() || {};
                        const tableBody = document.getElementById('adminsTableBody');
                        tableBody.innerHTML = '';
                        
                        Object.entries(admins).forEach(([userId, admin]) => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${admin.adminId || userId.substring(0, 8)}</td>
                                <td>${admin.fullName || 'N/A'}</td>
                                <td>${admin.email || 'N/A'}</td>
                                <td><span class="role-badge">${admin.role || 'Admin'}</span></td>
                                <td><span class="status-badge status-${admin.status || 'active'}">${admin.status || 'Active'}</span></td>
                                <td>${admin.lastLogin ? Utils.formatDate(admin.lastLogin) : 'Never'}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline" onclick="editAdmin('${userId}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        ${admin.status === 'active' ? `
                                            <button class="btn btn-sm btn-outline" onclick="suspendAdmin('${userId}')">
                                                <i class="fas fa-pause"></i>
                                            </button>
                                        ` : `
                                            <button class="btn btn-sm btn-outline" onclick="reactivateAdmin('${userId}')">
                                                <i class="fas fa-play"></i>
                                            </button>
                                        `}
                                        <button class="btn btn-sm btn-danger" onclick="deleteAdmin('${userId}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            `;
                            tableBody.appendChild(row);
                        });
                    });
                } catch (error) {
                    console.error('SUDO: Error loading admins:', error);
                    Utils.showNotification('Error', 'Failed to load admin accounts', 'error');
                }
            },

            async createAdmin(adminData) {
                try {
                    // Create Firebase Auth user
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        adminData.email,
                        adminData.password
                    );
                    
                    // Prepare admin document
                    const adminDoc = {
                        uid: userCredential.user.uid,
                        fullName: adminData.fullName,
                        email: adminData.email,
                        role: adminData.role,
                        permissions: adminData.permissions,
                        userType: 'admin',
                        status: 'active',
                        createdAt: Date.now(),
                        createdBy: AppState.currentUser.uid,
                        lastLogin: null
                    };
                    
                    // Save to database
                    await db.ref(`users/${userCredential.user.uid}`).set(adminDoc);
                    
                    // Log audit trail
                    await this.logAudit({
                        action: 'create_admin',
                        userId: userCredential.user.uid,
                        details: `Created admin account for ${adminData.email}`,
                        performedBy: AppState.currentUser.uid
                    });
                    
                    return { success: true, userId: userCredential.user.uid };
                } catch (error) {
                    console.error('SUDO: Error creating admin:', error);
                    return { success: false, error: error.message };
                }
            },

            async suspendAdmin(userId) {
                try {
                    await db.ref(`users/${userId}`).update({
                        status: 'suspended',
                        suspendedAt: Date.now(),
                        suspendedBy: AppState.currentUser.uid
                    });
                    
                    await this.logAudit({
                        action: 'suspend_admin',
                        userId: userId,
                        details: 'Suspended admin account',
                        performedBy: AppState.currentUser.uid
                    });
                    
                    return { success: true };
                } catch (error) {
                    console.error('SUDO: Error suspending admin:', error);
                    return { success: false, error: error.message };
                }
            },

            async reactivateAdmin(userId) {
                try {
                    await db.ref(`users/${userId}`).update({
                        status: 'active',
                        reactivatedAt: Date.now(),
                        reactivatedBy: AppState.currentUser.uid
                    });
                    
                    await this.logAudit({
                        action: 'reactivate_admin',
                        userId: userId,
                        details: 'Reactivated admin account',
                        performedBy: AppState.currentUser.uid
                    });
                    
                    return { success: true };
                } catch (error) {
                    console.error('SUDO: Error reactivating admin:', error);
                    return { success: false, error: error.message };
                }
            },

            async deleteAdmin(userId) {
                try {
                    // Get admin data before deletion
                    const adminSnapshot = await db.ref(`users/${userId}`).once('value');
                    const adminData = adminSnapshot.val();
                    
                    // Delete from Firebase Auth
                    await auth.currentUser.delete();
                    
                    // Remove from database (but keep audit trail)
                    await db.ref(`users/${userId}`).update({
                        status: 'deleted',
                        deletedAt: Date.now(),
                        deletedBy: AppState.currentUser.uid,
                        email: `deleted_${Date.now()}_${adminData.email}`
                    });
                    
                    await this.logAudit({
                        action: 'delete_admin',
                        userId: userId,
                        details: 'Permanently deleted admin account',
                        performedBy: AppState.currentUser.uid
                    });
                    
                    return { success: true };
                } catch (error) {
                    console.error('SUDO: Error deleting admin:', error);
                    return { success: false, error: error.message };
                }
            },

            // Agent Management
            async loadAgents() {
                try {
                    const agentsRef = db.ref('agents');
                    agentsRef.once('value').then(snapshot => {
                        const agents = snapshot.val() || {};
                        const tableBody = document.getElementById('agentsTableBody');
                        tableBody.innerHTML = '';
                        
                        Object.entries(agents).forEach(([agentId, agent]) => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${agent.agentId || agentId.substring(0, 8)}</td>
                                <td>${agent.fullName || 'N/A'}</td>
                                <td>${agent.email || 'N/A'}</td>
                                <td>${agent.phone || 'N/A'}</td>
                                <td>${agent.totalClients || 0}</td>
                                <td><span class="status-badge status-${agent.status || 'active'}">${agent.status || 'Active'}</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline" onclick="editAgent('${agentId}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        ${agent.status === 'active' ? `
                                            <button class="btn btn-sm btn-outline" onclick="suspendAgent('${agentId}')">
                                                <i class="fas fa-pause"></i>
                                            </button>
                                        ` : `
                                            <button class="btn btn-sm btn-outline" onclick="reactivateAgent('${agentId}')">
                                                <i class="fas fa-play"></i>
                                            </button>
                                        `}
                                        <button class="btn btn-sm btn-danger" onclick="deleteAgent('${agentId}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            `;
                            tableBody.appendChild(row);
                        });
                    });
                } catch (error) {
                    console.error('SUDO: Error loading agents:', error);
                    Utils.showNotification('Error', 'Failed to load agent accounts', 'error');
                }
            },

            async createAgent(agentData) {
                try {
                    // Create Firebase Auth user
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        agentData.email,
                        agentData.password
                    );
                    
                    // Generate agent ID
                    const agentId = 'AGT' + Date.now().toString().slice(-6) + Math.random().toString(36).substr(2, 3).toUpperCase();
                    
                    // Prepare agent document
                    const agentDoc = {
                        uid: userCredential.user.uid,
                        agentId: agentId,
                        fullName: agentData.fullName,
                        email: agentData.email,
                        phone: agentData.phone,
                        commissionRate: agentData.commissionRate || 5.0,
                        userType: 'agent',
                        status: agentData.initialStatus || 'active',
                        createdAt: Date.now(),
                        createdBy: AppState.currentUser.uid,
                        totalClients: 0,
                        totalLoans: 0,
                        commissionEarned: 0,
                        lastLogin: null
                    };
                    
                    // Save to database
                    await db.ref(`users/${userCredential.user.uid}`).set(agentDoc);
                    await db.ref(`agents/${userCredential.user.uid}`).set(agentDoc);
                    
                    // Log audit trail
                    await this.logAudit({
                        action: 'create_agent',
                        userId: userCredential.user.uid,
                        details: `Created agent account for ${agentData.email} (ID: ${agentId})`,
                        performedBy: AppState.currentUser.uid
                    });
                    
                    return { success: true, agentId: agentId, userId: userCredential.user.uid };
                } catch (error) {
                    console.error('SUDO: Error creating agent:', error);
                    return { success: false, error: error.message };
                }
            },

            // Feature Flags
            async loadFeatureFlags() {
                try {
                    const flagsRef = db.ref('systemSettings/featureFlags');
                    flagsRef.on('value', (snapshot) => {
                        AppState.featureFlags = snapshot.val() || {};
                        
                        // Update toggle switches
                        Object.entries(AppState.featureFlags).forEach(([feature, value]) => {
                            const toggle = document.querySelector(`[data-feature="${feature}"]`);
                            if (toggle) {
                                toggle.checked = value;
                            }
                        });
                        
                        // Update JSON editor
                        document.getElementById('featureJsonEditor').textContent = 
                            JSON.stringify(AppState.featureFlags, null, 2);
                    });
                } catch (error) {
                    console.error('SUDO: Error loading feature flags:', error);
                }
            },

            async updateFeatureFlags(flags) {
                try {
                    await db.ref('systemSettings/featureFlags').set(flags);
                    await this.logAudit({
                        action: 'update_feature_flags',
                        details: 'Updated system feature flags',
                        performedBy: AppState.currentUser.uid
                    });
                    return { success: true };
                } catch (error) {
                    console.error('SUDO: Error updating feature flags:', error);
                    return { success: false, error: error.message };
                }
            },

            // Financial Settings
            async loadFinancialSettings() {
                try {
                    const settingsRef = db.ref('systemSettings/financial');
                    settingsRef.on('value', (snapshot) => {
                        AppState.financialSettings = snapshot.val() || {};
                        
                        // Update form fields
                        Object.keys(AppState.financialSettings).forEach(key => {
                            const element = document.getElementById(key);
                            if (element) {
                                element.value = AppState.financialSettings[key];
                            }
                        });
                    });
                } catch (error) {
                    console.error('SUDO: Error loading financial settings:', error);
                }
            },

            async saveFinancialSettings(settings) {
                try {
                    await db.ref('systemSettings/financial').set(settings);
                    await this.logAudit({
                        action: 'update_financial_settings',
                        details: 'Updated financial system settings',
                        performedBy: AppState.currentUser.uid
                    });
                    return { success: true };
                } catch (error) {
                    console.error('SUDO: Error saving financial settings:', error);
                    return { success: false, error: error.message };
                }
            },

            // Audit Logs
            async loadAuditLogs() {
                try {
                    const logsRef = db.ref('auditLogs');
                    logsRef.orderByChild('timestamp').limitToLast(100).on('value', (snapshot) => {
                        AppState.auditLogs = snapshot.val() || {};
                        const tableBody = document.getElementById('auditLogsBody');
                        tableBody.innerHTML = '';
                        
                        // Convert to array and sort by timestamp
                        const logsArray = Object.entries(AppState.auditLogs)
                            .map(([id, log]) => ({ id, ...log }))
                            .sort((a, b) => b.timestamp - a.timestamp);
                        
                        logsArray.forEach(log => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${Utils.formatDate(log.timestamp)}</td>
                                <td><span class="role-badge">${log.userType || 'system'}</span></td>
                                <td>${log.userId ? log.userId.substring(0, 8) : 'SYSTEM'}</td>
                                <td>${log.action || 'N/A'}</td>
                                <td>${log.details || 'N/A'}</td>
                                <td>${log.ipAddress || 'N/A'}</td>
                                <td><span class="status-badge status-active">Completed</span></td>
                            `;
                            tableBody.appendChild(row);
                        });
                        
                        // Update badge
                        document.getElementById('auditBadge').textContent = logsArray.length;
                    });
                } catch (error) {
                    console.error('SUDO: Error loading audit logs:', error);
                }
            },

            async logAudit(logData) {
                try {
                    const logId = Utils.generateId('AUDIT_');
                    const fullLog = {
                        ...logData,
                        timestamp: Date.now(),
                        userType: 'sudo',
                        ipAddress: await this.getClientIP()
                    };
                    
                    await db.ref(`auditLogs/${logId}`).set(fullLog);
                } catch (error) {
                    console.error('SUDO: Error logging audit:', error);
                }
            },

            async getClientIP() {
                // This is a simplified version. In production, you'd get this from your backend.
                return '127.0.0.1';
            },

            // Manual Interventions
            async processManualAdjustment(adjustmentData) {
                try {
                    const adjustmentId = Utils.generateId('ADJ_');
                    
                    // Save adjustment record
                    await db.ref(`manualAdjustments/${adjustmentId}`).set({
                        ...adjustmentData,
                        timestamp: Date.now(),
                        performedBy: AppState.currentUser.uid,
                        status: 'completed'
                    });
                    
                    // Update user balance
                    if (adjustmentData.userId && adjustmentData.amount) {
                        const userRef = db.ref(`users/${adjustmentData.userId}/balance`);
                        const snapshot = await userRef.once('value');
                        const currentBalance = snapshot.val() || 0;
                        
                        let newBalance = currentBalance;
                        switch (adjustmentData.type) {
                            case 'add':
                                newBalance = currentBalance + adjustmentData.amount;
                                break;
                            case 'deduct':
                                newBalance = currentBalance - adjustmentData.amount;
                                break;
                            case 'set':
                                newBalance = adjustmentData.amount;
                                break;
                        }
                        
                        await userRef.set(newBalance);
                    }
                    
                    // Log audit
                    await this.logAudit({
                        action: 'manual_adjustment',
                        userId: adjustmentData.userId,
                        details: `Manual adjustment: ${adjustmentData.reason} (Amount: ${adjustmentData.amount})`,
                        performedBy: AppState.currentUser.uid
                    });
                    
                    return { success: true, adjustmentId };
                } catch (error) {
                    console.error('SUDO: Error processing manual adjustment:', error);
                    return { success: false, error: error.message };
                }
            },

            // Backup & Export
            async createBackup(backupData) {
                try {
                    const backupId = Utils.generateId('BACKUP_');
                    const backupRef = db.ref(`backups/${backupId}`);
                    
                    const backup = {
                        ...backupData,
                        id: backupId,
                        timestamp: Date.now(),
                        createdBy: AppState.currentUser.uid,
                        status: 'completed',
                        size: '0 KB' // In production, calculate actual size
                    };
                    
                    await backupRef.set(backup);
                    
                    await this.logAudit({
                        action: 'create_backup',
                        details: `Created backup: ${backupData.name}`,
                        performedBy: AppState.currentUser.uid
                    });
                    
                    return { success: true, backupId };
                } catch (error) {
                    console.error('SUDO: Error creating backup:', error);
                    return { success: false, error: error.message };
                }
            },

            // Initialize Real-time Listeners
            initRealTimeListeners() {
                // System stats listener
                db.ref('systemStats').on('value', (snapshot) => {
                    const stats = snapshot.val() || {};
                    AppState.systemStats = { ...AppState.systemStats, ...stats };
                    this.updateDashboardStats();
                });

                // Active sessions listener
                db.ref('activeSessions').on('value', (snapshot) => {
                    const sessions = snapshot.val() || {};
                    AppState.systemStats.activeSessions = Object.keys(sessions).length;
                    document.getElementById('activeSessions').textContent = AppState.systemStats.activeSessions;
                });

                // Disputes listener
                db.ref('disputes').on('value', (snapshot) => {
                    const disputes = snapshot.val() || {};
                    AppState.disputes = disputes;
                    document.getElementById('disputeBadge').textContent = Object.keys(disputes).length;
                });
            },

            updateDashboardStats() {
                document.getElementById('totalUsers').textContent = AppState.systemStats.totalUsers || 0;
                document.getElementById('activeAgents').textContent = AppState.systemStats.activeAgents || 0;
                document.getElementById('todayTransactions').textContent = AppState.systemStats.todayTransactions || 0;
                document.getElementById('platformRevenue').textContent = 
                    Utils.formatCurrency(AppState.systemStats.platformRevenue || 0);
            }
        };

        // ===== UI Management =====
        const UIManager = {
            init() {
                this.bindEvents();
                this.initCharts();
                this.setupNavigation();
            },

            bindEvents() {
                // Navigation
                document.querySelectorAll('.nav-item[data-section]').forEach(item => {
                    item.addEventListener('click', () => {
                        const section = item.getAttribute('data-section');
                        this.showSection(section);
                    });
                });

                // Logout
                document.querySelector('.nav-item[data-action="logout"]').addEventListener('click', () => {
                    Utils.confirmAction(
                        'Confirm Logout',
                        'Are you sure you want to logout from SUDO control panel?',
                        () => FirebaseService.logout(),
                        'Logout',
                        'danger'
                    );
                });

                // Feature flag toggles
                document.querySelectorAll('[data-feature]').forEach(toggle => {
                    toggle.addEventListener('change', () => {
                        const feature = toggle.getAttribute('data-feature');
                        const value = toggle.checked;
                        this.updateFeatureFlag(feature, value);
                    });
                });

                // Form submissions
                document.getElementById('reversalType').addEventListener('change', (e) => {
                    document.getElementById('partialAmountGroup').style.display = 
                        e.target.value === 'partial' ? 'block' : 'none';
                });
            },

            showSection(sectionId) {
                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`.nav-item[data-section="${sectionId}"]`).classList.add('active');
                
                // Show section content
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(sectionId).classList.add('active');
            },

            setupNavigation() {
                // Default to dashboard
                this.showSection('dashboard');
            },

            initCharts() {
                // Activity Chart
                const activityCtx = document.getElementById('activityChart').getContext('2d');
                new Chart(activityCtx, {
                    type: 'line',
                    data: {
                        labels: ['6AM', '9AM', '12PM', '3PM', '6PM', '9PM', '12AM'],
                        datasets: [{
                            label: 'System Activity',
                            data: [12, 19, 3, 5, 2, 3, 15],
                            borderColor: 'rgba(0, 122, 255, 1)',
                            backgroundColor: 'rgba(0, 122, 255, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // User Growth Chart
                const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
                new Chart(userGrowthCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'New Users',
                            data: [65, 59, 80, 81, 56, 55],
                            backgroundColor: 'rgba(52, 199, 89, 0.6)'
                        }]
                    },
                    options: {
                        responsive: true
                    }
                });
            },

            async updateFeatureFlag(feature, value) {
                try {
                    const updatedFlags = { ...AppState.featureFlags, [feature]: value };
                    const result = await FirebaseService.updateFeatureFlags(updatedFlags);
                    
                    if (result.success) {
                        Utils.showNotification('Feature Updated', `Feature "${feature}" ${value ? 'enabled' : 'disabled'}`, 'success');
                    }
                } catch (error) {
                    Utils.showNotification('Error', 'Failed to update feature flag', 'error');
                }
            }
        };

        // ===== Business Logic Functions =====
        // Admin Management
        function openCreateAdminModal() {
            Utils.openModal('createAdminModal');
        }

        async function createAdminAccount() {
            const fullName = document.getElementById('adminFullName').value.trim();
            const email = document.getElementById('adminEmail').value.trim();
            const password = document.getElementById('adminPassword').value;
            const confirmPassword = document.getElementById('adminConfirmPassword').value;
            const role = document.getElementById('adminRole').value;
            const permissions = Array.from(document.getElementById('adminPermissions').selectedOptions).map(opt => opt.value);

            // Validation
            if (!fullName || !email || !password || !confirmPassword) {
                Utils.showNotification('Validation Error', 'Please fill in all required fields', 'error');
                return;
            }

            if (!Utils.validateEmail(email)) {
                Utils.showNotification('Validation Error', 'Please enter a valid email address', 'error');
                return;
            }

            if (password !== confirmPassword) {
                Utils.showNotification('Validation Error', 'Passwords do not match', 'error');
                return;
            }

            if (!Utils.validatePassword(password)) {
                Utils.showNotification('Validation Error', 'Password must be at least 6 characters', 'error');
                return;
            }

            Utils.showLoading('Creating admin account...');

            try {
                const adminData = {
                    fullName,
                    email,
                    password,
                    role,
                    permissions
                };

                const result = await FirebaseService.createAdmin(adminData);

                if (result.success) {
                    Utils.showNotification('Success', 'Admin account created successfully', 'success');
                    Utils.closeModal('createAdminModal');
                    
                    // Clear form
                    document.getElementById('adminFullName').value = '';
                    document.getElementById('adminEmail').value = '';
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminConfirmPassword').value = '';
                    
                    // Refresh admin list
                    FirebaseService.loadAdmins();
                } else {
                    Utils.showNotification('Error', result.error || 'Failed to create admin account', 'error');
                }
            } catch (error) {
                Utils.showNotification('Error', 'Failed to create admin account', 'error');
            } finally {
                Utils.hideLoading();
            }
        }

        async function suspendAdmin(userId) {
            Utils.confirmAction(
                'Suspend Admin',
                'Are you sure you want to suspend this admin account?',
                async () => {
                    Utils.showLoading('Suspending admin...');
                    const result = await FirebaseService.suspendAdmin(userId);
                    Utils.hideLoading();
                    
                    if (result.success) {
                        Utils.showNotification('Success', 'Admin account suspended', 'success');
                        FirebaseService.loadAdmins();
                    } else {
                        Utils.showNotification('Error', 'Failed to suspend admin', 'error');
                    }
                },
                'Suspend',
                'warning'
            );
        }

        async function reactivateAdmin(userId) {
            Utils.confirmAction(
                'Reactivate Admin',
                'Are you sure you want to reactivate this admin account?',
                async () => {
                    Utils.showLoading('Reactivating admin...');
                    const result = await FirebaseService.reactivateAdmin(userId);
                    Utils.hideLoading();
                    
                    if (result.success) {
                        Utils.showNotification('Success', 'Admin account reactivated', 'success');
                        FirebaseService.loadAdmins();
                    } else {
                        Utils.showNotification('Error', 'Failed to reactivate admin', 'error');
                    }
                },
                'Reactivate',
                'success'
            );
        }

        async function deleteAdmin(userId) {
            Utils.confirmAction(
                'Delete Admin',
                'WARNING: This will permanently delete the admin account. This action cannot be undone.',
                async () => {
                    Utils.showLoading('Deleting admin...');
                    const result = await FirebaseService.deleteAdmin(userId);
                    Utils.hideLoading();
                    
                    if (result.success) {
                        Utils.showNotification('Success', 'Admin account deleted', 'success');
                        FirebaseService.loadAdmins();
                    } else {
                        Utils.showNotification('Error', 'Failed to delete admin', 'error');
                    }
                },
                'Delete',
                'danger'
            );
        }

        // Agent Management
        function openCreateAgentModal() {
            // Generate agent ID
            const agentId = 'AGT' + Date.now().toString().slice(-6) + Math.random().toString(36).substr(2, 3).toUpperCase();
            document.getElementById('agentId').value = agentId;
            
            Utils.openModal('createAgentModal');
        }

        async function createAgentAccount() {
            const fullName = document.getElementById('agentFullName').value.trim();
            const phone = document.getElementById('agentPhone').value.trim();
            const email = document.getElementById('agentEmail').value.trim();
            const password = document.getElementById('agentPassword').value;
            const confirmPassword = document.getElementById('agentConfirmPassword').value;
            const commissionRate = parseFloat(document.getElementById('agentCommissionRate').value) || 5.0;
            const initialStatus = document.getElementById('agentInitialStatus').value;

            // Validation
            if (!fullName || !phone || !email || !password || !confirmPassword) {
                Utils.showNotification('Validation Error', 'Please fill in all required fields', 'error');
                return;
            }

            if (!Utils.validateEmail(email)) {
                Utils.showNotification('Validation Error', 'Please enter a valid email address', 'error');
                return;
            }

            if (password !== confirmPassword) {
                Utils.showNotification('Validation Error', 'Passwords do not match', 'error');
                return;
            }

            if (!Utils.validatePassword(password)) {
                Utils.showNotification('Validation Error', 'Password must be at least 6 characters', 'error');
                return;
            }

            Utils.showLoading('Creating agent account...');

            try {
                const agentData = {
                    fullName,
                    phone,
                    email,
                    password,
                    commissionRate,
                    initialStatus
                };

                const result = await FirebaseService.createAgent(agentData);

                if (result.success) {
                    Utils.showNotification('Success', `Agent account created successfully (ID: ${result.agentId})`, 'success');
                    Utils.closeModal('createAgentModal');
                    
                    // Clear form
                    document.getElementById('agentFullName').value = '';
                    document.getElementById('agentPhone').value = '';
                    document.getElementById('agentEmail').value = '';
                    document.getElementById('agentPassword').value = '';
                    document.getElementById('agentConfirmPassword').value = '';
                    document.getElementById('agentCommissionRate').value = '5.0';
                    
                    // Refresh agent list
                    FirebaseService.loadAgents();
                } else {
                    Utils.showNotification('Error', result.error || 'Failed to create agent account', 'error');
                }
            } catch (error) {
                Utils.showNotification('Error', 'Failed to create agent account', 'error');
            } finally {
                Utils.hideLoading();
            }
        }

        // Feature Flags
        function openFeatureFlagModal() {
            // Implement feature flag modal functionality
            Utils.showNotification('Info', 'Feature flag management is available in the main section', 'info');
        }

        function updateFeatureFlags() {
            try {
                const flags = JSON.parse(document.getElementById('featureJsonEditor').textContent);
                FirebaseService.updateFeatureFlags(flags);
                Utils.showNotification('Success', 'Feature flags updated successfully', 'success');
            } catch (error) {
                Utils.showNotification('Error', 'Invalid JSON format', 'error');
            }
        }

        // Financial Settings
        async function saveFinancialSettings() {
            const settings = {
                minLoanAmount: document.getElementById('minLoanAmount').value,
                maxLoanAmount: document.getElementById('maxLoanAmount').value,
                dailyTransactionLimit: document.getElementById('dailyTransactionLimit').value,
                serviceCharge: document.getElementById('serviceCharge').value,
                agentCommission: document.getElementById('agentCommission').value,
                latePaymentFee: document.getElementById('latePaymentFee').value,
                autoApprovalLimit: document.getElementById('autoApprovalLimit').value,
                manualReviewThreshold: document.getElementById('manualReviewThreshold').value,
                riskThreshold: document.getElementById('riskThreshold').value,
                defaultCurrency: document.getElementById('defaultCurrency').value,
                decimalPlaces: document.getElementById('decimalPlaces').value,
                currencyFormat: document.getElementById('currencyFormat').value
            };

            Utils.showLoading('Saving financial settings...');
            const result = await FirebaseService.saveFinancialSettings(settings);
            Utils.hideLoading();

            if (result.success) {
                Utils.showNotification('Success', 'Financial settings saved successfully', 'success');
            } else {
                Utils.showNotification('Error', 'Failed to save financial settings', 'error');
            }
        }

        // Notification Settings
        async function saveNotificationSettings() {
            const settings = {
                paymentReminders: {
                    enabled: document.getElementById('notify_payment_reminders').checked,
                    daysBefore: document.getElementById('reminderDaysBefore').value,
                    frequency: document.getElementById('reminderFrequency').value
                },
                overdueAlerts: {
                    enabled: document.getElementById('notify_overdue_alerts').checked,
                    alertDays: document.getElementById('overdueAlertDays').value,
                    maxAlerts: document.getElementById('maxOverdueAlerts').value
                },
                securityNotifications: {
                    loginAlerts: document.getElementById('notify_login_alerts').checked,
                    accountChanges: document.getElementById('notify_account_changes').checked,
                    securityWarnings: document.getElementById('notify_security_warnings').checked
                },
                templates: {
                    paymentReminder: document.getElementById('paymentReminderTemplate').value,
                    overdueAlert: document.getElementById('overdueAlertTemplate').value
                }
            };

            try {
                await db.ref('systemSettings/notifications').set(settings);
                await FirebaseService.logAudit({
                    action: 'update_notification_settings',
                    details: 'Updated notification system settings',
                    performedBy: AppState.currentUser.uid
                });
                Utils.showNotification('Success', 'Notification settings saved successfully', 'success');
            } catch (error) {
                Utils.showNotification('Error', 'Failed to save notification settings', 'error');
            }
        }

        // UI Settings
        async function saveUISettings() {
            const settings = {
                customerDashboardLayout: document.getElementById('customerDashboardLayout').value,
                agentDashboardLayout: document.getElementById('agentDashboardLayout').value,
                adminDashboardLayout: document.getElementById('adminDashboardLayout').value,
                customerModules: Array.from(document.getElementById('customerModules').selectedOptions).map(opt => opt.value),
                autoRefresh: document.getElementById('ui_auto_refresh').checked,
                showTutorials: document.getElementById('ui_show_tutorials').checked,
                animations: document.getElementById('ui_animations').checked
            };

            try {
                await db.ref('systemSettings/ui').set(settings);
                await FirebaseService.logAudit({
                    action: 'update_ui_settings',
                    details: 'Updated UI behavior settings',
                    performedBy: AppState.currentUser.uid
                });
                Utils.showNotification('Success', 'UI settings saved successfully', 'success');
            } catch (error) {
                Utils.showNotification('Error', 'Failed to save UI settings', 'error');
            }
        }

        // Security Settings
        async function saveSecuritySettings() {
            const settings = {
                sessionTimeout: document.getElementById('sessionTimeout').value,
                maxConcurrentSessions: document.getElementById('maxConcurrentSessions').value,
                forceLogout: document.getElementById('forceLogout').value,
                maxLoginAttempts: document.getElementById('maxLoginAttempts').value,
                lockoutDuration: document.getElementById('lockoutDuration').value,
                ipLockoutThreshold: document.getElementById('ipLockoutThreshold').value,
                minPasswordLength: document.getElementById('minPasswordLength').value,
                passwordExpiryDays: document.getElementById('passwordExpiryDays').value,
                passwordHistoryCount: document.getElementById('passwordHistoryCount').value,
                twoFactorAuth: document.getElementById('security_2fa').checked,
                ipWhitelisting: document.getElementById('security_ip_whitelist').checked,
                allowedIPs: document.getElementById('allowedIPs').value.split(',').map(ip => ip.trim()).filter(ip => ip)
            };

            try {
                await db.ref('systemSettings/security').set(settings);
                await FirebaseService.logAudit({
                    action: 'update_security_settings',
                    details: 'Updated security system settings',
                    performedBy: AppState.currentUser.uid
                });
                Utils.showNotification('Success', 'Security settings saved successfully', 'success');
            } catch (error) {
                Utils.showNotification('Error', 'Failed to save security settings', 'error');
            }
        }

        // Manual Interventions
        function openManualAdjustmentModal() {
            UIManager.showSection('manual');
        }

        async function processManualAdjustment() {
            const userType = document.getElementById('adjustmentUserType').value;
            const userId = document.getElementById('adjustmentUserId').value.trim();
            const adjustmentType = document.getElementById('adjustmentType').value;
            const amount = parseFloat(document.getElementById('adjustmentAmount').value);
            const reason = document.getElementById('adjustmentReason').value.trim();

            if (!userId || !amount || !reason) {
                Utils.showNotification('Validation Error', 'Please fill in all required fields', 'error');
                return;
            }

            if (amount <= 0) {
                Utils.showNotification('Validation Error', 'Amount must be greater than 0', 'error');
                return;
            }

            Utils.confirmAction(
                'Confirm Manual Adjustment',
                `Are you sure you want to ${adjustmentType} $${amount} to ${userType} ${userId}?`,
                async () => {
                    Utils.showLoading('Processing adjustment...');
                    
                    const adjustmentData = {
                        userId,
                        type: adjustmentType,
                        amount,
                        reason,
                        userType
                    };

                    const result = await FirebaseService.processManualAdjustment(adjustmentData);
                    Utils.hideLoading();

                    if (result.success) {
                        Utils.showNotification('Success', 'Manual adjustment processed successfully', 'success');
                        
                        // Clear form
                        document.getElementById('adjustmentUserId').value = '';
                        document.getElementById('adjustmentAmount').value = '';
                        document.getElementById('adjustmentReason').value = '';
                    } else {
                        Utils.showNotification('Error', result.error || 'Failed to process adjustment', 'error');
                    }
                },
                'Process Adjustment',
                'primary'
            );
        }

        // Backup & Export
        function openBackupModal() {
            UIManager.showSection('backup');
        }

        async function createManualBackup() {
            const dataTypes = Array.from(document.getElementById('backupDataType').selectedOptions).map(opt => opt.value);
            const format = document.getElementById('backupFormat').value;

            if (dataTypes.length === 0) {
                Utils.showNotification('Validation Error', 'Please select at least one data type', 'error');
                return;
            }

            Utils.showLoading('Creating backup...');

            const backupData = {
                name: `Manual Backup ${new Date().toLocaleString()}`,
                type: 'manual',
                dataTypes,
                format,
                size: '0 KB'
            };

            const result = await FirebaseService.createBackup(backupData);
            Utils.hideLoading();

            if (result.success) {
                Utils.showNotification('Success', `Backup created successfully (ID: ${result.backupId})`, 'success');
            } else {
                Utils.showNotification('Error', result.error || 'Failed to create backup', 'error');
            }
        }

        // Utility Functions
        function refreshSystemHealth() {
            FirebaseService.loadSystemStats();
            Utils.showNotification('Refreshed', 'System health data refreshed', 'success');
        }

        function viewAuditLogs() {
            UIManager.showSection('audit');
            FirebaseService.loadAuditLogs();
        }

        function refreshAdminList() {
            FirebaseService.loadAdmins();
            Utils.showNotification('Refreshed', 'Admin list refreshed', 'success');
        }

        function refreshAuditLogs() {
            FirebaseService.loadAuditLogs();
            Utils.showNotification('Refreshed', 'Audit logs refreshed', 'success');
        }

        function closeModal(modalId) {
            Utils.closeModal(modalId);
        }

        // ===== Application Initialization =====
        async function initApplication() {
            Utils.showLoading('Initializing SUDO Control Panel...');
            
            // Check SUDO access
            const hasAccess = await FirebaseService.checkSudoAccess();
            if (!hasAccess) return;
            
            // Load initial data
            await FirebaseService.loadSystemStats();
            await FirebaseService.loadAdmins();
            await FirebaseService.loadAgents();
            await FirebaseService.loadFeatureFlags();
            await FirebaseService.loadFinancialSettings();
            await FirebaseService.loadAuditLogs();
            
            // Initialize real-time listeners
            FirebaseService.initRealTimeListeners();
            
            // Initialize UI
            UIManager.init();
            
            // Hide loading
            setTimeout(() => {
                Utils.hideLoading();
                Utils.showNotification('SUDO Control Panel Ready', 'Full system control initialized', 'success');
            }, 1000);
        }

        // Initialize application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApplication);

        // Export functions to global scope for HTML onclick handlers
        window.openCreateAdminModal = openCreateAdminModal;
        window.createAdminAccount = createAdminAccount;
        window.suspendAdmin = suspendAdmin;
        window.reactivateAdmin = reactivateAdmin;
        window.deleteAdmin = deleteAdmin;
        window.openCreateAgentModal = openCreateAgentModal;
        window.createAgentAccount = createAgentAccount;
        window.openFeatureFlagModal = openFeatureFlagModal;
        window.updateFeatureFlags = updateFeatureFlags;
        window.saveFinancialSettings = saveFinancialSettings;
        window.saveNotificationSettings = saveNotificationSettings;
        window.saveUISettings = saveUISettings;
        window.saveSecuritySettings = saveSecuritySettings;
        window.openManualAdjustmentModal = openManualAdjustmentModal;
        window.processManualAdjustment = processManualAdjustment;
        window.openBackupModal = openBackupModal;
        window.createManualBackup = createManualBackup;
        window.refreshSystemHealth = refreshSystemHealth;
        window.viewAuditLogs = viewAuditLogs;
        window.refreshAdminList = refreshAdminList;
        window.refreshAuditLogs = refreshAuditLogs;
        window.closeModal = closeModal;
        window.openModal = Utils.openModal;
    </script>
</body>
</html>
