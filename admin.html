<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruCash | Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ===== CSS Reset & Variables ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', 
                       'Helvetica Neue', 'Segoe UI', Roboto, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :root {
            --primary-color: #007AFF;
            --primary-dark: #0056CC;
            --primary-light: #409cff;
            --secondary-color: #5856D6;
            --success-color: #34C759;
            --warning-color: #FF9500;
            --danger-color: #FF3B30;
            --info-color: #5AC8FA;
            --dark-color: #1D1D1F;
            --light-color: #F5F5F7;
            --gray-100: #F2F2F7;
            --gray-200: #E5E5EA;
            --gray-300: #D1D1D6;
            --gray-400: #C7C7CC;
            --gray-500: #8E8E93;
            --gray-600: #636366;
            --gray-700: #48484A;
            --gray-800: #3A3A3C;
            --gray-900: #2C2C2E;
            --sidebar-width: 260px;
            --header-height: 70px;
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.16);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark-color);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== Layout Structure ===== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ===== Sidebar ===== */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 20px;
        }

        .logo-text {
            font-weight: 700;
            font-size: 18px;
            background: linear-gradient(135deg, var(--dark-color), var(--gray-700));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gray-500);
            padding: 0 20px 8px;
            font-weight: 600;
        }

        .nav-list {
            list-style: none;
        }

        .nav-item {
            margin: 4px 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--gray-700);
            text-decoration: none;
            transition: var(--transition);
            position: relative;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background: rgba(0, 122, 255, 0.08);
            color: var(--primary-color);
        }

        .nav-link.active {
            background: rgba(0, 122, 255, 0.12);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            font-weight: 600;
        }

        .nav-link i {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--danger-color);
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(0, 122, 255, 0.05);
            border-radius: var(--border-radius-sm);
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .admin-details h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
            color: var(--dark-color);
        }

        .admin-details p {
            font-size: 12px;
            color: var(--gray-500);
        }

        .logout-btn {
            width: 100%;
            padding: 12px;
            background: transparent;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            color: var(--danger-color);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background: rgba(255, 59, 48, 0.1);
            border-color: var(--danger-color);
            transform: translateY(-1px);
        }

        /* ===== Main Content ===== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ===== Header ===== */
        .main-header {
            height: var(--header-height);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-left h1 {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .notification-bell {
            position: relative;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--gray-100);
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray-700);
        }

        .notification-bell:hover {
            background: var(--gray-200);
            color: var(--primary-color);
        }

        .notification-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 8px;
            height: 8px;
            background: var(--danger-color);
            border-radius: 50%;
            border: 2px solid white;
        }

        .quick-stats {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--gray-100);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .stat-item i {
            color: var(--primary-color);
        }

        /* ===== Content Area ===== */
        .content-area {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== Dashboard Overview ===== */
        .dashboard-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .stat-card.total-users::before {
            background: var(--primary-color);
        }

        .stat-card.active-agents::before {
            background: var(--success-color);
        }

        .stat-card.pending-apps::before {
            background: var(--warning-color);
        }

        .stat-card.pending-tx::before {
            background: var(--danger-color);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .total-users .stat-icon {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        }

        .active-agents .stat-icon {
            background: linear-gradient(135deg, var(--success-color), #2DB867);
        }

        .pending-apps .stat-icon {
            background: linear-gradient(135deg, var(--warning-color), #FF9500);
        }

        .pending-tx .stat-icon {
            background: linear-gradient(135deg, var(--danger-color), #FF2D55);
        }

        .stat-title {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark-color);
            line-height: 1;
        }

        .stat-change {
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--danger-color);
        }

        /* ===== Charts Section ===== */
        .charts-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .chart-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        /* ===== Recent Activity ===== */
        .recent-activity {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            margin-bottom: 24px;
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid var(--gray-100);
            transition: var(--transition);
        }

        .activity-item:hover {
            background: var(--gray-50);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }

        .activity-icon.approval {
            background: var(--success-color);
        }

        .activity-icon.rejection {
            background: var(--danger-color);
        }

        .activity-icon.warning {
            background: var(--warning-color);
        }

        .activity-icon.info {
            background: var(--info-color);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark-color);
        }

        .activity-description {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* ===== Data Tables ===== */
        .data-table-container {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            margin-bottom: 24px;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .table-tools {
            display: flex;
            gap: 12px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 16px 8px 40px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            font-size: 14px;
            width: 200px;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-500);
        }

        .filter-btn {
            padding: 8px 16px;
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            color: var(--gray-700);
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-btn:hover {
            background: var(--gray-200);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: var(--gray-100);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--gray-200);
        }

        .data-table td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-100);
            font-size: 14px;
            color: var(--gray-800);
        }

        .data-table tr:hover {
            background: var(--gray-50);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* ===== Status Badges ===== */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: rgba(255, 149, 0, 0.1);
            color: var(--warning-color);
        }

        .status-approved {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success-color);
        }

        .status-rejected {
            background: rgba(255, 59, 48, 0.1);
            color: var(--danger-color);
        }

        .status-active {
            background: rgba(0, 122, 255, 0.1);
            color: var(--primary-color);
        }

        .status-suspended {
            background: rgba(142, 142, 147, 0.1);
            color: var(--gray-600);
        }

        .status-banned {
            background: rgba(255, 59, 48, 0.2);
            color: var(--danger-color);
        }

        /* ===== Action Buttons ===== */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 14px;
        }

        .btn-view {
            background: rgba(0, 122, 255, 0.1);
            color: var(--primary-color);
        }

        .btn-view:hover {
            background: rgba(0, 122, 255, 0.2);
        }

        .btn-edit {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success-color);
        }

        .btn-edit:hover {
            background: rgba(52, 199, 89, 0.2);
        }

        .btn-delete {
            background: rgba(255, 59, 48, 0.1);
            color: var(--danger-color);
        }

        .btn-delete:hover {
            background: rgba(255, 59, 48, 0.2);
        }

        .btn-approve {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(52, 199, 89, 0.3);
        }

        .btn-approve:hover {
            background: rgba(52, 199, 89, 0.2);
        }

        .btn-reject {
            background: rgba(255, 59, 48, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(255, 59, 48, 0.3);
        }

        .btn-reject:hover {
            background: rgba(255, 59, 48, 0.2);
        }

        /* ===== Modal Styles ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal {
            background: white;
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--gray-100);
            color: var(--gray-600);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--gray-200);
            color: var(--danger-color);
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(90vh - 140px);
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: var(--gray-50);
        }

        /* ===== Form Elements ===== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            font-size: 14px;
            transition: var(--transition);
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* ===== Buttons ===== */
        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.25);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.35);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
            border-color: var(--gray-400);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #2DB867);
            color: white;
            box-shadow: 0 2px 8px rgba(52, 199, 89, 0.25);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #2DB867, var(--success-color));
            box-shadow: 0 4px 12px rgba(52, 199, 89, 0.35);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #FF2D55);
            color: white;
            box-shadow: 0 2px 8px rgba(255, 59, 48, 0.25);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #FF2D55, var(--danger-color));
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.35);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #FF9500);
            color: white;
            box-shadow: 0 2px 8px rgba(255, 149, 0, 0.25);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #FF9500, var(--warning-color));
            box-shadow: 0 4px 12px rgba(255, 149, 0, 0.35);
        }

        /* ===== Loading States ===== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: var(--gray-500);
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== Empty States ===== */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: var(--gray-500);
            text-align: center;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--gray-400);
        }

        /* ===== Responsive Design ===== */
        @media (max-width: 1200px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-toggle {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .dashboard-overview {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .table-tools {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box input {
                width: 100%;
            }

            .header-right {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .quick-stats {
                flex-wrap: wrap;
            }
        }

        /* ===== Mobile Menu Toggle ===== */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 1001;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
        }

        .mobile-menu-toggle:hover {
            transform: scale(1.1);
        }

        /* ===== Notification Dropdown ===== */
        .notification-dropdown {
            position: absolute;
            top: 60px;
            right: 20px;
            width: 320px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
            z-index: 1000;
            display: none;
        }

        .notification-dropdown.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .notification-header {
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 16px;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-item:hover {
            background: var(--gray-50);
        }

        .notification-item.unread {
            background: rgba(0, 122, 255, 0.05);
        }

        .notification-content h5 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark-color);
        }

        .notification-content p {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 4px;
        }

        .notification-time {
            font-size: 11px;
            color: var(--gray-500);
        }

        /* ===== Application Details ===== */
        .application-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .detail-card {
            background: var(--gray-50);
            border-radius: var(--border-radius-sm);
            padding: 16px;
            border: 1px solid var(--gray-200);
        }

        .detail-card h4 {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-600);
            margin-bottom: 8px;
        }

        .detail-card p {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark-color);
        }

        /* ===== Document Preview ===== */
        .document-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .document-item {
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            transition: var(--transition);
        }

        .document-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .document-image {
            height: 120px;
            overflow: hidden;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .document-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .document-info {
            padding: 12px;
            background: white;
        }

        .document-info h5 {
            font-size: 12px;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 4px;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        .document-info p {
            font-size: 11px;
            color: var(--gray-500);
        }

        /* ===== Audit Trail ===== */
        .audit-trail {
            background: var(--gray-50);
            border-radius: var(--border-radius-sm);
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .audit-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--gray-200);
        }

        .audit-item:last-child {
            border-bottom: none;
        }

        .audit-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--gray-700);
            flex-shrink: 0;
        }

        .audit-content {
            flex: 1;
        }

        .audit-content h5 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark-color);
        }

        .audit-content p {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 4px;
        }

        .audit-time {
            font-size: 11px;
            color: var(--gray-500);
        }

        /* ===== Pagination ===== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 20px;
            border-top: 1px solid var(--gray-200);
        }

        .page-btn {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            border: 1px solid var(--gray-300);
            background: white;
            color: var(--gray-700);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .page-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .page-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== Toast Notifications ===== */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid;
            min-width: 300px;
            max-width: 400px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: slideInRight 0.3s ease;
            border: 1px solid var(--gray-200);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left-color: var(--success-color);
        }

        .toast.error {
            border-left-color: var(--danger-color);
        }

        .toast.warning {
            border-left-color: var(--warning-color);
        }

        .toast.info {
            border-left-color: var(--info-color);
        }

        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            color: var(--success-color);
        }

        .toast.error .toast-icon {
            color: var(--danger-color);
        }

        .toast.warning .toast-icon {
            color: var(--warning-color);
        }

        .toast.info .toast-icon {
            color: var(--info-color);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--dark-color);
        }

        .toast-message {
            font-size: 13px;
            color: var(--gray-600);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: var(--transition);
        }

        .toast-close:hover {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        /* ===== Credentials Form ===== */
        .credentials-form {
            background: var(--gray-50);
            padding: 20px;
            border-radius: var(--border-radius-sm);
            margin: 20px 0;
            border: 1px solid var(--gray-200);
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .form-check-input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .form-check-label {
            font-size: 14px;
            color: var(--gray-700);
            cursor: pointer;
        }

        /* ===== Admin Management Section ===== */
        .admin-management {
            background: white;
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            margin-bottom: 24px;
        }

        .admin-management h3 {
            margin-bottom: 20px;
            color: var(--dark-color);
            font-size: 18px;
            font-weight: 600;
        }

        .admin-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        /* ===== Tabs ===== */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 24px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--gray-600);
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition);
        }

        .tab:hover {
            color: var(--primary-color);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            font-weight: 600;
        }

        /* ===== Card Grid ===== */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .info-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
        }

        .info-card h4 {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-card p {
            font-size: 16px;
            color: var(--dark-color);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .info-card small {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* ===== Progress Bar ===== */
        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* ===== Loan Details ===== */
        .loan-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .loan-item {
            background: var(--gray-50);
            padding: 16px;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--gray-200);
        }

        .loan-label {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .loan-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark-color);
        }

        /* ===== Quick Actions ===== */
        .quick-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }

        .quick-action-btn {
            padding: 12px 20px;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            color: var(--gray-700);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 200px;
        }

        .quick-action-btn:hover {
            background: var(--gray-100);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .quick-action-btn.danger:hover {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        /* ===== Filter Panel ===== */
        .filter-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            margin-bottom: 24px;
            display: none;
        }

        .filter-panel.active {
            display: block;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filter-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        /* ===== Status Indicators ===== */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
        }

        .status-indicator.online {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success-color);
        }

        .status-indicator.offline {
            background: rgba(142, 142, 147, 0.1);
            color: var(--gray-600);
        }

        .status-indicator.busy {
            background: rgba(255, 149, 0, 0.1);
            color: var(--warning-color);
        }

        /* ===== Transaction Timeline ===== */
        .transaction-timeline {
            position: relative;
            padding-left: 20px;
            margin: 24px 0;
        }

        .timeline-item {
            position: relative;
            padding: 12px 0 12px 30px;
            border-left: 2px solid var(--gray-300);
        }

        .timeline-item:last-child {
            border-left-color: transparent;
        }

        .timeline-dot {
            position: absolute;
            left: -7px;
            top: 16px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--gray-300);
        }

        .timeline-item.active .timeline-dot {
            background: var(--primary-color);
        }

        .timeline-item.completed .timeline-dot {
            background: var(--success-color);
        }

        .timeline-content h5 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark-color);
        }

        .timeline-content p {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 4px;
        }

        .timeline-time {
            font-size: 11px;
            color: var(--gray-500);
        }

        /* ===== Export Controls ===== */
        .export-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .export-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            color: var(--gray-700);
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .export-btn:hover {
            background: var(--gray-100);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* ===== Statistics Grid ===== */
        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-item-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            text-align: center;
        }

        .stat-item-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 8px;
        }

        .stat-item-label {
            font-size: 14px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ===== Alert Banner ===== */
        .alert-banner {
            background: linear-gradient(135deg, var(--warning-color), #FF9500);
            color: white;
            padding: 16px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideInDown 0.3s ease;
        }

        @keyframes slideInDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .alert-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .alert-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Main Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">T</div>
                <div class="logo-text">TruCash Admin</div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-title">Dashboard</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#overview" class="nav-link active" data-section="overview">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Overview</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#analytics" class="nav-link" data-section="analytics">
                                <i class="fas fa-chart-line"></i>
                                <span>Analytics</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#notifications" class="nav-link" data-section="notifications">
                                <i class="fas fa-bell"></i>
                                <span>Notifications</span>
                                <span class="nav-badge" id="notificationCount">0</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Agent Management</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#applications" class="nav-link" data-section="applications">
                                <i class="fas fa-user-clock"></i>
                                <span>Applications</span>
                                <span class="nav-badge" id="applicationCount">0</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#agents" class="nav-link" data-section="agents">
                                <i class="fas fa-users"></i>
                                <span>Active Agents</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#performance" class="nav-link" data-section="performance">
                                <i class="fas fa-chart-bar"></i>
                                <span>Performance</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#banned-agents" class="nav-link" data-section="bannedAgents">
                                <i class="fas fa-ban"></i>
                                <span>Banned Agents</span>
                                <span class="nav-badge" id="bannedAgentsCount">0</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">Customer Management</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#customers" class="nav-link" data-section="customers">
                                <i class="fas fa-user-friends"></i>
                                <span>All Customers</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#verification" class="nav-link" data-section="verification">
                                <i class="fas fa-check-circle"></i>
                                <span>Verification</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#transactions" class="nav-link" data-section="transactions">
                                <i class="fas fa-exchange-alt"></i>
                                <span>Transactions</span>
                                <span class="nav-badge" id="pendingTxCount">0</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#banned-customers" class="nav-link" data-section="bannedCustomers">
                                <i class="fas fa-user-slash"></i>
                                <span>Banned Customers</span>
                                <span class="nav-badge" id="bannedCustomersCount">0</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">System Management</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#disputes" class="nav-link" data-section="disputes">
                                <i class="fas fa-gavel"></i>
                                <span>Disputes</span>
                                <span class="nav-badge" id="disputeCount">0</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#audit" class="nav-link" data-section="audit">
                                <i class="fas fa-history"></i>
                                <span>Audit Trail</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#settings" class="nav-link" data-section="settings">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#admin-management" class="nav-link" data-section="adminManagement">
                                <i class="fas fa-user-shield"></i>
                                <span>Admin Management</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="admin-info">
                    <div class="admin-avatar" id="adminAvatar">A</div>
                    <div class="admin-details">
                        <h4 id="adminName">Admin User</h4>
                        <p id="adminEmail">Loading...</p>
                        <small class="status-indicator online" id="adminStatus">Online</small>
                    </div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <h1 id="pageTitle">Dashboard Overview</h1>
                </div>
                
                <div class="header-right">
                    <div class="quick-stats">
                        <div class="stat-item">
                            <i class="fas fa-globe"></i>
                            <span>Live</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-database"></i>
                            <span id="lastUpdated">Just now</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-clock"></i>
                            <span id="currentTime">00:00</span>
                        </div>
                    </div>
                    
                    <div class="notification-container">
                        <div class="notification-bell" id="notificationBell">
                            <i class="fas fa-bell"></i>
                            <div class="notification-badge"></div>
                        </div>
                        <div class="notification-dropdown" id="notificationDropdown">
                            <div class="notification-header">
                                <h4>Notifications</h4>
                                <button class="btn-secondary btn-sm" id="markAllRead">Mark all read</button>
                            </div>
                            <div class="notification-list" id="notificationList">
                                <div class="empty-state">
                                    <i class="fas fa-bell-slash"></i>
                                    <p>No notifications</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Overview Section -->
                <section id="overview" class="content-section active">
                    <div class="alert-banner" id="systemAlert" style="display: none;">
                        <div class="alert-content">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span id="alertMessage">System alert message</span>
                        </div>
                        <button class="alert-close" onclick="document.getElementById('systemAlert').style.display='none'">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="dashboard-overview">
                        <div class="stat-card total-users">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Total Users</div>
                                    <div class="stat-value" id="totalUsers">0</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span id="userChange">0%</span> from last week
                            </div>
                        </div>
                        
                        <div class="stat-card active-agents">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Active Agents</div>
                                    <div class="stat-value" id="activeAgents">0</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                            </div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span id="agentChange">0%</span> from last week
                            </div>
                        </div>
                        
                        <div class="stat-card pending-apps">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Pending Applications</div>
                                    <div class="stat-value" id="pendingApps">0</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                            <div class="stat-change negative">
                                <i class="fas fa-arrow-up"></i>
                                <span id="appChange">0</span> new today
                            </div>
                        </div>
                        
                        <div class="stat-card pending-tx">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-title">Pending Transactions</div>
                                    <div class="stat-value" id="pendingTx">0</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-exchange-alt"></i>
                                </div>
                            </div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-down"></i>
                                <span id="txChange">0</span> resolved today
                            </div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="showQuickAction('exportData')">
                            <i class="fas fa-download"></i>
                            <span>Export Data</span>
                        </button>
                        <button class="quick-action-btn" onclick="showQuickAction('systemCheck')">
                            <i class="fas fa-server"></i>
                            <span>System Check</span>
                        </button>
                        <button class="quick-action-btn" onclick="showQuickAction('backup')">
                            <i class="fas fa-database"></i>
                            <span>Backup Database</span>
                        </button>
                        <button class="quick-action-btn danger" onclick="showQuickAction('maintenance')">
                            <i class="fas fa-tools"></i>
                            <span>Maintenance Mode</span>
                        </button>
                    </div>

                    <div class="charts-section">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Transaction Volume (Last 30 Days)</h3>
                                <select class="form-control" style="width: auto;" id="chartPeriod">
                                    <option value="7">Last 7 days</option>
                                    <option value="30" selected>Last 30 days</option>
                                    <option value="90">Last 90 days</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="transactionChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Platform Statistics</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="platformStatsChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="recent-activity">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Recent Activity</h3>
                            <button class="btn-secondary btn-sm" onclick="refreshActivity()">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                        </div>
                        <div class="activity-list" id="recentActivity">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>Loading activities...</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Applications Section -->
                <section id="applications" class="content-section">
                    <div class="filter-panel" id="appFilterPanel">
                        <div class="filter-header">
                            <h4>Filter Applications</h4>
                            <button class="btn-secondary btn-sm" onclick="toggleFilter('appFilterPanel')">
                                <i class="fas fa-times"></i>
                                Close
                            </button>
                        </div>
                        <div class="filter-options">
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-control" id="filterAppStatus">
                                    <option value="">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="reviewed">Reviewed</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date Range</label>
                                <input type="date" class="form-control" id="filterAppDateFrom">
                            </div>
                            <div class="form-group">
                                <label class="form-label">To</label>
                                <input type="date" class="form-control" id="filterAppDateTo">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Sort By</label>
                                <select class="form-control" id="filterAppSort">
                                    <option value="newest">Newest First</option>
                                    <option value="oldest">Oldest First</option>
                                    <option value="name">Applicant Name</option>
                                </select>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 20px;">
                            <button class="btn-secondary" onclick="resetAppFilters()">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                            <button class="btn-primary" onclick="applyAppFilters()">
                                <i class="fas fa-filter"></i>
                                Apply Filters
                            </button>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>Agent Applications</h3>
                            <div class="table-tools">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="appSearch" placeholder="Search applications...">
                                </div>
                                <button class="filter-btn" onclick="toggleFilter('appFilterPanel')">
                                    <i class="fas fa-filter"></i>
                                    Filter
                                </button>
                                <div class="export-controls">
                                    <button class="export-btn" onclick="exportApplications()">
                                        <i class="fas fa-file-export"></i>
                                        Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="loading" id="appsLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading applications...</p>
                        </div>
                        
                        <div id="applicationsTable" style="display: none;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Application ID</th>
                                        <th>Applicant Name</th>
                                        <th>Phone</th>
                                        <th>NRC</th>
                                        <th>Submitted</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="applicationsBody">
                                    <!-- Applications will be loaded here -->
                                </tbody>
                            </table>
                            
                            <div class="pagination" id="appPagination">
                                <!-- Pagination will be loaded here -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Active Agents Section -->
                <section id="agents" class="content-section">
                    <div class="filter-panel" id="agentFilterPanel">
                        <div class="filter-header">
                            <h4>Filter Agents</h4>
                            <button class="btn-secondary btn-sm" onclick="toggleFilter('agentFilterPanel')">
                                <i class="fas fa-times"></i>
                                Close
                            </button>
                        </div>
                        <div class="filter-options">
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-control" id="filterAgentStatus">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="suspended">Suspended</option>
                                    <option value="banned">Banned</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Performance</label>
                                <select class="form-control" id="filterAgentPerformance">
                                    <option value="">All</option>
                                    <option value="excellent">Excellent (90%+)</option>
                                    <option value="good">Good (70-89%)</option>
                                    <option value="average">Average (50-69%)</option>
                                    <option value="poor">Poor (Below 50%)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date Joined</label>
                                <input type="date" class="form-control" id="filterAgentDateFrom">
                            </div>
                            <div class="form-group">
                                <label class="form-label">To</label>
                                <input type="date" class="form-control" id="filterAgentDateTo">
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 20px;">
                            <button class="btn-secondary" onclick="resetAgentFilters()">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                            <button class="btn-primary" onclick="applyAgentFilters()">
                                <i class="fas fa-filter"></i>
                                Apply Filters
                            </button>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>Active Agents</h3>
                            <div class="table-tools">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="agentSearch" placeholder="Search agents...">
                                </div>
                                <button class="filter-btn" onclick="toggleFilter('agentFilterPanel')">
                                    <i class="fas fa-filter"></i>
                                    Filter
                                </button>
                                <div class="export-controls">
                                    <button class="export-btn" onclick="exportAgents()">
                                        <i class="fas fa-file-export"></i>
                                        Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="loading" id="agentsLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading agents...</p>
                        </div>
                        
                        <div id="agentsTable" style="display: none;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Agent ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Clients</th>
                                        <th>Success Rate</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="agentsBody">
                                    <!-- Agents will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Performance Section -->
                <section id="performance" class="content-section">
                    <div class="tabs">
                        <button class="tab active" data-tab="agentPerformance">Agent Performance</button>
                        <button class="tab" data-tab="systemPerformance">System Performance</button>
                        <button class="tab" data-tab="revenueMetrics">Revenue Metrics</button>
                    </div>

                    <div id="agentPerformance" class="tab-content">
                        <div class="statistics-grid">
                            <div class="stat-item-card">
                                <div class="stat-item-value" id="avgSuccessRate">0%</div>
                                <div class="stat-item-label">Average Success Rate</div>
                            </div>
                            <div class="stat-item-card">
                                <div class="stat-item-value" id="totalCommissions">$0</div>
                                <div class="stat-item-label">Total Commissions Paid</div>
                            </div>
                            <div class="stat-item-card">
                                <div class="stat-item-value" id="avgProcessingTime">0h</div>
                                <div class="stat-item-label">Avg Processing Time</div>
                            </div>
                            <div class="stat-item-card">
                                <div class="stat-item-value" id="topAgent">N/A</div>
                                <div class="stat-item-label">Top Performing Agent</div>
                            </div>
                        </div>

                        <div class="chart-card" style="margin-top: 24px;">
                            <div class="chart-header">
                                <h3>Agent Performance Overview</h3>
                                <select class="form-control" style="width: auto;" id="performancePeriod">
                                    <option value="week">This Week</option>
                                    <option value="month" selected>This Month</option>
                                    <option value="quarter">This Quarter</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div id="systemPerformance" class="tab-content" style="display: none;">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>System Uptime & Performance</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="systemPerformanceChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div id="revenueMetrics" class="tab-content" style="display: none;">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Revenue Analysis</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Banned Agents Section -->
                <section id="bannedAgents" class="content-section">
                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>Banned/Suspended Agents</h3>
                            <div class="table-tools">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="bannedAgentSearch" placeholder="Search banned agents...">
                                </div>
                                <button class="filter-btn" onclick="filterBannedAgents()">
                                    <i class="fas fa-filter"></i>
                                    Filter
                                </button>
                            </div>
                        </div>
                        
                        <div class="loading" id="bannedAgentsLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading banned agents...</p>
                        </div>
                        
                        <div id="bannedAgentsTable" style="display: none;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Agent ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Reason</th>
                                        <th>Banned On</th>
                                        <th>Banned By</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="bannedAgentsBody">
                                    <!-- Banned agents will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Customers Section -->
                <section id="customers" class="content-section">
                    <div class="filter-panel" id="customerFilterPanel">
                        <div class="filter-header">
                            <h4>Filter Customers</h4>
                            <button class="btn-secondary btn-sm" onclick="toggleFilter('customerFilterPanel')">
                                <i class="fas fa-times"></i>
                                Close
                            </button>
                        </div>
                        <div class="filter-options">
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-control" id="filterCustomerStatus">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="suspended">Suspended</option>
                                    <option value="banned">Banned</option>
                                    <option value="verified">Verified</option>
                                    <option value="unverified">Unverified</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Account Balance</label>
                                <select class="form-control" id="filterCustomerBalance">
                                    <option value="">All</option>
                                    <option value="zero">Zero Balance</option>
                                    <option value="low">Low (&lt; $100)</option>
                                    <option value="medium">Medium ($100-$1000)</option>
                                    <option value="high">High (&gt; $1000)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Registration Date</label>
                                <input type="date" class="form-control" id="filterCustomerDateFrom">
                            </div>
                            <div class="form-group">
                                <label class="form-label">To</label>
                                <input type="date" class="form-control" id="filterCustomerDateTo">
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 20px;">
                            <button class="btn-secondary" onclick="resetCustomerFilters()">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                            <button class="btn-primary" onclick="applyCustomerFilters()">
                                <i class="fas fa-filter"></i>
                                Apply Filters
                            </button>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>Customer Accounts</h3>
                            <div class="table-tools">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="customerSearch" placeholder="Search customers...">
                                </div>
                                <button class="filter-btn" onclick="toggleFilter('customerFilterPanel')">
                                    <i class="fas fa-filter"></i>
                                    Filter
                                </button>
                                <div class="export-controls">
                                    <button class="export-btn" onclick="exportCustomers()">
                                        <i class="fas fa-file-export"></i>
                                        Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="loading" id="customersLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading customers...</p>
                        </div>
                        
                        <div id="customersTable" style="display: none;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Customer ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Loans</th>
                                        <th>Balance</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="customersBody">
                                    <!-- Customers will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Verification Section -->
                <section id="verification" class="content-section">
                    <div class="tabs">
                        <button class="tab active" data-tab="pendingVerification">Pending Verification</button>
                        <button class="tab" data-tab="verifiedUsers">Verified Users</button>
                        <button class="tab" data-tab="rejectedVerification">Rejected</button>
                    </div>

                    <div id="pendingVerification" class="tab-content">
                        <div class="data-table-container">
                            <div class="table-header">
                                <h3>Pending Verification Requests</h3>
                                <div class="table-tools">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="pendingVerificationSearch" placeholder="Search requests...">
                                    </div>
                                </div>
                            </div>
                            <div class="loading" id="pendingVerificationLoading">
                                <div class="loading-spinner"></div>
                                <p>Loading verification requests...</p>
                            </div>
                            <div id="pendingVerificationTable" style="display: none;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>User ID</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Submitted</th>
                                            <th>Type</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pendingVerificationBody">
                                        <!-- Pending verification will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div id="verifiedUsers" class="tab-content" style="display: none;">
                        <div class="data-table-container">
                            <div class="table-header">
                                <h3>Verified Users</h3>
                                <div class="table-tools">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="verifiedUsersSearch" placeholder="Search verified users...">
                                    </div>
                                </div>
                            </div>
                            <div id="verifiedUsersTable">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>User ID</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Verified On</th>
                                            <th>Verified By</th>
                                            <th>Level</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="verifiedUsersBody">
                                        <!-- Verified users will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div id="rejectedVerification" class="tab-content" style="display: none;">
                        <div class="data-table-container">
                            <div class="table-header">
                                <h3>Rejected Verification Requests</h3>
                                <div class="table-tools">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="rejectedVerificationSearch" placeholder="Search rejected requests...">
                                    </div>
                                </div>
                            </div>
                            <div id="rejectedVerificationTable">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>User ID</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Rejected On</th>
                                            <th>Reason</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rejectedVerificationBody">
                                        <!-- Rejected verification will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Transactions Section -->
                <section id="transactions" class="content-section">
                    <div class="filter-panel" id="transactionFilterPanel">
                        <div class="filter-header">
                            <h4>Filter Transactions</h4>
                            <button class="btn-secondary btn-sm" onclick="toggleFilter('transactionFilterPanel')">
                                <i class="fas fa-times"></i>
                                Close
                            </button>
                        </div>
                        <div class="filter-options">
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-control" id="filterTransactionStatus">
                                    <option value="">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                    <option value="completed">Completed</option>
                                    <option value="failed">Failed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Type</label>
                                <select class="form-control" id="filterTransactionType">
                                    <option value="">All Types</option>
                                    <option value="deposit">Deposit</option>
                                    <option value="withdrawal">Withdrawal</option>
                                    <option value="transfer">Transfer</option>
                                    <option value="loan">Loan</option>
                                    <option value="repayment">Repayment</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Amount Range</label>
                                <div class="form-row">
                                    <input type="number" class="form-control" placeholder="Min" id="filterTransactionMin">
                                    <input type="number" class="form-control" placeholder="Max" id="filterTransactionMax">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date Range</label>
                                <div class="form-row">
                                    <input type="date" class="form-control" id="filterTransactionDateFrom">
                                    <input type="date" class="form-control" id="filterTransactionDateTo">
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 20px;">
                            <button class="btn-secondary" onclick="resetTransactionFilters()">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                            <button class="btn-primary" onclick="applyTransactionFilters()">
                                <i class="fas fa-filter"></i>
                                Apply Filters
                            </button>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>Transaction History</h3>
                            <div class="table-tools">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="transactionSearch" placeholder="Search transactions...">
                                </div>
                                <button class="filter-btn" onclick="toggleFilter('transactionFilterPanel')">
                                    <i class="fas fa-filter"></i>
                                    Filter
                                </button>
                                <div class="export-controls">
                                    <button class="export-btn" onclick="exportTransactions()">
                                        <i class="fas fa-file-export"></i>
                                        Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="loading" id="transactionsLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading transactions...</p>
                        </div>
                        
                        <div id="transactionsTable" style="display: none;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Transaction ID</th>
                                        <th>Type</th>
                                        <th>Customer</th>
                                        <th>Agent</th>
                                        <th>Amount</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsBody">
                                    <!-- Transactions will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Banned Customers Section -->
                <section id="bannedCustomers" class="content-section">
                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>Banned/Suspended Customers</h3>
                            <div class="table-tools">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="bannedCustomerSearch" placeholder="Search banned customers...">
                                </div>
                                <button class="filter-btn" onclick="filterBannedCustomers()">
                                    <i class="fas fa-filter"></i>
                                    Filter
                                </button>
                            </div>
                        </div>
                        
                        <div class="loading" id="bannedCustomersLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading banned customers...</p>
                        </div>
                        
                        <div id="bannedCustomersTable" style="display: none;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Customer ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Reason</th>
                                        <th>Banned On</th>
                                        <th>Banned By</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="bannedCustomersBody">
                                    <!-- Banned customers will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Disputes Section -->
                <section id="disputes" class="content-section">
                    <div class="filter-panel" id="disputeFilterPanel">
                        <div class="filter-header">
                            <h4>Filter Disputes</h4>
                            <button class="btn-secondary btn-sm" onclick="toggleFilter('disputeFilterPanel')">
                                <i class="fas fa-times"></i>
                                Close
                            </button>
                        </div>
                        <div class="filter-options">
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-control" id="filterDisputeStatus">
                                    <option value="">All Status</option>
                                    <option value="open">Open</option>
                                    <option value="investigating">Investigating</option>
                                    <option value="resolved">Resolved</option>
                                    <option value="closed">Closed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Type</label>
                                <select class="form-control" id="filterDisputeType">
                                    <option value="">All Types</option>
                                    <option value="transaction">Transaction</option>
                                    <option value="service">Service</option>
                                    <option value="loan">Loan</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Severity</label>
                                <select class="form-control" id="filterDisputeSeverity">
                                    <option value="">All</option>
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                    <option value="critical">Critical</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date Range</label>
                                <div class="form-row">
                                    <input type="date" class="form-control" id="filterDisputeDateFrom">
                                    <input type="date" class="form-control" id="filterDisputeDateTo">
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 20px;">
                            <button class="btn-secondary" onclick="resetDisputeFilters()">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                            <button class="btn-primary" onclick="applyDisputeFilters()">
                                <i class="fas fa-filter"></i>
                                Apply Filters
                            </button>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>Active Disputes</h3>
                            <div class="table-tools">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="disputeSearch" placeholder="Search disputes...">
                                </div>
                                <button class="filter-btn" onclick="toggleFilter('disputeFilterPanel')">
                                    <i class="fas fa-filter"></i>
                                    Filter
                                </button>
                                <div class="export-controls">
                                    <button class="export-btn" onclick="exportDisputes()">
                                        <i class="fas fa-file-export"></i>
                                        Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="loading" id="disputesLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading disputes...</p>
                        </div>
                        
                        <div id="disputesTable" style="display: none;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Case ID</th>
                                        <th>Type</th>
                                        <th>Customer</th>
                                        <th>Agent</th>
                                        <th>Amount</th>
                                        <th>Opened</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="disputesBody">
                                    <!-- Disputes will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Audit Trail Section -->
                <section id="audit" class="content-section">
                    <div class="filter-panel" id="auditFilterPanel">
                        <div class="filter-header">
                            <h4>Filter Audit Logs</h4>
                            <button class="btn-secondary btn-sm" onclick="toggleFilter('auditFilterPanel')">
                                <i class="fas fa-times"></i>
                                Close
                            </button>
                        </div>
                        <div class="filter-options">
                            <div class="form-group">
                                <label class="form-label">Action Type</label>
                                <select class="form-control" id="filterAuditAction">
                                    <option value="">All Actions</option>
                                    <option value="CREATE">Create</option>
                                    <option value="UPDATE">Update</option>
                                    <option value="DELETE">Delete</option>
                                    <option value="APPROVE">Approve</option>
                                    <option value="REJECT">Reject</option>
                                    <option value="SUSPEND">Suspend</option>
                                    <option value="BAN">Ban</option>
                                    <option value="LOGIN">Login</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">User Type</label>
                                <select class="form-control" id="filterAuditUserType">
                                    <option value="">All Users</option>
                                    <option value="admin">Admin</option>
                                    <option value="agent">Agent</option>
                                    <option value="customer">Customer</option>
                                    <option value="system">System</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date Range</label>
                                <div class="form-row">
                                    <input type="date" class="form-control" id="filterAuditDateFrom">
                                    <input type="date" class="form-control" id="filterAuditDateTo">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Search Text</label>
                                <input type="text" class="form-control" id="filterAuditSearch" placeholder="Search in details...">
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 20px;">
                            <button class="btn-secondary" onclick="resetAuditFilters()">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                            <button class="btn-primary" onclick="applyAuditFilters()">
                                <i class="fas fa-filter"></i>
                                Apply Filters
                            </button>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>Audit Trail</h3>
                            <div class="table-tools">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="auditSearch" placeholder="Search audit logs...">
                                </div>
                                <button class="filter-btn" onclick="toggleFilter('auditFilterPanel')">
                                    <i class="fas fa-filter"></i>
                                    Filter
                                </button>
                                <div class="export-controls">
                                    <button class="export-btn" onclick="exportAuditLogs()">
                                        <i class="fas fa-file-export"></i>
                                        Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="loading" id="auditLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading audit logs...</p>
                        </div>
                        
                        <div id="auditTable" style="display: none;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Log ID</th>
                                        <th>Action</th>
                                        <th>User</th>
                                        <th>Target</th>
                                        <th>Details</th>
                                        <th>Timestamp</th>
                                        <th>IP Address</th>
                                    </tr>
                                </thead>
                                <tbody id="auditBody">
                                    <!-- Audit logs will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settings" class="content-section">
                    <div class="tabs">
                        <button class="tab active" data-tab="generalSettings">General</button>
                        <button class="tab" data-tab="securitySettings">Security</button>
                        <button class="tab" data-tab="notificationSettings">Notifications</button>
                        <button class="tab" data-tab="apiSettings">API Settings</button>
                    </div>

                    <div id="generalSettings" class="tab-content">
                        <div class="admin-management">
                            <h3>System Configuration</h3>
                            <div class="admin-form">
                                <div class="form-group">
                                    <label class="form-label">System Name</label>
                                    <input type="text" class="form-control" id="systemName" placeholder="Enter system name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Support Email</label>
                                    <input type="email" class="form-control" id="supportEmail" placeholder="Enter support email">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Support Phone</label>
                                    <input type="tel" class="form-control" id="supportPhone" placeholder="Enter support phone">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">System Timezone</label>
                                    <select class="form-control" id="systemTimezone">
                                        <option value="UTC">UTC</option>
                                        <option value="America/New_York">Eastern Time</option>
                                        <option value="America/Chicago">Central Time</option>
                                        <option value="America/Denver">Mountain Time</option>
                                        <option value="America/Los_Angeles">Pacific Time</option>
                                        <option value="Europe/London">London</option>
                                        <option value="Europe/Paris">Paris</option>
                                        <option value="Asia/Tokyo">Tokyo</option>
                                        <option value="Australia/Sydney">Sydney</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="admin-management">
                            <h3>Transaction Settings</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Minimum Transaction Amount</label>
                                    <input type="number" class="form-control" id="minTransaction" placeholder="Enter minimum amount">
                                </div>
                                <div class="form-group">
                                    <label>Maximum Transaction Amount</label>
                                    <input type="number" class="form-control" id="maxTransaction" placeholder="Enter maximum amount">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Daily Transaction Limit</label>
                                    <input type="number" class="form-control" id="dailyTransactionLimit" placeholder="Enter daily limit">
                                </div>
                                <div class="form-group">
                                    <label>Monthly Transaction Limit</label>
                                    <input type="number" class="form-control" id="monthlyTransactionLimit" placeholder="Enter monthly limit">
                                </div>
                            </div>
                        </div>

                        <div class="admin-management">
                            <h3>Commission Settings</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Standard Commission (%)</label>
                                    <input type="number" class="form-control" id="standardCommission" placeholder="Enter commission rate" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label>Premium Commission (%)</label>
                                    <input type="number" class="form-control" id="premiumCommission" placeholder="Enter commission rate" step="0.1">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Referral Commission (%)</label>
                                    <input type="number" class="form-control" id="referralCommission" placeholder="Enter referral commission" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label>Commission Payment Cycle</label>
                                    <select class="form-control" id="commissionCycle">
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="bi-weekly">Bi-Weekly</option>
                                        <option value="monthly" selected>Monthly</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="admin-management">
                            <h3>Penalty & Fees</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Late Payment Penalty (%)</label>
                                    <input type="number" class="form-control" id="latePenalty" placeholder="Enter penalty rate" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label>Transaction Fee (%)</label>
                                    <input type="number" class="form-control" id="transactionFee" placeholder="Enter transaction fee" step="0.1">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Grace Period (Days)</label>
                                    <input type="number" class="form-control" id="gracePeriod" placeholder="Enter grace period">
                                </div>
                                <div class="form-group">
                                    <label>Overdraft Limit</label>
                                    <input type="number" class="form-control" id="overdraftLimit" placeholder="Enter overdraft limit">
                                </div>
                            </div>
                        </div>

                        <div class="admin-management">
                            <h3>Loan Settings</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Minimum Loan Amount</label>
                                    <input type="number" class="form-control" id="minLoanAmount" placeholder="Enter minimum loan amount">
                                </div>
                                <div class="form-group">
                                    <label>Maximum Loan Amount</label>
                                    <input type="number" class="form-control" id="maxLoanAmount" placeholder="Enter maximum loan amount">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Interest Rate (%)</label>
                                    <input type="number" class="form-control" id="loanInterestRate" placeholder="Enter interest rate" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label>Loan Term (Days)</label>
                                    <input type="number" class="form-control" id="loanTerm" placeholder="Enter loan term">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="securitySettings" class="tab-content" style="display: none;">
                        <div class="admin-management">
                            <h3>Security Configuration</h3>
                            <div class="form-group">
                                <label class="form-label">Two-Factor Authentication</label>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="enable2FA">
                                    <label class="form-check-label" for="enable2FA">Enable 2FA for all users</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Session Timeout (Minutes)</label>
                                <input type="number" class="form-control" id="sessionTimeout" placeholder="Enter session timeout">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Max Login Attempts</label>
                                <input type="number" class="form-control" id="maxLoginAttempts" placeholder="Enter max login attempts">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Password Policy</label>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="requireStrongPassword">
                                    <label class="form-check-label" for="requireStrongPassword">Require strong passwords</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="passwordExpiry">
                                    <label class="form-check-label" for="passwordExpiry">Enable password expiry (90 days)</label>
                                </div>
                            </div>
                        </div>

                        <div class="admin-management">
                            <h3>IP Security</h3>
                            <div class="form-group">
                                <label class="form-label">Allowed IP Addresses (One per line)</label>
                                <textarea class="form-control form-textarea" id="allowedIPs" placeholder="Enter allowed IP addresses"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Blocked IP Addresses (One per line)</label>
                                <textarea class="form-control form-textarea" id="blockedIPs" placeholder="Enter blocked IP addresses"></textarea>
                            </div>
                        </div>

                        <div class="admin-management">
                            <h3>API Security</h3>
                            <div class="form-group">
                                <label class="form-label">API Rate Limit (Requests per minute)</label>
                                <input type="number" class="form-control" id="apiRateLimit" placeholder="Enter rate limit">
                            </div>
                            <div class="form-group">
                                <label class="form-label">API Key Expiry (Days)</label>
                                <input type="number" class="form-control" id="apiKeyExpiry" placeholder="Enter API key expiry">
                            </div>
                        </div>
                    </div>

                    <div id="notificationSettings" class="tab-content" style="display: none;">
                        <div class="admin-management">
                            <h3>Email Notifications</h3>
                            <div class="form-group">
                                <label class="form-label">SMTP Server</label>
                                <input type="text" class="form-control" id="smtpServer" placeholder="Enter SMTP server">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>SMTP Port</label>
                                    <input type="number" class="form-control" id="smtpPort" placeholder="Enter SMTP port">
                                </div>
                                <div class="form-group">
                                    <label>SMTP Username</label>
                                    <input type="text" class="form-control" id="smtpUsername" placeholder="Enter SMTP username">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">SMTP Password</label>
                                <input type="password" class="form-control" id="smtpPassword" placeholder="Enter SMTP password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notification Types</label>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="emailNotifications" checked>
                                    <label class="form-check-label" for="emailNotifications">Enable Email Notifications</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="smsNotifications">
                                    <label class="form-check-label" for="smsNotifications">Enable SMS Notifications</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="pushNotifications">
                                    <label class="form-check-label" for="pushNotifications">Enable Push Notifications</label>
                                </div>
                            </div>
                        </div>

                        <div class="admin-management">
                            <h3>Alert Settings</h3>
                            <div class="form-group">
                                <label class="form-label">System Alerts</label>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="alertHighTransactions">
                                    <label class="form-check-label" for="alertHighTransactions">High value transactions</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="alertSuspiciousActivity">
                                    <label class="form-check-label" for="alertSuspiciousActivity">Suspicious activity</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="alertSystemErrors">
                                    <label class="form-check-label" for="alertSystemErrors">System errors</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Alert Thresholds</label>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Transaction Threshold ($)</label>
                                        <input type="number" class="form-control" id="transactionThreshold" placeholder="Enter threshold">
                                    </div>
                                    <div class="form-group">
                                        <label>Login Attempt Threshold</label>
                                        <input type="number" class="form-control" id="loginAttemptThreshold" placeholder="Enter threshold">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="apiSettings" class="tab-content" style="display: none;">
                        <div class="admin-management">
                            <h3>API Configuration</h3>
                            <div class="form-group">
                                <label class="form-label">API Base URL</label>
                                <input type="url" class="form-control" id="apiBaseUrl" placeholder="Enter API base URL">
                            </div>
                            <div class="form-group">
                                <label class="form-label">API Version</label>
                                <input type="text" class="form-control" id="apiVersion" placeholder="Enter API version">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Generate New API Key</label>
                                <div style="display: flex; gap: 12px;">
                                    <input type="text" class="form-control" id="apiKeyDisplay" readonly placeholder="Click generate to create key">
                                    <button class="btn-secondary" onclick="generateAPIKey()">
                                        <i class="fas fa-key"></i>
                                        Generate
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="admin-management">
                            <h3>Webhook Configuration</h3>
                            <div class="form-group">
                                <label class="form-label">Transaction Webhook URL</label>
                                <input type="url" class="form-control" id="transactionWebhook" placeholder="Enter webhook URL">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notification Webhook URL</label>
                                <input type="url" class="form-control" id="notificationWebhook" placeholder="Enter webhook URL">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Webhook Secret Key</label>
                                <input type="text" class="form-control" id="webhookSecret" placeholder="Enter webhook secret">
                            </div>
                        </div>
                    </div>

                    <div class="admin-management">
                        <h3>System Maintenance</h3>
                        <div class="form-group">
                            <label class="form-label">Maintenance Mode</label>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="maintenanceMode">
                                <label class="form-check-label" for="maintenanceMode">Enable Maintenance Mode</label>
                            </div>
                            <textarea class="form-control form-textarea" id="maintenanceMessage" placeholder="Maintenance message (if enabled)"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data Retention (Days)</label>
                            <input type="number" class="form-control" id="dataRetention" placeholder="Enter data retention period">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Auto Backup</label>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="autoBackup">
                                <label class="form-check-label" for="autoBackup">Enable Automatic Backups</label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Backup Frequency</label>
                                    <select class="form-control" id="backupFrequency">
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Backup Time</label>
                                    <input type="time" class="form-control" id="backupTime">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="resetSettings">
                            <i class="fas fa-redo"></i>
                            Reset to Default
                        </button>
                        <button class="btn btn-primary" id="saveSettings">
                            <i class="fas fa-save"></i>
                            Save All Settings
                        </button>
                    </div>
                </section>

                <!-- Admin Management Section -->
                <section id="adminManagement" class="content-section">
                    <div class="admin-management">
                        <h3>Admin Account Management</h3>
                        <div class="admin-form">
                            <div class="form-group">
                                <label class="form-label">Current Admin Email</label>
                                <input type="email" class="form-control" id="currentAdminEmail" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">New Admin Email</label>
                                <input type="email" class="form-control" id="newAdminEmail" placeholder="Enter new admin email">
                            </div>
                            <div class="form-group">
                                <label class="form-label">New Password</label>
                                <input type="password" class="form-control" id="newAdminPassword" placeholder="Enter new password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="confirmAdminPassword" placeholder="Confirm new password">
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 24px;">
                            <button class="btn btn-warning" id="updateAdminCredentials">
                                <i class="fas fa-user-edit"></i>
                                Update Credentials
                            </button>
                            <button class="btn btn-secondary" id="testAdminLogin">
                                <i class="fas fa-sign-in-alt"></i>
                                Test Login
                            </button>
                        </div>
                    </div>

                    <div class="admin-management" style="margin-top: 24px;">
                        <h3>Create New Admin Account</h3>
                        <div class="admin-form">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="newAdminName" placeholder="Enter full name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="newAdminEmailCreate" placeholder="Enter email address">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Password</label>
                                <input type="password" class="form-control" id="newAdminPasswordCreate" placeholder="Enter password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="newAdminPasswordConfirm" placeholder="Confirm password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Admin Role</label>
                                <select class="form-control" id="newAdminRole">
                                    <option value="super_admin">Super Admin</option>
                                    <option value="admin">Admin</option>
                                    <option value="support">Support</option>
                                    <option value="viewer">Viewer</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top: 24px;">
                            <button class="btn btn-success" id="createNewAdmin">
                                <i class="fas fa-user-plus"></i>
                                Create New Admin
                            </button>
                        </div>
                    </div>

                    <div class="admin-management" style="margin-top: 24px;">
                        <h3>Existing Admin Accounts</h3>
                        <div class="loading" id="adminAccountsLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading admin accounts...</p>
                        </div>
                        <div id="adminAccountsTable" style="display: none;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Admin ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Last Login</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="adminAccountsBody">
                                    <!-- Admin accounts will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="admin-management" style="margin-top: 24px;">
                        <h3>Admin Activity Log</h3>
                        <div class="audit-trail" id="adminActivityLog">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>Loading admin activity...</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Notifications Section -->
                <section id="notifications" class="content-section">
                    <div class="admin-management">
                        <h3>Notification Center</h3>
                        <div class="tabs">
                            <button class="tab active" data-tab="allNotifications">All Notifications</button>
                            <button class="tab" data-tab="unreadNotifications">Unread</button>
                            <button class="tab" data-tab="systemNotifications">System</button>
                            <button class="tab" data-tab="userNotifications">User</button>
                        </div>

                        <div id="allNotifications" class="tab-content">
                            <div class="notification-list" id="allNotificationsList" style="max-height: 600px; overflow-y: auto;">
                                <!-- All notifications will be loaded here -->
                            </div>
                        </div>

                        <div id="unreadNotifications" class="tab-content" style="display: none;">
                            <div class="notification-list" id="unreadNotificationsList" style="max-height: 600px; overflow-y: auto;">
                                <!-- Unread notifications will be loaded here -->
                            </div>
                        </div>

                        <div id="systemNotifications" class="tab-content" style="display: none;">
                            <div class="notification-list" id="systemNotificationsList" style="max-height: 600px; overflow-y: auto;">
                                <!-- System notifications will be loaded here -->
                            </div>
                        </div>

                        <div id="userNotifications" class="tab-content" style="display: none;">
                            <div class="notification-list" id="userNotificationsList" style="max-height: 600px; overflow-y: auto;">
                                <!-- User notifications will be loaded here -->
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; margin-top: 24px;">
                            <button class="btn-secondary" id="clearNotifications">
                                <i class="fas fa-trash"></i>
                                Clear All
                            </button>
                            <button class="btn-primary" id="markAllNotificationsRead">
                                <i class="fas fa-check-double"></i>
                                Mark All as Read
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section id="analytics" class="content-section">
                    <div class="statistics-grid">
                        <div class="stat-item-card">
                            <div class="stat-item-value" id="totalRevenue">$0</div>
                            <div class="stat-item-label">Total Revenue</div>
                        </div>
                        <div class="stat-item-card">
                            <div class="stat-item-value" id="activeUsers">0</div>
                            <div class="stat-item-label">Active Users (24h)</div>
                        </div>
                        <div class="stat-item-card">
                            <div class="stat-item-value" id="avgTransaction">$0</div>
                            <div class="stat-item-label">Avg. Transaction</div>
                        </div>
                        <div class="stat-item-card">
                            <div class="stat-item-value" id="successRate">0%</div>
                            <div class="stat-item-label">Success Rate</div>
                        </div>
                    </div>

                    <div class="charts-section">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>User Growth</h3>
                                <select class="form-control" style="width: auto;" id="growthPeriod">
                                    <option value="week">Weekly</option>
                                    <option value="month" selected>Monthly</option>
                                    <option value="quarter">Quarterly</option>
                                    <option value="year">Yearly</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="userGrowthChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Revenue Sources</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="revenueSourceChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="card-grid">
                        <div class="info-card">
                            <h4>Top Performing Agents</h4>
                            <div id="topAgentsList">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <p>Loading top agents...</p>
                                </div>
                            </div>
                        </div>
                        <div class="info-card">
                            <h4>System Health</h4>
                            <div style="margin-top: 16px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>Database</span>
                                    <span class="status-indicator online">Healthy</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 95%"></div>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; margin: 16px 0 8px;">
                                    <span>API Services</span>
                                    <span class="status-indicator online">Healthy</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 98%"></div>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; margin: 16px 0 8px;">
                                    <span>Uptime</span>
                                    <span class="status-indicator online">99.9%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 99%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-card" style="margin-top: 24px;">
                        <div class="chart-header">
                            <h3>Geographic Distribution</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="geographicChart"></canvas>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <!-- Application Details Modal -->
    <div class="modal-overlay" id="appDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Application Details</h3>
                <button class="modal-close" onclick="closeModal('appDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="appDetailsContent">
                <!-- Application details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('appDetailsModal')">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button class="btn btn-danger" id="rejectAppBtn">
                    <i class="fas fa-times"></i>
                    Reject
                </button>
                <button class="btn btn-success" id="approveAppBtn">
                    <i class="fas fa-check"></i>
                    Approve
                </button>
            </div>
        </div>
    </div>

    <!-- Manual Credentials Modal -->
    <div class="modal-overlay" id="credentialsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Set Agent Credentials</h3>
                <button class="modal-close" onclick="closeModal('credentialsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="credentials-form">
                    <div class="form-group">
                        <label class="form-label">Agent Email *</label>
                        <input type="email" class="form-control" id="manualAgentEmail" placeholder="Enter agent email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Agent ID *</label>
                        <input type="text" class="form-control" id="manualAgentId" placeholder="Enter agent ID" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" class="form-control" id="manualAgentPassword" placeholder="Enter password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password *</label>
                        <input type="password" class="form-control" id="manualAgentPasswordConfirm" placeholder="Confirm password" required>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="sendWelcomeEmail">
                        <label class="form-check-label" for="sendWelcomeEmail">Send welcome email with credentials</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="generateRandomPassword">
                        <label class="form-check-label" for="generateRandomPassword">Generate random password</label>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
                    <h4 style="margin-bottom: 8px;">Application Details</h4>
                    <div id="credentialsAppInfo">
                        <!-- Application info will be loaded here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('credentialsModal')">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
                <button class="btn btn-primary" id="saveCredentialsBtn">
                    <i class="fas fa-save"></i>
                    Save & Approve
                </button>
            </div>
        </div>
    </div>

    <!-- Transaction Details Modal -->
    <div class="modal-overlay" id="transactionDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Transaction Details</h3>
                <button class="modal-close" onclick="closeModal('transactionDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="transactionDetailsContent">
                <!-- Transaction details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('transactionDetailsModal')">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button class="btn btn-danger" id="rejectTxBtn">
                    <i class="fas fa-times"></i>
                    Reject
                </button>
                <button class="btn btn-success" id="approveTxBtn">
                    <i class="fas fa-check"></i>
                    Approve
                </button>
            </div>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div class="modal-overlay" id="customerDetailsModal">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">Customer Details</h3>
                <button class="modal-close" onclick="closeModal('customerDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="customerDetailsContent">
                <!-- Customer details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('customerDetailsModal')">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button class="btn btn-warning" id="suspendCustomerBtn">
                    <i class="fas fa-ban"></i>
                    Suspend
                </button>
                <button class="btn btn-danger" id="banCustomerBtn">
                    <i class="fas fa-user-slash"></i>
                    Ban
                </button>
                <button class="btn btn-success" id="activateCustomerBtn">
                    <i class="fas fa-check"></i>
                    Activate
                </button>
            </div>
        </div>
    </div>

    <!-- Agent Details Modal -->
    <div class="modal-overlay" id="agentDetailsModal">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">Agent Details</h3>
                <button class="modal-close" onclick="closeModal('agentDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="agentDetailsContent">
                <!-- Agent details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('agentDetailsModal')">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button class="btn btn-warning" id="suspendAgentBtn">
                    <i class="fas fa-ban"></i>
                    Suspend
                </button>
                <button class="btn btn-danger" id="banAgentBtn">
                    <i class="fas fa-user-slash"></i>
                    Ban
                </button>
                <button class="btn btn-success" id="activateAgentBtn">
                    <i class="fas fa-check"></i>
                    Activate
                </button>
            </div>
        </div>
    </div>

    <!-- Dispute Details Modal -->
    <div class="modal-overlay" id="disputeDetailsModal">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">Dispute Case Details</h3>
                <button class="modal-close" onclick="closeModal('disputeDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="disputeDetailsContent">
                <!-- Dispute details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('disputeDetailsModal')">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button class="btn btn-primary" id="resolveDisputeBtn">
                    <i class="fas fa-check-circle"></i>
                    Mark as Resolved
                </button>
            </div>
        </div>
    </div>

    <!-- Ban/Suspend Modal -->
    <div class="modal-overlay" id="banModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="banModalTitle">Ban/Suspend User</h3>
                <button class="modal-close" onclick="closeModal('banModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">User Information</label>
                    <div id="banUserInfo" style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <!-- User info will be loaded here -->
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Action Type *</label>
                    <select class="form-control" id="banActionType">
                        <option value="suspend">Suspend (Temporary)</option>
                        <option value="ban">Ban (Permanent)</option>
                        <option value="warning">Warning</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Duration (if suspension)</label>
                    <select class="form-control" id="banDuration">
                        <option value="1">1 Day</option>
                        <option value="7">7 Days</option>
                        <option value="30">30 Days</option>
                        <option value="90">90 Days</option>
                        <option value="permanent">Permanent</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Reason *</label>
                    <textarea class="form-control form-textarea" id="banReason" placeholder="Enter reason for ban/suspension" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Notes</label>
                    <textarea class="form-control form-textarea" id="banNotes" placeholder="Enter any additional notes"></textarea>
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="notifyUser" checked>
                    <label class="form-check-label" for="notifyUser">Notify user about this action</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('banModal')">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
                <button class="btn btn-danger" id="confirmBanBtn">
                    <i class="fas fa-ban"></i>
                    Confirm Action
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Implementation -->
    <script>
        // ===== Firebase Configuration =====
        const firebaseConfig = {
            apiKey: "AIzaSyCWm9yvg5he7Lncy3h51n7ytOq7AZrA9gs",
            authDomain: "trucash-9fee8.firebaseapp.com",
            databaseURL: "https://trucash-9fee8-default-rtdb.firebaseio.com",
            projectId: "trucash-9fee8",
            storageBucket: "trucash-9fee8.firebasestorage.app",
            messagingSenderId: "622416212225",
            appId: "1:622416212225:web:07418a9b16f955c330ab00",
            measurementId: "G-6TEZFNFDBK"
        };

        // Initialize Firebase
        let firebaseApp, auth, db, storage;
        
        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.database();
            storage = firebase.storage();
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
            showToast('Firebase Error', 'Failed to initialize database. Please refresh.', 'error');
        }

        // ===== Application State =====
        const AppState = {
            currentUser: null,
            isAuthenticated: false,
            adminData: null,
            realTimeListeners: [],
            currentView: 'overview',
            currentAppId: null,
            currentUserId: null,
            currentAgentId: null,
            currentTransactionId: null,
            currentDisputeId: null,
            applications: [],
            agents: [],
            customers: [],
            bannedAgents: [],
            bannedCustomers: [],
            transactions: [],
            disputes: [],
            notifications: [],
            auditLogs: [],
            adminAccounts: [],
            stats: {
                totalUsers: 0,
                activeAgents: 0,
                pendingApps: 0,
                pendingTx: 0,
                bannedAgents: 0,
                bannedCustomers: 0,
                totalRevenue: 0,
                activeUsers24h: 0,
                avgTransaction: 0,
                successRate: 0
            },
            charts: {
                transactionChart: null,
                platformStatsChart: null,
                performanceChart: null,
                systemPerformanceChart: null,
                revenueChart: null,
                userGrowthChart: null,
                revenueSourceChart: null,
                geographicChart: null
            },
            filters: {
                applications: {},
                agents: {},
                customers: {},
                transactions: {},
                disputes: {},
                audit: {}
            },
            settings: null
        };

        // ===== Utility Functions =====
        const Utils = {
            formatDate: (timestamp) => {
                if (!timestamp) return 'N/A';
                try {
                    const date = new Date(timestamp);
                    if (isNaN(date.getTime())) return 'Invalid Date';
                    return date.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (error) {
                    return 'Invalid Date';
                }
            },
            
            formatDateOnly: (timestamp) => {
                if (!timestamp) return 'N/A';
                try {
                    const date = new Date(timestamp);
                    if (isNaN(date.getTime())) return 'Invalid Date';
                    return date.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                } catch (error) {
                    return 'Invalid Date';
                }
            },
            
            formatTime: (timestamp) => {
                if (!timestamp) return 'N/A';
                try {
                    const date = new Date(timestamp);
                    if (isNaN(date.getTime())) return 'Invalid Time';
                    return date.toLocaleTimeString('en-US', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (error) {
                    return 'Invalid Time';
                }
            },
            
            formatCurrency: (amount) => {
                if (amount === undefined || amount === null) return '$0.00';
                const numAmount = parseFloat(amount);
                if (isNaN(numAmount)) return '$0.00';
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(numAmount);
            },
            
            formatNumber: (number) => {
                if (number === undefined || number === null) return '0';
                const num = parseFloat(number);
                if (isNaN(num)) return '0';
                return new Intl.NumberFormat('en-US').format(num);
            },
            
            formatPercentage: (value) => {
                if (value === undefined || value === null) return '0%';
                const numValue = parseFloat(value);
                if (isNaN(numValue)) return '0%';
                return `${numValue.toFixed(2)}%`;
            },
            
            showToast: (title, message, type = 'info', duration = 5000) => {
                const toastContainer = document.querySelector('.toast-container');
                if (!toastContainer) return;
                
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    </div>
                    <div class="toast-content">
                        <div class="toast-title">${title}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                    <button class="toast-close">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                toastContainer.appendChild(toast);
                
                // Auto remove after duration
                const autoRemove = setTimeout(() => {
                    if (toast.parentNode) {
                        toast.style.animation = 'slideInRight 0.3s ease reverse';
                        setTimeout(() => toast.remove(), 300);
                    }
                }, duration);
                
                // Close button
                toast.querySelector('.toast-close').addEventListener('click', () => {
                    clearTimeout(autoRemove);
                    toast.style.animation = 'slideInRight 0.3s ease reverse';
                    setTimeout(() => toast.remove(), 300);
                });
                
                // Return toast element for manual removal
                return toast;
            },
            
            showLoading: (elementId) => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.style.display = 'flex';
                }
            },
            
            hideLoading: (elementId) => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.style.display = 'none';
                }
            },
            
            showElement: (elementId) => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.style.display = 'block';
                }
            },
            
            hideElement: (elementId) => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.style.display = 'none';
                }
            },
            
            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },
            
            generateId: (prefix) => {
                const timestamp = Date.now().toString(36);
                const random = Math.random().toString(36).substr(2, 5);
                return `${prefix}_${timestamp}_${random}`.toUpperCase();
            },
            
            validateEmail: (email) => {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            },
            
            validatePassword: (password) => {
                return password.length >= 8;
            },
            
            copyToClipboard: (text) => {
                navigator.clipboard.writeText(text).then(() => {
                    Utils.showToast('Copied', 'Text copied to clipboard', 'success');
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                });
            },
            
            generatePassword: (length = 12) => {
                const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";
                let password = "";
                for (let i = 0; i < length; i++) {
                    password += charset.charAt(Math.floor(Math.random() * charset.length));
                }
                return password;
            },
            
            generateAgentId: () => {
                const prefix = 'AG';
                const timestamp = Date.now().toString().slice(-6);
                const random = Math.random().toString(36).substr(2, 3).toUpperCase();
                return `${prefix}${timestamp}${random}`;
            },
            
            formatPhoneNumber: (phone) => {
                if (!phone) return 'N/A';
                // Remove all non-digit characters
                const cleaned = phone.toString().replace(/\D/g, '');
                // Format as (XXX) XXX-XXXX
                if (cleaned.length === 10) {
                    return `(${cleaned.slice(0, 3)}) ${cleaned.slice(3, 6)}-${cleaned.slice(6)}`;
                }
                return phone;
            },
            
            truncateText: (text, maxLength = 50) => {
                if (!text) return '';
                if (text.length <= maxLength) return text;
                return text.substr(0, maxLength) + '...';
            },
            
            getStatusColor: (status) => {
                switch(status?.toLowerCase()) {
                    case 'active':
                    case 'approved':
                    case 'completed':
                    case 'verified':
                        return 'success';
                    case 'pending':
                    case 'processing':
                    case 'review':
                        return 'warning';
                    case 'suspended':
                    case 'rejected':
                    case 'failed':
                        return 'danger';
                    case 'banned':
                    case 'blocked':
                        return 'danger';
                    default:
                        return 'info';
                }
            },
            
            getStatusBadge: (status) => {
                const color = Utils.getStatusColor(status);
                return `<span class="status-badge status-${color}">${status || 'Unknown'}</span>`;
            },
            
            calculateAge: (timestamp) => {
                if (!timestamp) return 'N/A';
                const birthDate = new Date(timestamp);
                if (isNaN(birthDate.getTime())) return 'N/A';
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                return age;
            },
            
            parseJSON: (str, defaultValue = {}) => {
                try {
                    return JSON.parse(str);
                } catch (error) {
                    return defaultValue;
                }
            },
            
            isObjectEmpty: (obj) => {
                return Object.keys(obj || {}).length === 0;
            },
            
            deepClone: (obj) => {
                return JSON.parse(JSON.stringify(obj));
            },
            
            getTimeAgo: (timestamp) => {
                if (!timestamp) return 'N/A';
                const date = new Date(timestamp);
                if (isNaN(date.getTime())) return 'N/A';
                
                const now = new Date();
                const seconds = Math.floor((now - date) / 1000);
                
                let interval = Math.floor(seconds / 31536000);
                if (interval >= 1) {
                    return interval === 1 ? '1 year ago' : `${interval} years ago`;
                }
                interval = Math.floor(seconds / 2592000);
                if (interval >= 1) {
                    return interval === 1 ? '1 month ago' : `${interval} months ago`;
                }
                interval = Math.floor(seconds / 86400);
                if (interval >= 1) {
                    return interval === 1 ? '1 day ago' : `${interval} days ago`;
                }
                interval = Math.floor(seconds / 3600);
                if (interval >= 1) {
                    return interval === 1 ? '1 hour ago' : `${interval} hours ago`;
                }
                interval = Math.floor(seconds / 60);
                if (interval >= 1) {
                    return interval === 1 ? '1 minute ago' : `${interval} minutes ago`;
                }
                return seconds <= 10 ? 'just now' : `${seconds} seconds ago`;
            }
        };

        // ===== Firebase Service =====
        const FirebaseService = {
            // Authentication
            async checkAuth() {
                return new Promise((resolve) => {
                    auth.onAuthStateChanged(async (user) => {
                        if (user) {
                            AppState.currentUser = user;
                            AppState.isAuthenticated = true;
                            
                            // Check if user is admin
                            const adminRef = db.ref('users/' + user.uid);
                            const snapshot = await adminRef.once('value');
                            
                            if (snapshot.exists()) {
                                const userData = snapshot.val();
                                if (userData.userType === 'admin') {
                                    AppState.adminData = userData;
                                    await this.updateAdminLoginTime(user.uid);
                                    this.updateAdminUI();
                                    this.setupRealTimeListeners();
                                    resolve(true);
                                } else {
                                    // Not an admin, redirect to login
                                    await auth.signOut();
                                    window.location.href = 'index.html';
                                    resolve(false);
                                }
                            } else {
                                // User data not found
                                await auth.signOut();
                                window.location.href = 'index.html';
                                resolve(false);
                            }
                        } else {
                            // Not authenticated, redirect to login
                            window.location.href = 'index.html';
                            resolve(false);
                        }
                    });
                });
            },
            
            async updateAdminLoginTime(uid) {
                try {
                    const adminRef = db.ref('users/' + uid);
                    await adminRef.update({
                        lastLogin: Date.now(),
                        lastLoginIP: await this.getClientIP()
                    });
                    
                    // Log admin login
                    await this.createAuditLog({
                        action: 'ADMIN_LOGIN',
                        targetId: uid,
                        targetType: 'admin',
                        performedBy: uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            timestamp: Date.now(),
                            userAgent: navigator.userAgent
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                } catch (error) {
                    console.error('Error updating admin login time:', error);
                }
            },
            
            async getClientIP() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    return data.ip;
                } catch (error) {
                    return 'Unknown';
                }
            },
            
            async loadAdminData(uid) {
                try {
                    const adminRef = db.ref('users/' + uid);
                    const snapshot = await adminRef.once('value');
                    if (snapshot.exists()) {
                        AppState.adminData = snapshot.val();
                        this.updateAdminUI();
                    }
                } catch (error) {
                    console.error('Error loading admin data:', error);
                }
            },
            
            async logout() {
                try {
                    // Log logout action
                    await this.createAuditLog({
                        action: 'ADMIN_LOGOUT',
                        targetId: AppState.currentUser.uid,
                        targetType: 'admin',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {},
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    await auth.signOut();
                    window.location.href = 'index.html';
                } catch (error) {
                    console.error('Logout error:', error);
                    Utils.showToast('Logout Failed', 'Please try again', 'error');
                }
            },
            
            // Real-time Listeners
            setupRealTimeListeners() {
                // Listen for applications
                const appsRef = db.ref('agentApplications');
                appsRef.on('value', (snapshot) => {
                    this.handleApplicationsUpdate(snapshot);
                });
                AppState.realTimeListeners.push(appsRef);
                
                // Listen for agents
                const agentsRef = db.ref('agents');
                agentsRef.on('value', (snapshot) => {
                    this.handleAgentsUpdate(snapshot);
                });
                AppState.realTimeListeners.push(agentsRef);
                
                // Listen for users
                const usersRef = db.ref('users');
                usersRef.on('value', (snapshot) => {
                    this.handleUsersUpdate(snapshot);
                });
                AppState.realTimeListeners.push(usersRef);
                
                // Listen for transactions
                const transactionsRef = db.ref('transactions');
                transactionsRef.on('value', (snapshot) => {
                    this.handleTransactionsUpdate(snapshot);
                });
                AppState.realTimeListeners.push(transactionsRef);
                
                // Listen for disputes
                const disputesRef = db.ref('disputes');
                disputesRef.on('value', (snapshot) => {
                    this.handleDisputesUpdate(snapshot);
                });
                AppState.realTimeListeners.push(disputesRef);
                
                // Listen for notifications
                const notificationsRef = db.ref('adminNotifications');
                notificationsRef.on('value', (snapshot) => {
                    this.handleNotificationsUpdate(snapshot);
                });
                AppState.realTimeListeners.push(notificationsRef);
                
                // Listen for audit logs
                const auditRef = db.ref('auditLogs');
                auditRef.on('value', (snapshot) => {
                    this.handleAuditLogsUpdate(snapshot);
                });
                AppState.realTimeListeners.push(auditRef);
                
                // Listen for system stats
                const statsRef = db.ref('systemStats');
                statsRef.on('value', (snapshot) => {
                    this.handleStatsUpdate(snapshot);
                });
                AppState.realTimeListeners.push(statsRef);
                
                // Listen for admin accounts
                const adminRef = db.ref('users').orderByChild('userType').equalTo('admin');
                adminRef.on('value', (snapshot) => {
                    this.handleAdminAccountsUpdate(snapshot);
                });
                AppState.realTimeListeners.push(adminRef);
                
                console.log('Real-time listeners setup complete');
            },
            
            // Data Handlers
            handleApplicationsUpdate(snapshot) {
                AppState.applications = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        const app = child.val();
                        if (app.status === 'pending' || app.status === 'reviewed') {
                            AppState.applications.push({
                                id: child.key,
                                ...app
                            });
                        }
                    });
                }
                updateApplicationsUI();
                updateStats();
            },
            
            handleAgentsUpdate(snapshot) {
                AppState.agents = [];
                AppState.bannedAgents = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        const agent = child.val();
                        agent.id = child.key;
                        
                        if (agent.status === 'active') {
                            AppState.agents.push(agent);
                        } else if (agent.status === 'suspended' || agent.status === 'banned') {
                            AppState.bannedAgents.push(agent);
                        }
                    });
                }
                updateAgentsUI();
                updateBannedAgentsUI();
                updateStats();
            },
            
            handleUsersUpdate(snapshot) {
                AppState.customers = [];
                AppState.bannedCustomers = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        const user = child.val();
                        user.id = child.key;
                        
                        if (user.userType === 'customer') {
                            if (user.status === 'active' || !user.status) {
                                AppState.customers.push(user);
                            } else if (user.status === 'suspended' || user.status === 'banned') {
                                AppState.bannedCustomers.push(user);
                            }
                        }
                    });
                }
                updateCustomersUI();
                updateBannedCustomersUI();
                updateStats();
            },
            
            handleTransactionsUpdate(snapshot) {
                AppState.transactions = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        AppState.transactions.push({
                            id: child.key,
                            ...child.val()
                        });
                    });
                }
                updateTransactionsUI();
                updateStats();
            },
            
            handleDisputesUpdate(snapshot) {
                AppState.disputes = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        const dispute = child.val();
                        if (dispute.status !== 'resolved' && dispute.status !== 'closed') {
                            AppState.disputes.push({
                                id: child.key,
                                ...dispute
                            });
                        }
                    });
                }
                updateDisputesUI();
                updateStats();
            },
            
            handleNotificationsUpdate(snapshot) {
                AppState.notifications = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        AppState.notifications.push({
                            id: child.key,
                            ...child.val()
                        });
                    });
                }
                updateNotificationsUI();
            },
            
            handleAuditLogsUpdate(snapshot) {
                AppState.auditLogs = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        AppState.auditLogs.push({
                            id: child.key,
                            ...child.val()
                        });
                    });
                }
                updateAuditLogsUI();
            },
            
            handleAdminAccountsUpdate(snapshot) {
                AppState.adminAccounts = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        const admin = child.val();
                        if (admin.userType === 'admin') {
                            AppState.adminAccounts.push({
                                id: child.key,
                                ...admin
                            });
                        }
                    });
                }
                updateAdminAccountsUI();
            },
            
            handleStatsUpdate(snapshot) {
                if (snapshot.exists()) {
                    AppState.stats = { ...AppState.stats, ...snapshot.val() };
                    updateDashboardStats();
                }
            },
            
            // Application Management
            async getApplicationDetails(appId) {
                try {
                    const appRef = db.ref('agentApplications/' + appId);
                    const snapshot = await appRef.once('value');
                    if (snapshot.exists()) {
                        return { success: true, data: snapshot.val() };
                    } else {
                        return { success: false, error: 'Application not found' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async approveApplication(appId, credentials) {
                try {
                    // Get application details first
                    const appResult = await this.getApplicationDetails(appId);
                    if (!appResult.success) {
                        throw new Error(appResult.error);
                    }
                    
                    const application = appResult.data;
                    
                    // Validate credentials
                    if (!credentials.email || !Utils.validateEmail(credentials.email)) {
                        throw new Error('Invalid email address');
                    }
                    
                    if (!credentials.password || !Utils.validatePassword(credentials.password)) {
                        throw new Error('Password must be at least 8 characters long');
                    }
                    
                    if (!credentials.agentId || credentials.agentId.length < 3) {
                        throw new Error('Agent ID must be at least 3 characters');
                    }
                    
                    // Check if email already exists
                    try {
                        const existingUser = await auth.fetchSignInMethodsForEmail(credentials.email);
                        if (existingUser && existingUser.length > 0) {
                            throw new Error('Email already exists');
                        }
                    } catch (error) {
                        // Email doesn't exist, continue
                    }
                    
                    // Check if agent ID already exists
                    const agentsRef = db.ref('agents');
                    const agentsSnapshot = await agentsRef.orderByChild('agentId').equalTo(credentials.agentId).once('value');
                    if (agentsSnapshot.exists()) {
                        throw new Error('Agent ID already exists');
                    }
                    
                    // Update application status
                    const appRef = db.ref('agentApplications/' + appId);
                    await appRef.update({
                        status: 'approved',
                        reviewedAt: Date.now(),
                        reviewedBy: AppState.currentUser.email,
                        assignedCredentials: {
                            email: credentials.email,
                            agentId: credentials.agentId
                        }
                    });
                    
                    // Create agent account in Firebase Auth
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        credentials.email,
                        credentials.password
                    );
                    
                    // Prepare agent data
                    const agentData = {
                        uid: userCredential.user.uid,
                        fullName: application.fullName,
                        email: credentials.email,
                        phone: application.phone,
                        residence: application.residence,
                        nrc: application.nrc,
                        nrcFront: application.nrcFront,
                        nrcBack: application.nrcBack,
                        profilePhoto: application.profilePhoto,
                        additionalDoc: application.additionalDoc || '',
                        userType: 'agent',
                        agentId: credentials.agentId,
                        status: 'active',
                        applicationId: appId,
                        createdAt: Date.now(),
                        updatedAt: Date.now(),
                        lastLogin: null,
                        emailVerified: false,
                        totalClients: 0,
                        totalLoans: 0,
                        totalTransactions: 0,
                        commissionEarned: 0,
                        performance: {
                            successRate: 0,
                            completionRate: 0,
                            avgProcessingTime: 0,
                            rating: 0,
                            reviews: 0
                        },
                        settings: {
                            notifications: true,
                            autoConfirm: false,
                            maxLoanAmount: 1000
                        }
                    };
                    
                    // Save to users
                    const userRef = db.ref('users/' + userCredential.user.uid);
                    await userRef.set(agentData);
                    
                    // Add to agents list
                    const agentsListRef = db.ref('agents/' + userCredential.user.uid);
                    await agentsListRef.set({
                        ...agentData,
                        performance: {
                            clients: 0,
                            loans: 0,
                            transactions: 0,
                            successRate: 0,
                            revenue: 0
                        }
                    });
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'APPROVE_APPLICATION',
                        targetId: appId,
                        targetType: 'agent_application',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            applicationId: appId,
                            applicantName: application.fullName,
                            assignedEmail: credentials.email,
                            assignedAgentId: credentials.agentId
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    // Create notification
                    await this.createNotification({
                        type: 'application_approved',
                        title: 'Application Approved',
                        message: `Agent application ${appId} has been approved for ${application.fullName}`,
                        recipient: 'admin',
                        data: {
                            appId: appId,
                            applicantName: application.fullName,
                            agentId: credentials.agentId
                        },
                        timestamp: Date.now(),
                        read: false,
                        priority: 'medium'
                    });
                    
                    // Send welcome email if enabled
                    if (credentials.sendWelcomeEmail) {
                        await this.sendWelcomeEmail(credentials.email, credentials.agentId, credentials.password);
                    }
                    
                    return { 
                        success: true, 
                        data: {
                            agentId: credentials.agentId,
                            email: credentials.email,
                            password: credentials.password
                        }
                    };
                } catch (error) {
                    console.error('Error approving application:', error);
                    return { success: false, error: error.message };
                }
            },
            
            async rejectApplication(appId, reason) {
                try {
                    // Get application details
                    const appResult = await this.getApplicationDetails(appId);
                    if (!appResult.success) {
                        throw new Error(appResult.error);
                    }
                    
                    const application = appResult.data;
                    
                    // Update application status
                    const appRef = db.ref('agentApplications/' + appId);
                    await appRef.update({
                        status: 'rejected',
                        reviewedAt: Date.now(),
                        reviewedBy: AppState.currentUser.email,
                        rejectionReason: reason
                    });
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'REJECT_APPLICATION',
                        targetId: appId,
                        targetType: 'agent_application',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            applicationId: appId,
                            applicantName: application.fullName,
                            rejectionReason: reason
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    // Create notification
                    await this.createNotification({
                        type: 'application_rejected',
                        title: 'Application Rejected',
                        message: `Agent application ${appId} has been rejected`,
                        recipient: 'admin',
                        data: {
                            appId: appId,
                            applicantName: application.fullName,
                            reason: reason
                        },
                        timestamp: Date.now(),
                        read: false,
                        priority: 'medium'
                    });
                    
                    return { success: true };
                } catch (error) {
                    console.error('Error rejecting application:', error);
                    return { success: false, error: error.message };
                }
            },
            
            // Agent Management
            async getAgentDetails(agentId) {
                try {
                    const agentRef = db.ref('agents/' + agentId);
                    const snapshot = await agentRef.once('value');
                    if (snapshot.exists()) {
                        return { success: true, data: snapshot.val() };
                    } else {
                        return { success: false, error: 'Agent not found' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async suspendAgent(agentId, reason, duration = 7) {
                try {
                    const agentRef = db.ref('agents/' + agentId);
                    const userRef = db.ref('users/' + agentId);
                    
                    const suspensionData = {
                        status: 'suspended',
                        suspensionReason: reason,
                        suspendedAt: Date.now(),
                        suspendedBy: AppState.currentUser.email,
                        suspensionEnd: duration === 'permanent' ? null : Date.now() + (duration * 24 * 60 * 60 * 1000),
                        suspensionDuration: duration
                    };
                    
                    await agentRef.update(suspensionData);
                    await userRef.update(suspensionData);
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'SUSPEND_AGENT',
                        targetId: agentId,
                        targetType: 'agent',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            agentId: agentId,
                            reason: reason,
                            duration: duration
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    // Create notification
                    await this.createNotification({
                        type: 'agent_suspended',
                        title: 'Agent Suspended',
                        message: `Agent ${agentId} has been suspended`,
                        recipient: 'admin',
                        data: {
                            agentId: agentId,
                            reason: reason,
                            duration: duration
                        },
                        timestamp: Date.now(),
                        read: false,
                        priority: 'high'
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async banAgent(agentId, reason) {
                try {
                    const agentRef = db.ref('agents/' + agentId);
                    const userRef = db.ref('users/' + agentId);
                    
                    const banData = {
                        status: 'banned',
                        banReason: reason,
                        bannedAt: Date.now(),
                        bannedBy: AppState.currentUser.email,
                        banType: 'permanent'
                    };
                    
                    await agentRef.update(banData);
                    await userRef.update(banData);
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'BAN_AGENT',
                        targetId: agentId,
                        targetType: 'agent',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            agentId: agentId,
                            reason: reason
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    // Create notification
                    await this.createNotification({
                        type: 'agent_banned',
                        title: 'Agent Banned',
                        message: `Agent ${agentId} has been permanently banned`,
                        recipient: 'admin',
                        data: {
                            agentId: agentId,
                            reason: reason
                        },
                        timestamp: Date.now(),
                        read: false,
                        priority: 'high'
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async activateAgent(agentId) {
                try {
                    const agentRef = db.ref('agents/' + agentId);
                    const userRef = db.ref('users/' + agentId);
                    
                    const activationData = {
                        status: 'active',
                        suspensionReason: null,
                        suspendedAt: null,
                        suspendedBy: null,
                        suspensionEnd: null,
                        suspensionDuration: null,
                        banReason: null,
                        bannedAt: null,
                        bannedBy: null,
                        banType: null
                    };
                    
                    await agentRef.update(activationData);
                    await userRef.update(activationData);
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'ACTIVATE_AGENT',
                        targetId: agentId,
                        targetType: 'agent',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            agentId: agentId
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // Customer Management
            async getCustomerDetails(customerId) {
                try {
                    const customerRef = db.ref('users/' + customerId);
                    const snapshot = await customerRef.once('value');
                    if (snapshot.exists()) {
                        return { success: true, data: snapshot.val() };
                    } else {
                        return { success: false, error: 'Customer not found' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async suspendCustomer(customerId, reason, duration = 7) {
                try {
                    const customerRef = db.ref('users/' + customerId);
                    
                    const suspensionData = {
                        status: 'suspended',
                        suspensionReason: reason,
                        suspendedAt: Date.now(),
                        suspendedBy: AppState.currentUser.email,
                        suspensionEnd: duration === 'permanent' ? null : Date.now() + (duration * 24 * 60 * 60 * 1000),
                        suspensionDuration: duration
                    };
                    
                    await customerRef.update(suspensionData);
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'SUSPEND_CUSTOMER',
                        targetId: customerId,
                        targetType: 'customer',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            customerId: customerId,
                            reason: reason,
                            duration: duration
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async banCustomer(customerId, reason) {
                try {
                    const customerRef = db.ref('users/' + customerId);
                    
                    const banData = {
                        status: 'banned',
                        banReason: reason,
                        bannedAt: Date.now(),
                        bannedBy: AppState.currentUser.email,
                        banType: 'permanent'
                    };
                    
                    await customerRef.update(banData);
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'BAN_CUSTOMER',
                        targetId: customerId,
                        targetType: 'customer',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            customerId: customerId,
                            reason: reason
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async activateCustomer(customerId) {
                try {
                    const customerRef = db.ref('users/' + customerId);
                    
                    const activationData = {
                        status: 'active',
                        suspensionReason: null,
                        suspendedAt: null,
                        suspendedBy: null,
                        suspensionEnd: null,
                        suspensionDuration: null,
                        banReason: null,
                        bannedAt: null,
                        bannedBy: null,
                        banType: null
                    };
                    
                    await customerRef.update(activationData);
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'ACTIVATE_CUSTOMER',
                        targetId: customerId,
                        targetType: 'customer',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            customerId: customerId
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // Transaction Management
            async approveTransaction(txId, notes = '') {
                try {
                    const txRef = db.ref('transactions/' + txId);
                    await txRef.update({
                        status: 'approved',
                        reviewedAt: Date.now(),
                        reviewedBy: AppState.currentUser.email,
                        adminNotes: notes
                    });
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'APPROVE_TRANSACTION',
                        targetId: txId,
                        targetType: 'transaction',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            transactionId: txId,
                            notes: notes
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async rejectTransaction(txId, reason) {
                try {
                    const txRef = db.ref('transactions/' + txId);
                    await txRef.update({
                        status: 'rejected',
                        reviewedAt: Date.now(),
                        reviewedBy: AppState.currentUser.email,
                        rejectionReason: reason
                    });
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'REJECT_TRANSACTION',
                        targetId: txId,
                        targetType: 'transaction',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            transactionId: txId,
                            reason: reason
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // Dispute Management
            async resolveDispute(disputeId, resolution, notes = '') {
                try {
                    const disputeRef = db.ref('disputes/' + disputeId);
                    await disputeRef.update({
                        status: 'resolved',
                        resolvedAt: Date.now(),
                        resolvedBy: AppState.currentUser.email,
                        resolution: resolution,
                        resolutionNotes: notes
                    });
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'RESOLVE_DISPUTE',
                        targetId: disputeId,
                        targetType: 'dispute',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            disputeId: disputeId,
                            resolution: resolution,
                            notes: notes
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // Admin Management
            async updateAdminCredentials(email, password) {
                try {
                    const user = AppState.currentUser;
                    
                    // Update email
                    if (email && email !== user.email) {
                        await user.updateEmail(email);
                    }
                    
                    // Update password
                    if (password) {
                        await user.updatePassword(password);
                    }
                    
                    // Update in database
                    const adminRef = db.ref('users/' + user.uid);
                    await adminRef.update({
                        email: email || user.email,
                        updatedAt: Date.now()
                    });
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'UPDATE_ADMIN_CREDENTIALS',
                        targetId: user.uid,
                        targetType: 'admin',
                        performedBy: user.uid,
                        performedByEmail: user.email,
                        details: {
                            emailUpdated: !!email,
                            passwordUpdated: !!password
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async createNewAdmin(email, password, name, role) {
                try {
                    // Validate input
                    if (!Utils.validateEmail(email)) {
                        throw new Error('Invalid email address');
                    }
                    
                    if (!Utils.validatePassword(password)) {
                        throw new Error('Password must be at least 8 characters long');
                    }
                    
                    if (!name || name.trim().length < 2) {
                        throw new Error('Name must be at least 2 characters long');
                    }
                    
                    // Check if email already exists
                    try {
                        const existingUser = await auth.fetchSignInMethodsForEmail(email);
                        if (existingUser && existingUser.length > 0) {
                            throw new Error('Email already exists');
                        }
                    } catch (error) {
                        // Email doesn't exist, continue
                    }
                    
                    // Create user in Firebase Auth
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    
                    // Prepare admin data
                    const adminData = {
                        uid: userCredential.user.uid,
                        fullName: name,
                        email: email,
                        userType: 'admin',
                        role: role,
                        status: 'active',
                        createdAt: Date.now(),
                        updatedAt: Date.now(),
                        lastLogin: null,
                        createdBy: AppState.currentUser.email,
                        permissions: this.getAdminPermissions(role)
                    };
                    
                    // Save to database
                    const adminRef = db.ref('users/' + userCredential.user.uid);
                    await adminRef.set(adminData);
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'CREATE_ADMIN_ACCOUNT',
                        targetId: userCredential.user.uid,
                        targetType: 'admin',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            email: email,
                            name: name,
                            role: role
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true, adminId: userCredential.user.uid };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            getAdminPermissions(role) {
                const permissions = {
                    super_admin: ['all'],
                    admin: ['read', 'write', 'delete', 'approve', 'reject'],
                    support: ['read', 'write'],
                    viewer: ['read']
                };
                
                return permissions[role] || ['read'];
            },
            
            // Settings Management
            async loadSettings() {
                try {
                    const settingsRef = db.ref('systemSettings');
                    const snapshot = await settingsRef.once('value');
                    if (snapshot.exists()) {
                        AppState.settings = snapshot.val();
                        return { success: true, settings: AppState.settings };
                    } else {
                        // Create default settings
                        const defaultSettings = this.getDefaultSettings();
                        await settingsRef.set(defaultSettings);
                        AppState.settings = defaultSettings;
                        return { success: true, settings: defaultSettings };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            getDefaultSettings() {
                return {
                    general: {
                        systemName: 'TruCash',
                        supportEmail: 'support@trucash.com',
                        supportPhone: '+1-800-TRU-CASH',
                        timezone: 'UTC',
                        currency: 'USD',
                        language: 'en'
                    },
                    transactions: {
                        minAmount: 10,
                        maxAmount: 10000,
                        dailyLimit: 5000,
                        monthlyLimit: 50000,
                        transactionFee: 1.5,
                        processingFee: 0.5
                    },
                    commissions: {
                        standard: 5,
                        premium: 7,
                        referral: 10,
                        cycle: 'monthly'
                    },
                    penalties: {
                        latePayment: 2,
                        gracePeriod: 7,
                        overdraftLimit: 100
                    },
                    loans: {
                        minAmount: 100,
                        maxAmount: 5000,
                        interestRate: 10,
                        term: 30
                    },
                    security: {
                        enable2FA: false,
                        sessionTimeout: 30,
                        maxLoginAttempts: 5,
                        requireStrongPassword: true,
                        passwordExpiry: 90
                    },
                    notifications: {
                        email: true,
                        sms: false,
                        push: true,
                        alertHighTransactions: true,
                        alertSuspiciousActivity: true,
                        alertSystemErrors: true,
                        transactionThreshold: 1000,
                        loginAttemptThreshold: 3
                    },
                    maintenance: {
                        enabled: false,
                        message: '',
                        dataRetention: 365,
                        autoBackup: true,
                        backupFrequency: 'daily',
                        backupTime: '02:00'
                    },
                    api: {
                        baseUrl: 'https://api.trucash.com',
                        version: 'v1',
                        rateLimit: 60,
                        keyExpiry: 90
                    }
                };
            },
            
            async saveSettings(settings) {
                try {
                    const settingsRef = db.ref('systemSettings');
                    await settingsRef.set(settings);
                    AppState.settings = settings;
                    
                    // Create audit log
                    await this.createAuditLog({
                        action: 'UPDATE_SETTINGS',
                        targetId: 'system_settings',
                        targetType: 'settings',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: settings,
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // Audit Logs
            async createAuditLog(logData) {
                try {
                    const logId = Utils.generateId('AUDIT');
                    const logRef = db.ref('auditLogs/' + logId);
                    await logRef.set(logData);
                    
                    // Limit audit logs to last 1000 entries
                    const logsRef = db.ref('auditLogs');
                    const snapshot = await logsRef.orderByKey().limitToFirst(1000).once('value');
                    const logs = [];
                    snapshot.forEach(child => {
                        logs.push({ key: child.key, ...child.val() });
                    });
                    
                    // Remove old logs if more than 1000
                    if (logs.length > 1000) {
                        const oldLogs = logs.slice(0, logs.length - 1000);
                        const updates = {};
                        oldLogs.forEach(log => {
                            updates[log.key] = null;
                        });
                        await logsRef.update(updates);
                    }
                    
                    return { success: true };
                } catch (error) {
                    console.error('Error creating audit log:', error);
                    return { success: false };
                }
            },
            
            // Notifications
            async createNotification(notificationData) {
                try {
                    const notificationId = Utils.generateId('NOTIF');
                    const notificationRef = db.ref('adminNotifications/' + notificationId);
                    await notificationRef.set(notificationData);
                    return { success: true };
                } catch (error) {
                    console.error('Error creating notification:', error);
                    return { success: false };
                }
            },
            
            async markNotificationRead(notificationId) {
                try {
                    const notificationRef = db.ref('adminNotifications/' + notificationId);
                    await notificationRef.update({ read: true });
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async markAllNotificationsRead() {
                try {
                    const updates = {};
                    AppState.notifications.forEach(notification => {
                        if (!notification.read) {
                            updates[`${notification.id}/read`] = true;
                        }
                    });
                    
                    if (Object.keys(updates).length > 0) {
                        await db.ref('adminNotifications').update(updates);
                    }
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async clearAllNotifications() {
                try {
                    await db.ref('adminNotifications').remove();
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // Email Service
            async sendWelcomeEmail(email, agentId, password) {
                // This is a placeholder for email service integration
                // In production, integrate with your email service (SendGrid, Mailgun, etc.)
                console.log(`Welcome email sent to ${email} with agent ID: ${agentId}`);
                return { success: true };
            },
            
            // UI Updates
            updateAdminUI() {
                if (AppState.adminData && AppState.currentUser) {
                    const adminName = document.getElementById('adminName');
                    const adminEmail = document.getElementById('adminEmail');
                    const adminAvatar = document.getElementById('adminAvatar');
                    const currentAdminEmail = document.getElementById('currentAdminEmail');
                    
                    if (adminName) adminName.textContent = AppState.adminData.fullName || 'Admin';
                    if (adminEmail) adminEmail.textContent = AppState.currentUser.email;
                    if (currentAdminEmail) currentAdminEmail.value = AppState.currentUser.email;
                    if (adminAvatar) {
                        const initials = AppState.adminData.fullName
                            ? AppState.adminData.fullName.split(' ').map(n => n[0]).join('').toUpperCase()
                            : 'A';
                        adminAvatar.textContent = initials;
                    }
                }
            },
            
            // Cleanup
            cleanupListeners() {
                AppState.realTimeListeners.forEach(ref => ref.off());
                AppState.realTimeListeners = [];
            },
            
            // Export Data
            async exportData(type, filters = {}) {
                try {
                    let data = [];
                    let filename = '';
                    
                    switch(type) {
                        case 'applications':
                            data = AppState.applications;
                            filename = `applications_${Date.now()}.json`;
                            break;
                        case 'agents':
                            data = AppState.agents;
                            filename = `agents_${Date.now()}.json`;
                            break;
                        case 'customers':
                            data = AppState.customers;
                            filename = `customers_${Date.now()}.json`;
                            break;
                        case 'transactions':
                            data = AppState.transactions;
                            filename = `transactions_${Date.now()}.json`;
                            break;
                        case 'disputes':
                            data = AppState.disputes;
                            filename = `disputes_${Date.now()}.json`;
                            break;
                        case 'audit':
                            data = AppState.auditLogs;
                            filename = `audit_logs_${Date.now()}.json`;
                            break;
                        default:
                            throw new Error('Invalid export type');
                    }
                    
                    // Apply filters if any
                    if (!Utils.isObjectEmpty(filters)) {
                        data = this.applyFilters(data, filters);
                    }
                    
                    // Create JSON string
                    const jsonString = JSON.stringify(data, null, 2);
                    
                    // Create download link
                    const blob = new Blob([jsonString], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // Log export
                    await this.createAuditLog({
                        action: 'EXPORT_DATA',
                        targetId: type,
                        targetType: 'export',
                        performedBy: AppState.currentUser.uid,
                        performedByEmail: AppState.currentUser.email,
                        details: {
                            type: type,
                            count: data.length,
                            filters: filters
                        },
                        timestamp: Date.now(),
                        ipAddress: await this.getClientIP()
                    });
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            applyFilters(data, filters) {
                return data.filter(item => {
                    for (const key in filters) {
                        if (filters[key] && item[key] !== filters[key]) {
                            return false;
                        }
                    }
                    return true;
                });
            }
        };

        // ===== UI Update Functions =====
        function updateDashboardStats() {
            // Update stats cards
            document.getElementById('totalUsers').textContent = Utils.formatNumber(AppState.stats.totalUsers || AppState.customers.length);
            document.getElementById('activeAgents').textContent = Utils.formatNumber(AppState.stats.activeAgents || AppState.agents.length);
            document.getElementById('pendingApps').textContent = Utils.formatNumber(AppState.stats.pendingApps || AppState.applications.length);
            document.getElementById('pendingTx').textContent = Utils.formatNumber(AppState.stats.pendingTx || AppState.transactions.filter(t => t.status === 'pending').length);
            
            // Update badge counts
            document.getElementById('applicationCount').textContent = Utils.formatNumber(AppState.applications.length);
            document.getElementById('pendingTxCount').textContent = Utils.formatNumber(AppState.transactions.filter(t => t.status === 'pending').length);
            document.getElementById('disputeCount').textContent = Utils.formatNumber(AppState.disputes.length);
            document.getElementById('bannedAgentsCount').textContent = Utils.formatNumber(AppState.bannedAgents.length);
            document.getElementById('bannedCustomersCount').textContent = Utils.formatNumber(AppState.bannedCustomers.length);
            
            // Update analytics stats
            document.getElementById('totalRevenue').textContent = Utils.formatCurrency(AppState.stats.totalRevenue || 0);
            document.getElementById('activeUsers').textContent = Utils.formatNumber(AppState.stats.activeUsers24h || 0);
            document.getElementById('avgTransaction').textContent = Utils.formatCurrency(AppState.stats.avgTransaction || 0);
            document.getElementById('successRate').textContent = Utils.formatPercentage(AppState.stats.successRate || 0);
            
            // Update last updated time
            document.getElementById('lastUpdated').textContent = 'Just now';
        }
        
        function updateApplicationsUI() {
            const container = document.getElementById('applicationsBody');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (AppState.applications.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" style="text-align: center; padding: 40px;">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>No pending applications</p>
                        </div>
                    </td>
                `;
                container.appendChild(row);
                Utils.hideLoading('appsLoading');
                Utils.showElement('applicationsTable');
                return;
            }
            
            // Apply filters
            let filteredApplications = [...AppState.applications];
            if (!Utils.isObjectEmpty(AppState.filters.applications)) {
                filteredApplications = filteredApplications.filter(app => {
                    if (AppState.filters.applications.status && app.status !== AppState.filters.applications.status) {
                        return false;
                    }
                    if (AppState.filters.applications.dateFrom) {
                        const appDate = new Date(app.submittedAt || app.createdAt);
                        const filterDate = new Date(AppState.filters.applications.dateFrom);
                        if (appDate < filterDate) return false;
                    }
                    if (AppState.filters.applications.dateTo) {
                        const appDate = new Date(app.submittedAt || app.createdAt);
                        const filterDate = new Date(AppState.filters.applications.dateTo);
                        if (appDate > filterDate) return false;
                    }
                    return true;
                });
            }
            
            // Sort applications
            if (AppState.filters.applications.sort === 'oldest') {
                filteredApplications.sort((a, b) => (a.submittedAt || a.createdAt) - (b.submittedAt || b.createdAt));
            } else if (AppState.filters.applications.sort === 'name') {
                filteredApplications.sort((a, b) => (a.fullName || '').localeCompare(b.fullName || ''));
            } else {
                filteredApplications.sort((a, b) => (b.submittedAt || b.createdAt) - (a.submittedAt || a.createdAt));
            }
            
            filteredApplications.forEach(app => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${app.id}</strong></td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            ${app.profilePhoto ? `
                            <img src="${app.profilePhoto}" alt="${app.fullName}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
                            ` : `
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user"></i>
                            </div>
                            `}
                            <span>${app.fullName || 'N/A'}</span>
                        </div>
                    </td>
                    <td>${Utils.formatPhoneNumber(app.phone)}</td>
                    <td><code>${app.nrc || 'N/A'}</code></td>
                    <td>${Utils.formatDate(app.submittedAt || app.createdAt)}</td>
                    <td>${Utils.getStatusBadge(app.status || 'pending')}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" onclick="viewApplication('${app.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-approve" onclick="showCredentialsModal('${app.id}')" title="Approve">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-icon btn-reject" onclick="rejectApplicationPrompt('${app.id}')" title="Reject">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </td>
                `;
                container.appendChild(row);
            });
            
            Utils.hideLoading('appsLoading');
            Utils.showElement('applicationsTable');
        }
        
        function updateAgentsUI() {
            const container = document.getElementById('agentsBody');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (AppState.agents.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="8" style="text-align: center; padding: 40px;">
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <p>No active agents</p>
                        </div>
                    </td>
                `;
                container.appendChild(row);
                Utils.hideLoading('agentsLoading');
                Utils.showElement('agentsTable');
                return;
            }
            
            // Apply filters
            let filteredAgents = [...AppState.agents];
            if (!Utils.isObjectEmpty(AppState.filters.agents)) {
                filteredAgents = filteredAgents.filter(agent => {
                    if (AppState.filters.agents.status && agent.status !== AppState.filters.agents.status) {
                        return false;
                    }
                    if (AppState.filters.agents.performance) {
                        const successRate = agent.performance?.successRate || 0;
                        switch(AppState.filters.agents.performance) {
                            case 'excellent':
                                if (successRate < 90) return false;
                                break;
                            case 'good':
                                if (successRate < 70 || successRate >= 90) return false;
                                break;
                            case 'average':
                                if (successRate < 50 || successRate >= 70) return false;
                                break;
                            case 'poor':
                                if (successRate >= 50) return false;
                                break;
                        }
                    }
                    if (AppState.filters.agents.dateFrom) {
                        const agentDate = new Date(agent.createdAt);
                        const filterDate = new Date(AppState.filters.agents.dateFrom);
                        if (agentDate < filterDate) return false;
                    }
                    if (AppState.filters.agents.dateTo) {
                        const agentDate = new Date(agent.createdAt);
                        const filterDate = new Date(AppState.filters.agents.dateTo);
                        if (agentDate > filterDate) return false;
                    }
                    return true;
                });
            }
            
            filteredAgents.forEach(agent => {
                const successRate = agent.performance?.successRate || 0;
                const clients = agent.performance?.clients || agent.totalClients || 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${agent.agentId || agent.id}</strong></td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            ${agent.profilePhoto ? `
                            <img src="${agent.profilePhoto}" alt="${agent.fullName}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
                            ` : `
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            `}
                            <span>${agent.fullName || 'N/A'}</span>
                        </div>
                    </td>
                    <td>${agent.email || 'N/A'}</td>
                    <td>${Utils.formatPhoneNumber(agent.phone)}</td>
                    <td>${Utils.formatNumber(clients)}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="progress-bar" style="width: 80px;">
                                <div class="progress-fill" style="width: ${successRate}%"></div>
                            </div>
                            <span>${Utils.formatPercentage(successRate)}</span>
                        </div>
                    </td>
                    <td>${Utils.getStatusBadge(agent.status)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" onclick="viewAgent('${agent.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-edit" onclick="editAgent('${agent.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="showBanModal('agent', '${agent.id}')" title="Suspend/Ban">
                                <i class="fas fa-ban"></i>
                            </button>
                        </div>
                    </td>
                `;
                container.appendChild(row);
            });
            
            Utils.hideLoading('agentsLoading');
            Utils.showElement('agentsTable');
        }
        
        function updateBannedAgentsUI() {
            const container = document.getElementById('bannedAgentsBody');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (AppState.bannedAgents.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" style="text-align: center; padding: 40px;">
                        <div class="empty-state">
                            <i class="fas fa-ban"></i>
                            <p>No banned/suspended agents</p>
                        </div>
                    </td>
                `;
                container.appendChild(row);
                Utils.hideLoading('bannedAgentsLoading');
                Utils.showElement('bannedAgentsTable');
                return;
            }
            
            AppState.bannedAgents.forEach(agent => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${agent.agentId || agent.id}</strong></td>
                    <td>${agent.fullName || 'N/A'}</td>
                    <td>${agent.email || 'N/A'}</td>
                    <td>${agent.suspensionReason || agent.banReason || 'No reason provided'}</td>
                    <td>${Utils.formatDate(agent.suspendedAt || agent.bannedAt)}</td>
                    <td>${agent.suspendedBy || agent.bannedBy || 'System'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" onclick="viewAgent('${agent.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-approve" onclick="activateAgent('${agent.id}')" title="Activate">
                                <i class="fas fa-check"></i>
                            </button>
                        </div>
                    </td>
                `;
                container.appendChild(row);
            });
            
            Utils.hideLoading('bannedAgentsLoading');
            Utils.showElement('bannedAgentsTable');
        }
        
        function updateCustomersUI() {
            const container = document.getElementById('customersBody');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (AppState.customers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="8" style="text-align: center; padding: 40px;">
                        <div class="empty-state">
                            <i class="fas fa-user-friends"></i>
                            <p>No customers found</p>
                        </div>
                    </td>
                `;
                container.appendChild(row);
                Utils.hideLoading('customersLoading');
                Utils.showElement('customersTable');
                return;
            }
            
            // Apply filters
            let filteredCustomers = [...AppState.customers];
            if (!Utils.isObjectEmpty(AppState.filters.customers)) {
                filteredCustomers = filteredCustomers.filter(customer => {
                    if (AppState.filters.customers.status && customer.status !== AppState.filters.customers.status) {
                        return false;
                    }
                    if (AppState.filters.customers.balance) {
                        const balance = customer.accountBalance || 0;
                        switch(AppState.filters.customers.balance) {
                            case 'zero':
                                if (balance !== 0) return false;
                                break;
                            case 'low':
                                if (balance >= 100) return false;
                                break;
                            case 'medium':
                                if (balance < 100 || balance > 1000) return false;
                                break;
                            case 'high':
                                if (balance <= 1000) return false;
                                break;
                        }
                    }
                    if (AppState.filters.customers.dateFrom) {
                        const customerDate = new Date(customer.createdAt || customer.registeredAt);
                        const filterDate = new Date(AppState.filters.customers.dateFrom);
                        if (customerDate < filterDate) return false;
                    }
                    if (AppState.filters.customers.dateTo) {
                        const customerDate = new Date(customer.createdAt || customer.registeredAt);
                        const filterDate = new Date(AppState.filters.customers.dateTo);
                        if (customerDate > filterDate) return false;
                    }
                    return true;
                });
            }
            
            filteredCustomers.forEach(customer => {
                const loans = customer.loans || customer.loanCount || 0;
                const balance = customer.accountBalance || 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${customer.id}</strong></td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            ${customer.profilePhoto ? `
                            <img src="${customer.profilePhoto}" alt="${customer.fullName}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
                            ` : `
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user"></i>
                            </div>
                            `}
                            <span>${customer.fullName || 'N/A'}</span>
                        </div>
                    </td>
                    <td>${customer.email || 'N/A'}</td>
                    <td>${Utils.formatPhoneNumber(customer.phone)}</td>
                    <td>${Utils.formatNumber(loans)}</td>
                    <td>${Utils.formatCurrency(balance)}</td>
                    <td>${Utils.getStatusBadge(customer.status || 'active')}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" onclick="viewCustomer('${customer.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-edit" onclick="editCustomer('${customer.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="showBanModal('customer', '${customer.id}')" title="Suspend/Ban">
                                <i class="fas fa-ban"></i>
                            </button>
                        </div>
                    </td>
                `;
                container.appendChild(row);
            });
            
            Utils.hideLoading('customersLoading');
            Utils.showElement('customersTable');
        }
        
        function updateBannedCustomersUI() {
            const container = document.getElementById('bannedCustomersBody');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (AppState.bannedCustomers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" style="text-align: center; padding: 40px;">
                        <div class="empty-state">
                            <i class="fas fa-user-slash"></i>
                            <p>No banned/suspended customers</p>
                        </div>
                    </td>
                `;
                container.appendChild(row);
                Utils.hideLoading('bannedCustomersLoading');
                Utils.showElement('bannedCustomersTable');
                return;
            }
            
            AppState.bannedCustomers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${customer.id}</strong></td>
                    <td>${customer.fullName || 'N/A'}</td>
                    <td>${customer.email || 'N/A'}</td>
                    <td>${customer.suspensionReason || customer.banReason || 'No reason provided'}</td>
                    <td>${Utils.formatDate(customer.suspendedAt || customer.bannedAt)}</td>
                    <td>${customer.suspendedBy || customer.bannedBy || 'System'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" onclick="viewCustomer('${customer.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-approve" onclick="activateCustomer('${customer.id}')" title="Activate">
                                <i class="fas fa-check"></i>
                            </button>
                        </div>
                    </td>
                `;
                container.appendChild(row);
            });
            
            Utils.hideLoading('bannedCustomersLoading');
            Utils.showElement('bannedCustomersTable');
        }
        
        function updateTransactionsUI() {
            const container = document.getElementById('transactionsBody');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (AppState.transactions.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="8" style="text-align: center; padding: 40px;">
                        <div class="empty-state">
                            <i class="fas fa-exchange-alt"></i>
                            <p>No transactions found</p>
                        </div>
                    </td>
                `;
                container.appendChild(row);
                Utils.hideLoading('transactionsLoading');
                Utils.showElement('transactionsTable');
                return;
            }
            
            // Apply filters
            let filteredTransactions = [...AppState.transactions];
            if (!Utils.isObjectEmpty(AppState.filters.transactions)) {
                filteredTransactions = filteredTransactions.filter(tx => {
                    if (AppState.filters.transactions.status && tx.status !== AppState.filters.transactions.status) {
                        return false;
                    }
                    if (AppState.filters.transactions.type && tx.type !== AppState.filters.transactions.type) {
                        return false;
                    }
                    if (AppState.filters.transactions.minAmount) {
                        const amount = parseFloat(tx.amount) || 0;
                        const minAmount = parseFloat(AppState.filters.transactions.minAmount) || 0;
                        if (amount < minAmount) return false;
                    }
                    if (AppState.filters.transactions.maxAmount) {
                        const amount = parseFloat(tx.amount) || 0;
                        const maxAmount = parseFloat(AppState.filters.transactions.maxAmount) || Infinity;
                        if (amount > maxAmount) return false;
                    }
                    if (AppState.filters.transactions.dateFrom) {
                        const txDate = new Date(tx.timestamp || tx.createdAt);
                        const filterDate = new Date(AppState.filters.transactions.dateFrom);
                        if (txDate < filterDate) return false;
                    }
                    if (AppState.filters.transactions.dateTo) {
                        const txDate = new Date(tx.timestamp || tx.createdAt);
                        const filterDate = new Date(AppState.filters.transactions.dateTo);
                        if (txDate > filterDate) return false;
                    }
                    return true;
                });
            }
            
            // Sort by date (newest first)
            filteredTransactions.sort((a, b) => (b.timestamp || b.createdAt) - (a.timestamp || a.createdAt));
            
            filteredTransactions.forEach(tx => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><code>${tx.id}</code></td>
                    <td>
                        <span class="status-badge status-${Utils.getStatusColor(tx.type)}">
                            ${tx.type || 'N/A'}
                        </span>
                    </td>
                    <td>${tx.customerName || tx.customer || 'N/A'}</td>
                    <td>${tx.agentName || tx.agent || 'N/A'}</td>
                    <td><strong>${Utils.formatCurrency(tx.amount)}</strong></td>
                    <td>${Utils.formatDate(tx.timestamp || tx.createdAt)}</td>
                    <td>${Utils.getStatusBadge(tx.status)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" onclick="viewTransaction('${tx.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${tx.status === 'pending' ? `
                            <button class="btn-icon btn-approve" onclick="approveTransaction('${tx.id}')" title="Approve">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-icon btn-reject" onclick="rejectTransactionPrompt('${tx.id}')" title="Reject">
                                <i class="fas fa-times"></i>
                            </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                container.appendChild(row);
            });
            
            Utils.hideLoading('transactionsLoading');
            Utils.showElement('transactionsTable');
        }
        
        function updateDisputesUI() {
            const container = document.getElementById('disputesBody');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (AppState.disputes.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="8" style="text-align: center; padding: 40px;">
                        <div class="empty-state">
                            <i class="fas fa-gavel"></i>
                            <p>No disputes found</p>
                        </div>
                    </td>
                `;
                container.appendChild(row);
                Utils.hideLoading('disputesLoading');
                Utils.showElement('disputesTable');
                return;
            }
            
            // Apply filters
            let filteredDisputes = [...AppState.disputes];
            if (!Utils.isObjectEmpty(AppState.filters.disputes)) {
                filteredDisputes = filteredDisputes.filter(dispute => {
                    if (AppState.filters.disputes.status && dispute.status !== AppState.filters.disputes.status) {
                        return false;
                    }
                    if (AppState.filters.disputes.type && dispute.type !== AppState.filters.disputes.type) {
                        return false;
                    }
                    if (AppState.filters.disputes.severity && dispute.severity !== AppState.filters.disputes.severity) {
                        return false;
                    }
                    if (AppState.filters.disputes.dateFrom) {
                        const disputeDate = new Date(dispute.openedAt || dispute.createdAt);
                        const filterDate = new Date(AppState.filters.disputes.dateFrom);
                        if (disputeDate < filterDate) return false;
                    }
                    if (AppState.filters.disputes.dateTo) {
                        const disputeDate = new Date(dispute.openedAt || dispute.createdAt);
                        const filterDate = new Date(AppState.filters.disputes.dateTo);
                        if (disputeDate > filterDate) return false;
                    }
                    return true;
                });
            }
            
            filteredDisputes.forEach(dispute => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><code>${dispute.id}</code></td>
                    <td>
                        <span class="status-badge status-${Utils.getStatusColor(dispute.type)}">
                            ${dispute.type || 'N/A'}
                        </span>
                    </td>
                    <td>${dispute.customerName || dispute.customer || 'N/A'}</td>
                    <td>${dispute.agentName || dispute.agent || 'N/A'}</td>
                    <td><strong>${Utils.formatCurrency(dispute.amount)}</strong></td>
                    <td>${Utils.formatDate(dispute.openedAt || dispute.createdAt)}</td>
                    <td>${Utils.getStatusBadge(dispute.status)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" onclick="viewDispute('${dispute.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-approve" onclick="resolveDisputePrompt('${dispute.id}')" title="Resolve">
                                <i class="fas fa-check-circle"></i>
                            </button>
                        </div>
                    </td>
                `;
                container.appendChild(row);
            });
            
            Utils.hideLoading('disputesLoading');
            Utils.showElement('disputesTable');
        }
        
        function updateAuditLogsUI() {
            const container = document.getElementById('auditBody');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (AppState.auditLogs.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" style="text-align: center; padding: 40px;">
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <p>No audit logs found</p>
                        </div>
                    </td>
                `;
                container.appendChild(row);
                Utils.hideLoading('auditLoading');
                Utils.showElement('auditTable');
                return;
            }
            
            // Apply filters
            let filteredLogs = [...AppState.auditLogs];
            if (!Utils.isObjectEmpty(AppState.filters.audit)) {
                filteredLogs = filteredLogs.filter(log => {
                    if (AppState.filters.audit.action && log.action !== AppState.filters.audit.action) {
                        return false;
                    }
                    if (AppState.filters.audit.userType) {
                        const performerType = log.performedBy === AppState.currentUser.uid ? 'admin' : 
                                             log.performedByEmail?.includes('@agent.') ? 'agent' :
                                             log.performedByEmail?.includes('@customer.') ? 'customer' : 'system';
                        if (performerType !== AppState.filters.audit.userType) return false;
                    }
                    if (AppState.filters.audit.dateFrom) {
                        const logDate = new Date(log.timestamp);
                        const filterDate = new Date(AppState.filters.audit.dateFrom);
                        if (logDate < filterDate) return false;
                    }
                    if (AppState.filters.audit.dateTo) {
                        const logDate = new Date(log.timestamp);
                        const filterDate = new Date(AppState.filters.audit.dateTo);
                        if (logDate > filterDate) return false;
                    }
                    if (AppState.filters.audit.search) {
                        const searchTerm = AppState.filters.audit.search.toLowerCase();
                        const logText = JSON.stringify(log).toLowerCase();
                        if (!logText.includes(searchTerm)) return false;
                    }
                    return true;
                });
            }
            
            // Sort by timestamp (newest first)
            filteredLogs.sort((a, b) => b.timestamp - a.timestamp);
            
            // Limit to 100 logs for performance
            filteredLogs = filteredLogs.slice(0, 100);
            
            filteredLogs.forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><code>${log.id}</code></td>
                    <td>
                        <span class="status-badge status-${Utils.getStatusColor(log.action)}">
                            ${log.action || 'UNKNOWN'}
                        </span>
                    </td>
                    <td>${log.performedByEmail || 'System'}</td>
                    <td>${log.targetType}: ${log.targetId}</td>
                    <td title="${JSON.stringify(log.details || {})}">
                        ${Utils.truncateText(JSON.stringify(log.details || {}), 60)}
                    </td>
                    <td>${Utils.formatDate(log.timestamp)}</td>
                    <td>${log.ipAddress || 'N/A'}</td>
                `;
                container.appendChild(row);
            });
            
            Utils.hideLoading('auditLoading');
            Utils.showElement('auditTable');
        }
        
        function updateNotificationsUI() {
            const container = document.getElementById('notificationList');
            const allContainer = document.getElementById('allNotificationsList');
            const unreadContainer = document.getElementById('unreadNotificationsList');
            const systemContainer = document.getElementById('systemNotificationsList');
            const userContainer = document.getElementById('userNotificationsList');
            
            const badge = document.querySelector('.notification-badge');
            const countElement = document.getElementById('notificationCount');
            
            // Filter unread notifications
            const unreadNotifications = AppState.notifications.filter(n => !n.read);
            const unreadCount = unreadNotifications.length;
            
            // Update badge
            if (badge) {
                badge.style.display = unreadCount > 0 ? 'block' : 'none';
            }
            
            // Update count in sidebar
            if (countElement) {
                countElement.textContent = unreadCount;
            }
            
            // Update all notifications list
            if (allContainer) {
                allContainer.innerHTML = '';
                
                if (AppState.notifications.length === 0) {
                    allContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-bell-slash"></i>
                            <p>No notifications</p>
                        </div>
                    `;
                } else {
                    // Show latest notifications
                    const recentNotifications = [...AppState.notifications]
                        .sort((a, b) => b.timestamp - a.timestamp);
                    
                    recentNotifications.forEach(notification => {
                        const item = document.createElement('div');
                        item.className = `notification-item ${notification.read ? '' : 'unread'}`;
                        item.onclick = () => markNotificationRead(notification.id);
                        
                        let icon = 'fa-info-circle';
                        let iconClass = 'info';
                        
                        switch(notification.type) {
                            case 'application_approved':
                            case 'transaction_approved':
                                icon = 'fa-check-circle';
                                iconClass = 'success';
                                break;
                            case 'application_rejected':
                            case 'transaction_rejected':
                            case 'agent_banned':
                            case 'customer_banned':
                                icon = 'fa-times-circle';
                                iconClass = 'danger';
                                break;
                            case 'dispute_opened':
                            case 'suspicious_activity':
                                icon = 'fa-exclamation-triangle';
                                iconClass = 'warning';
                                break;
                            case 'system_alert':
                            case 'maintenance':
                                icon = 'fa-server';
                                iconClass = 'warning';
                                break;
                        }
                        
                        item.innerHTML = `
                            <div class="notification-content">
                                <h5>${notification.title || 'Notification'}</h5>
                                <p>${notification.message || ''}</p>
                                <div class="notification-time">${Utils.formatDate(notification.timestamp)}</div>
                            </div>
                            <div class="notification-icon ${iconClass}">
                                <i class="fas ${icon}"></i>
                            </div>
                        `;
                        allContainer.appendChild(item);
                    });
                }
            }
            
            // Update unread notifications list
            if (unreadContainer) {
                unreadContainer.innerHTML = '';
                
                if (unreadNotifications.length === 0) {
                    unreadContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-bell"></i>
                            <p>No unread notifications</p>
                        </div>
                    `;
                } else {
                    unreadNotifications.forEach(notification => {
                        const item = document.createElement('div');
                        item.className = 'notification-item unread';
                        item.onclick = () => markNotificationRead(notification.id);
                        
                        let icon = 'fa-info-circle';
                        let iconClass = 'info';
                        
                        switch(notification.type) {
                            case 'application_approved':
                            case 'transaction_approved':
                                icon = 'fa-check-circle';
                                iconClass = 'success';
                                break;
                            case 'application_rejected':
                            case 'transaction_rejected':
                                icon = 'fa-times-circle';
                                iconClass = 'danger';
                                break;
                        }
                        
                        item.innerHTML = `
                            <div class="notification-content">
                                <h5>${notification.title || 'Notification'}</h5>
                                <p>${notification.message || ''}</p>
                                <div class="notification-time">${Utils.formatDate(notification.timestamp)}</div>
                            </div>
                            <div class="notification-icon ${iconClass}">
                                <i class="fas ${icon}"></i>
                            </div>
                        `;
                        unreadContainer.appendChild(item);
                    });
                }
            }
        }
        
        function updateAdminAccountsUI() {
            const container = document.getElementById('adminAccountsBody');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (AppState.adminAccounts.length === 0) {
                Utils.hideLoading('adminAccountsLoading');
                Utils.showElement('adminAccountsTable');
                return;
            }
            
            AppState.adminAccounts.forEach(admin => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><code>${admin.id}</code></td>
                    <td>${admin.fullName || 'N/A'}</td>
                    <td>${admin.email || 'N/A'}</td>
                    <td>
                        <span class="status-badge status-${Utils.getStatusColor(admin.role)}">
                            ${admin.role || 'admin'}
                        </span>
                    </td>
                    <td>${Utils.formatDate(admin.lastLogin)}</td>
                    <td>${Utils.getStatusBadge(admin.status || 'active')}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" onclick="viewAdminAccount('${admin.id}')" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${admin.id !== AppState.currentUser.uid ? `
                            <button class="btn-icon btn-delete" onclick="deleteAdminAccount('${admin.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                container.appendChild(row);
            });
            
            Utils.hideLoading('adminAccountsLoading');
            Utils.showElement('adminAccountsTable');
        }
        
        function updateRecentActivity() {
            const container = document.getElementById('recentActivity');
            if (!container) return;
            
            // Use audit logs for recent activity
            const recentLogs = [...AppState.auditLogs]
                .sort((a, b) => b.timestamp - a.timestamp)
                .slice(0, 10);
            
            if (recentLogs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>No recent activity</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            recentLogs.forEach(log => {
                const activity = document.createElement('div');
                activity.className = 'activity-item';
                
                let icon = 'fa-info-circle';
                let iconClass = 'info';
                
                switch(log.action) {
                    case 'APPROVE_APPLICATION':
                    case 'APPROVE_TRANSACTION':
                    case 'ACTIVATE_AGENT':
                    case 'ACTIVATE_CUSTOMER':
                        icon = 'fa-check-circle';
                        iconClass = 'approval';
                        break;
                    case 'REJECT_APPLICATION':
                    case 'REJECT_TRANSACTION':
                    case 'SUSPEND_AGENT':
                    case 'SUSPEND_CUSTOMER':
                    case 'BAN_AGENT':
                    case 'BAN_CUSTOMER':
                        icon = 'fa-times-circle';
                        iconClass = 'rejection';
                        break;
                    case 'ADMIN_LOGIN':
                    case 'ADMIN_LOGOUT':
                        icon = 'fa-sign-in-alt';
                        iconClass = 'info';
                        break;
                    case 'CREATE_ADMIN_ACCOUNT':
                        icon = 'fa-user-plus';
                        iconClass = 'info';
                        break;
                    case 'UPDATE_SETTINGS':
                        icon = 'fa-cog';
                        iconClass = 'info';
                        break;
                }
                
                activity.innerHTML = `
                    <div class="activity-icon ${iconClass}">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${log.action.replace(/_/g, ' ')}</div>
                        <div class="activity-description">
                            ${log.performedByEmail || 'System'} - ${log.targetType}: ${log.targetId}
                        </div>
                        <div class="activity-time">${Utils.getTimeAgo(log.timestamp)}</div>
                    </div>
                `;
                container.appendChild(activity);
            });
        }
        
        // ===== Chart Functions =====
        function initializeCharts() {
            // Transaction Volume Chart
            const transactionCtx = document.getElementById('transactionChart');
            if (transactionCtx) {
                if (AppState.charts.transactionChart) {
                    AppState.charts.transactionChart.destroy();
                }
                
                // Generate sample data for last 30 days
                const labels = [];
                const data = [];
                const now = new Date();
                
                for (let i = 29; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                    
                    // Generate random transaction amounts between 1000 and 10000
                    data.push(Math.floor(Math.random() * 9000) + 1000);
                }
                
                AppState.charts.transactionChart = new Chart(transactionCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Transaction Volume',
                            data: data,
                            borderColor: '#007AFF',
                            backgroundColor: 'rgba(0, 122, 255, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#007AFF',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `$${context.parsed.y.toLocaleString()}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
            
            // Platform Stats Chart
            const platformCtx = document.getElementById('platformStatsChart');
            if (platformCtx) {
                if (AppState.charts.platformStatsChart) {
                    AppState.charts.platformStatsChart.destroy();
                }
                
                AppState.charts.platformStatsChart = new Chart(platformCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Customers', 'Agents', 'Admins', 'Banned'],
                        datasets: [{
                            data: [
                                AppState.customers.length,
                                AppState.agents.length,
                                AppState.adminAccounts.length,
                                AppState.bannedAgents.length + AppState.bannedCustomers.length
                            ],
                            backgroundColor: [
                                '#007AFF',
                                '#34C759',
                                '#5856D6',
                                '#FF3B30'
                            ],
                            borderWidth: 0,
                            hoverOffset: 20
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        },
                        cutout: '70%'
                    }
                });
            }
            
            // Update chart period
            document.getElementById('chartPeriod')?.addEventListener('change', function() {
                initializeCharts();
            });
        }
        
        function initializePerformanceCharts() {
            // Performance Chart
            const performanceCtx = document.getElementById('performanceChart');
            if (performanceCtx) {
                if (AppState.charts.performanceChart) {
                    AppState.charts.performanceChart.destroy();
                }
                
                // Get top 10 agents by performance
                const topAgents = [...AppState.agents]
                    .sort((a, b) => (b.performance?.successRate || 0) - (a.performance?.successRate || 0))
                    .slice(0, 10);
                
                const labels = topAgents.map(agent => agent.fullName || agent.agentId || agent.id);
                const successRates = topAgents.map(agent => agent.performance?.successRate || 0);
                const clients = topAgents.map(agent => agent.performance?.clients || agent.totalClients || 0);
                
                AppState.charts.performanceChart = new Chart(performanceCtx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Success Rate (%)',
                                data: successRates,
                                backgroundColor: 'rgba(0, 122, 255, 0.7)',
                                borderColor: '#007AFF',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Clients',
                                data: clients,
                                backgroundColor: 'rgba(52, 199, 89, 0.7)',
                                borderColor: '#34C759',
                                borderWidth: 1,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Success Rate (%)'
                                },
                                min: 0,
                                max: 100
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Clients'
                                },
                                grid: {
                                    drawOnChartArea: false
                                },
                                min: 0
                            }
                        }
                    }
                });
            }
            
            // Performance period selector
            document.getElementById('performancePeriod')?.addEventListener('change', function() {
                initializePerformanceCharts();
            });
        }
        
        // ===== Modal Functions =====
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }
        
        function toggleFilter(panelId) {
            const panel = document.getElementById(panelId);
            if (panel) {
                panel.classList.toggle('active');
            }
        }
        
        async function viewApplication(appId) {
            try {
                AppState.currentAppId = appId;
                const result = await FirebaseService.getApplicationDetails(appId);
                if (result.success) {
                    const app = result.data;
                    const container = document.getElementById('appDetailsContent');
                    
                    container.innerHTML = `
                        <div class="application-details-grid">
                            <div class="detail-card">
                                <h4>Application ID</h4>
                                <p>${appId}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Applicant Name</h4>
                                <p>${app.fullName || 'N/A'}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Phone Number</h4>
                                <p>${Utils.formatPhoneNumber(app.phone)}</p>
                            </div>
                            <div class="detail-card">
                                <h4>NRC Number</h4>
                                <p><code>${app.nrc || 'N/A'}</code></p>
                            </div>
                            <div class="detail-card">
                                <h4>Residence</h4>
                                <p>${app.residence || 'N/A'}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Submitted</h4>
                                <p>${Utils.formatDate(app.submittedAt)}</p>
                            </div>
                        </div>
                        
                        <h4 style="margin-top: 24px; margin-bottom: 16px;">Additional Information</h4>
                        <div class="application-details-grid">
                            <div class="detail-card">
                                <h4>Email</h4>
                                <p>${app.email || 'Not provided'}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Date of Birth</h4>
                                <p>${app.dateOfBirth ? Utils.formatDateOnly(app.dateOfBirth) : 'N/A'}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Gender</h4>
                                <p>${app.gender || 'N/A'}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Marital Status</h4>
                                <p>${app.maritalStatus || 'N/A'}</p>
                            </div>
                        </div>
                        
                        <h4 style="margin-top: 24px; margin-bottom: 16px;">Uploaded Documents</h4>
                        <div class="document-preview">
                            ${app.nrcFront ? `
                            <div class="document-item">
                                <div class="document-image">
                                    <img src="${app.nrcFront}" alt="NRC Front" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzk5OSI+TlJDIEZyb250PC90ZXh0Pjwvc3ZnPg=='">
                                </div>
                                <div class="document-info">
                                    <h5>NRC Front</h5>
                                    <p>ID Document</p>
                                </div>
                            </div>
                            ` : ''}
                            
                            ${app.nrcBack ? `
                            <div class="document-item">
                                <div class="document-image">
                                    <img src="${app.nrcBack}" alt="NRC Back" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzk5OSI+TlJDIEJhY2s8L3RleHQ+PC9zdmc+'">
                                </div>
                                <div class="document-info">
                                    <h5>NRC Back</h5>
                                    <p>ID Document</p>
                                </div>
                            </div>
                            ` : ''}
                            
                            ${app.profilePhoto ? `
                            <div class="document-item">
                                <div class="document-image">
                                    <img src="${app.profilePhoto}" alt="Profile Photo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzk5OSI+UHJvZmlsZSBQaG90bzwvdGV4dD48L3N2Zz4='">
                                </div>
                                <div class="document-info">
                                    <h5>Profile Photo</h5>
                                    <p>Portrait</p>
                                </div>
                            </div>
                            ` : ''}
                            
                            ${app.additionalDoc ? `
                            <div class="document-item">
                                <div class="document-image">
                                    <img src="${app.additionalDoc}" alt="Additional Document" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzk5OSI+QWRkaXRpb25hbCBEb2M8L3RleHQ+PC9zdmc+'">
                                </div>
                                <div class="document-info">
                                    <h5>Additional Document</h5>
                                    <p>Supporting</p>
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div style="margin-top: 24px; background: #f8f9fa; padding: 16px; border-radius: 8px;">
                            <h4 style="margin-bottom: 8px;">Application Notes</h4>
                            <textarea id="appNotes" class="form-control form-textarea" placeholder="Add any notes for this application...">${app.notes || ''}</textarea>
                        </div>
                    `;
                    
                    // Setup approve button
                    document.getElementById('approveAppBtn').onclick = () => showCredentialsModal(appId);
                    document.getElementById('rejectAppBtn').onclick = () => rejectApplicationPrompt(appId);
                    
                    openModal('appDetailsModal');
                } else {
                    Utils.showToast('Error', 'Failed to load application details', 'error');
                }
            } catch (error) {
                console.error('Error viewing application:', error);
                Utils.showToast('Error', 'Failed to load application', 'error');
            }
        }
        
        function showCredentialsModal(appId) {
            AppState.currentAppId = appId;
            
            // Load application info for the modal
            const appInfo = AppState.applications.find(app => app.id === appId);
            if (appInfo) {
                document.getElementById('credentialsAppInfo').innerHTML = `
                    <p><strong>Applicant:</strong> ${appInfo.fullName}</p>
                    <p><strong>Phone:</strong> ${Utils.formatPhoneNumber(appInfo.phone)}</p>
                    <p><strong>NRC:</strong> ${appInfo.nrc || 'N/A'}</p>
                `;
            }
            
            // Generate default values
            document.getElementById('manualAgentEmail').value = `${appInfo?.fullName?.toLowerCase().replace(/\s+/g, '.')}@agent.trucash.com`;
            document.getElementById('manualAgentId').value = Utils.generateAgentId();
            document.getElementById('manualAgentPassword').value = '';
            document.getElementById('manualAgentPasswordConfirm').value = '';
            
            openModal('credentialsModal');
        }
        
        async function saveCredentialsAndApprove() {
            const email = document.getElementById('manualAgentEmail').value;
            const agentId = document.getElementById('manualAgentId').value;
            const password = document.getElementById('manualAgentPassword').value;
            const passwordConfirm = document.getElementById('manualAgentPasswordConfirm').value;
            const sendWelcomeEmail = document.getElementById('sendWelcomeEmail').checked;
            const generateRandom = document.getElementById('generateRandomPassword').checked;
            
            // Validate inputs
            if (!email || !Utils.validateEmail(email)) {
                Utils.showToast('Error', 'Please enter a valid email address', 'error');
                return;
            }
            
            if (!agentId || agentId.length < 3) {
                Utils.showToast('Error', 'Agent ID must be at least 3 characters', 'error');
                return;
            }
            
            let finalPassword = password;
            if (generateRandom) {
                finalPassword = Utils.generatePassword();
                document.getElementById('manualAgentPassword').value = finalPassword;
                document.getElementById('manualAgentPasswordConfirm').value = finalPassword;
            }
            
            if (!finalPassword || !Utils.validatePassword(finalPassword)) {
                Utils.showToast('Error', 'Password must be at least 8 characters long', 'error');
                return;
            }
            
            if (finalPassword !== passwordConfirm) {
                Utils.showToast('Error', 'Passwords do not match', 'error');
                return;
            }
            
            try {
                Utils.showToast('Processing', 'Approving application...', 'info');
                
                const credentials = {
                    email: email,
                    agentId: agentId,
                    password: finalPassword,
                    sendWelcomeEmail: sendWelcomeEmail
                };
                
                const result = await FirebaseService.approveApplication(AppState.currentAppId, credentials);
                
                if (result.success) {
                    Utils.showToast('Success', 'Application approved successfully', 'success');
                    closeModal('credentialsModal');
                    closeModal('appDetailsModal');
                    
                    // Show credentials to admin
                    setTimeout(() => {
                        const message = `Agent Credentials Created Successfully!\n\n` +
                                       `Email: ${credentials.email}\n` +
                                       `Agent ID: ${credentials.agentId}\n` +
                                       `Password: ${credentials.password}\n\n` +
                                       `Please save these credentials securely.`;
                        
                        if (confirm(message + '\n\nCopy credentials to clipboard?')) {
                            Utils.copyToClipboard(`Email: ${credentials.email}\nAgent ID: ${credentials.agentId}\nPassword: ${credentials.password}`);
                        }
                    }, 500);
                } else {
                    Utils.showToast('Error', result.error || 'Failed to approve application', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to approve application', 'error');
            }
        }
        
        async function rejectApplicationPrompt(appId) {
            const reason = prompt('Please enter the reason for rejection:');
            if (reason && reason.trim()) {
                try {
                    Utils.showToast('Processing', 'Rejecting application...', 'info');
                    const result = await FirebaseService.rejectApplication(appId, reason);
                    
                    if (result.success) {
                        Utils.showToast('Success', 'Application rejected successfully', 'success');
                        closeModal('appDetailsModal');
                    } else {
                        Utils.showToast('Error', result.error || 'Failed to reject application', 'error');
                    }
                } catch (error) {
                    Utils.showToast('Error', error.message || 'Failed to reject application', 'error');
                }
            }
        }
        
        async function viewTransaction(txId) {
            try {
                const tx = AppState.transactions.find(t => t.id === txId);
                if (!tx) {
                    Utils.showToast('Error', 'Transaction not found', 'error');
                    return;
                }
                
                const container = document.getElementById('transactionDetailsContent');
                container.innerHTML = `
                    <div class="application-details-grid">
                        <div class="detail-card">
                            <h4>Transaction ID</h4>
                            <p><code>${tx.id}</code></p>
                        </div>
                        <div class="detail-card">
                            <h4>Type</h4>
                            <p>${tx.type || 'N/A'}</p>
                        </div>
                        <div class="detail-card">
                            <h4>Amount</h4>
                            <p><strong>${Utils.formatCurrency(tx.amount)}</strong></p>
                        </div>
                        <div class="detail-card">
                            <h4>Status</h4>
                            <p>${Utils.getStatusBadge(tx.status)}</p>
                        </div>
                        <div class="detail-card">
                            <h4>Customer</h4>
                            <p>${tx.customerName || tx.customer || 'N/A'}</p>
                        </div>
                        <div class="detail-card">
                            <h4>Agent</h4>
                            <p>${tx.agentName || tx.agent || 'N/A'}</p>
                        </div>
                        <div class="detail-card">
                            <h4>Date</h4>
                            <p>${Utils.formatDate(tx.timestamp)}</p>
                        </div>
                        <div class="detail-card">
                            <h4>Reference</h4>
                            <p><code>${tx.reference || 'N/A'}</code></p>
                        </div>
                    </div>
                    
                    ${tx.description ? `
                    <div style="margin-top: 20px;">
                        <h4>Description</h4>
                        <p>${tx.description}</p>
                    </div>
                    ` : ''}
                    
                    ${tx.notes ? `
                    <div style="margin-top: 20px; background: #f8f9fa; padding: 16px; border-radius: 8px;">
                        <h4>Notes</h4>
                        <p>${tx.notes}</p>
                    </div>
                    ` : ''}
                    
                    <div style="margin-top: 20px;">
                        <h4>Transaction Timeline</h4>
                        <div class="transaction-timeline">
                            <div class="timeline-item ${tx.status === 'completed' ? 'completed' : 'active'}">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <h5>Transaction Created</h5>
                                    <p>${Utils.formatDate(tx.timestamp)}</p>
                                </div>
                            </div>
                            ${tx.status === 'pending' ? `
                            <div class="timeline-item active">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <h5>Pending Approval</h5>
                                    <p>Awaiting admin approval</p>
                                </div>
                            </div>
                            ` : ''}
                            ${tx.reviewedAt ? `
                            <div class="timeline-item completed">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <h5>${tx.status === 'approved' ? 'Approved' : 'Rejected'}</h5>
                                    <p>By: ${tx.reviewedBy || 'Admin'}</p>
                                    <p>${Utils.formatDate(tx.reviewedAt)}</p>
                                </div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                // Setup action buttons
                if (tx.status === 'pending') {
                    document.getElementById('approveTxBtn').onclick = () => approveTransaction(tx.id);
                    document.getElementById('rejectTxBtn').onclick = () => rejectTransactionPrompt(tx.id);
                } else {
                    document.getElementById('approveTxBtn').style.display = 'none';
                    document.getElementById('rejectTxBtn').style.display = 'none';
                }
                
                openModal('transactionDetailsModal');
            } catch (error) {
                console.error('Error viewing transaction:', error);
                Utils.showToast('Error', 'Failed to load transaction details', 'error');
            }
        }
        
        async function approveTransaction(txId) {
            const notes = prompt('Add any notes for this approval:') || '';
            try {
                Utils.showToast('Processing', 'Approving transaction...', 'info');
                const result = await FirebaseService.approveTransaction(txId, notes);
                if (result.success) {
                    Utils.showToast('Success', 'Transaction approved successfully', 'success');
                    closeModal('transactionDetailsModal');
                } else {
                    Utils.showToast('Error', result.error || 'Failed to approve transaction', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to approve transaction', 'error');
            }
        }
        
        async function rejectTransactionPrompt(txId) {
            const reason = prompt('Please enter the reason for rejection:');
            if (reason && reason.trim()) {
                try {
                    Utils.showToast('Processing', 'Rejecting transaction...', 'info');
                    const result = await FirebaseService.rejectTransaction(txId, reason);
                    if (result.success) {
                        Utils.showToast('Success', 'Transaction rejected successfully', 'success');
                        closeModal('transactionDetailsModal');
                    } else {
                        Utils.showToast('Error', result.error || 'Failed to reject transaction', 'error');
                    }
                } catch (error) {
                    Utils.showToast('Error', error.message || 'Failed to reject transaction', 'error');
                }
            }
        }
        
        async function viewCustomer(customerId) {
            try {
                AppState.currentUserId = customerId;
                const result = await FirebaseService.getCustomerDetails(customerId);
                if (result.success) {
                    const customer = result.data;
                    const container = document.getElementById('customerDetailsContent');
                    
                    container.innerHTML = `
                        <div class="application-details-grid">
                            <div class="detail-card">
                                <h4>Customer ID</h4>
                                <p><code>${customerId}</code></p>
                            </div>
                            <div class="detail-card">
                                <h4>Full Name</h4>
                                <p>${customer.fullName || 'N/A'}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Email</h4>
                                <p>${customer.email || 'N/A'}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Phone</h4>
                                <p>${Utils.formatPhoneNumber(customer.phone)}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Status</h4>
                                <p>${Utils.getStatusBadge(customer.status || 'active')}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Joined</h4>
                                <p>${Utils.formatDate(customer.createdAt)}</p>
                            </div>
                        </div>
                        
                        <div class="loan-details">
                            <div class="loan-item">
                                <div class="loan-label">Account Balance</div>
                                <div class="loan-value">${Utils.formatCurrency(customer.accountBalance || 0)}</div>
                            </div>
                            <div class="loan-item">
                                <div class="loan-label">Total Loans</div>
                                <div class="loan-value">${customer.loans || customer.loanCount || 0}</div>
                            </div>
                            <div class="loan-item">
                                <div class="loan-label">Active Loans</div>
                                <div class="loan-value">${customer.activeLoans || 0}</div>
                            </div>
                            <div class="loan-item">
                                <div class="loan-label">Credit Score</div>
                                <div class="loan-value">${customer.creditScore || 'N/A'}</div>
                            </div>
                        </div>
                        
                        ${customer.residence || customer.address ? `
                        <div style="margin-top: 20px;">
                            <h4>Address Information</h4>
                            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 8px;">
                                <p>${customer.residence || customer.address || 'N/A'}</p>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${customer.nrc ? `
                        <div style="margin-top: 20px;">
                            <h4>Identification</h4>
                            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 8px;">
                                <p><strong>NRC:</strong> ${customer.nrc}</p>
                                ${customer.dateOfBirth ? `<p><strong>Date of Birth:</strong> ${Utils.formatDateOnly(customer.dateOfBirth)}</p>` : ''}
                                ${customer.gender ? `<p><strong>Gender:</strong> ${customer.gender}</p>` : ''}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${customer.verificationStatus ? `
                        <div style="margin-top: 20px;">
                            <h4>Verification Status</h4>
                            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 8px;">
                                <p><strong>Status:</strong> ${Utils.getStatusBadge(customer.verificationStatus)}</p>
                                ${customer.verifiedAt ? `<p><strong>Verified On:</strong> ${Utils.formatDate(customer.verifiedAt)}</p>` : ''}
                                ${customer.verifiedBy ? `<p><strong>Verified By:</strong> ${customer.verifiedBy}</p>` : ''}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${customer.suspensionReason || customer.banReason ? `
                        <div style="margin-top: 20px; background: #fff3cd; padding: 16px; border-radius: 8px; border: 1px solid #ffc107;">
                            <h4 style="color: #856404;">Account Restriction</h4>
                            <p><strong>Reason:</strong> ${customer.suspensionReason || customer.banReason}</p>
                            ${customer.suspendedAt ? `<p><strong>Suspended On:</strong> ${Utils.formatDate(customer.suspendedAt)}</p>` : ''}
                            ${customer.suspendedBy ? `<p><strong>Suspended By:</strong> ${customer.suspendedBy}</p>` : ''}
                            ${customer.suspensionEnd ? `<p><strong>Suspension Ends:</strong> ${Utils.formatDate(customer.suspensionEnd)}</p>` : ''}
                        </div>
                        ` : ''}
                    `;
                    
                    // Setup action buttons
                    if (customer.status === 'active') {
                        document.getElementById('suspendCustomerBtn').style.display = 'inline-flex';
                        document.getElementById('banCustomerBtn').style.display = 'inline-flex';
                        document.getElementById('activateCustomerBtn').style.display = 'none';
                    } else {
                        document.getElementById('suspendCustomerBtn').style.display = 'none';
                        document.getElementById('banCustomerBtn').style.display = 'none';
                        document.getElementById('activateCustomerBtn').style.display = 'inline-flex';
                    }
                    
                    document.getElementById('suspendCustomerBtn').onclick = () => showBanModal('customer', customerId);
                    document.getElementById('banCustomerBtn').onclick = () => showBanModal('customer', customerId, true);
                    document.getElementById('activateCustomerBtn').onclick = () => activateCustomer(customerId);
                    
                    openModal('customerDetailsModal');
                } else {
                    Utils.showToast('Error', 'Failed to load customer details', 'error');
                }
            } catch (error) {
                console.error('Error viewing customer:', error);
                Utils.showToast('Error', 'Failed to load customer', 'error');
            }
        }
        
        async function viewAgent(agentId) {
            try {
                AppState.currentAgentId = agentId;
                const result = await FirebaseService.getAgentDetails(agentId);
                if (result.success) {
                    const agent = result.data;
                    const container = document.getElementById('agentDetailsContent');
                    
                    container.innerHTML = `
                        <div class="application-details-grid">
                            <div class="detail-card">
                                <h4>Agent ID</h4>
                                <p><code>${agent.agentId || agentId}</code></p>
                            </div>
                            <div class="detail-card">
                                <h4>Full Name</h4>
                                <p>${agent.fullName || 'N/A'}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Email</h4>
                                <p>${agent.email || 'N/A'}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Phone</h4>
                                <p>${Utils.formatPhoneNumber(agent.phone)}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Status</h4>
                                <p>${Utils.getStatusBadge(agent.status || 'active')}</p>
                            </div>
                            <div class="detail-card">
                                <h4>Joined</h4>
                                <p>${Utils.formatDate(agent.createdAt)}</p>
                            </div>
                        </div>
                        
                        <div class="loan-details">
                            <div class="loan-item">
                                <div class="loan-label">Total Clients</div>
                                <div class="loan-value">${agent.performance?.clients || agent.totalClients || 0}</div>
                            </div>
                            <div class="loan-item">
                                <div class="loan-label">Success Rate</div>
                                <div class="loan-value">${Utils.formatPercentage(agent.performance?.successRate || 0)}</div>
                            </div>
                            <div class="loan-item">
                                <div class="loan-label">Commission Earned</div>
                                <div class="loan-value">${Utils.formatCurrency(agent.commissionEarned || 0)}</div>
                            </div>
                            <div class="loan-item">
                                <div class="loan-label">Total Loans</div>
                                <div class="loan-value">${agent.performance?.loans || agent.totalLoans || 0}</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4>Performance Metrics</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 12px;">
                                <div style="background: #f8f9fa; padding: 16px; border-radius: 8px;">
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Completion Rate</div>
                                    <div style="font-size: 24px; font-weight: 600;">${Utils.formatPercentage(agent.performance?.completionRate || 0)}</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 16px; border-radius: 8px;">
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Avg Processing Time</div>
                                    <div style="font-size: 24px; font-weight: 600;">${agent.performance?.avgProcessingTime || 0}h</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 16px; border-radius: 8px;">
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Rating</div>
                                    <div style="font-size: 24px; font-weight: 600;">${agent.performance?.rating || 0}/5</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 16px; border-radius: 8px;">
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">Reviews</div>
                                    <div style="font-size: 24px; font-weight: 600;">${agent.performance?.reviews || 0}</div>
                                </div>
                            </div>
                        </div>
                        
                        ${agent.residence ? `
                        <div style="margin-top: 20px;">
                            <h4>Residence</h4>
                            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 8px;">
                                <p>${agent.residence}</p>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${agent.nrc ? `
                        <div style="margin-top: 20px;">
                            <h4>Identification</h4>
                            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 8px;">
                                <p><strong>NRC:</strong> ${agent.nrc}</p>
                                ${agent.applicationId ? `<p><strong>Application ID:</strong> ${agent.applicationId}</p>` : ''}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${agent.lastLogin ? `
                        <div style="margin-top: 20px;">
                            <h4>Last Activity</h4>
                            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 8px;">
                                <p><strong>Last Login:</strong> ${Utils.formatDate(agent.lastLogin)}</p>
                                ${agent.lastActivity ? `<p><strong>Last Activity:</strong> ${Utils.formatDate(agent.lastActivity)}</p>` : ''}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${agent.suspensionReason || agent.banReason ? `
                        <div style="margin-top: 20px; background: #fff3cd; padding: 16px; border-radius: 8px; border: 1px solid #ffc107;">
                            <h4 style="color: #856404;">Account Restriction</h4>
                            <p><strong>Reason:</strong> ${agent.suspensionReason || agent.banReason}</p>
                            ${agent.suspendedAt ? `<p><strong>Suspended On:</strong> ${Utils.formatDate(agent.suspendedAt)}</p>` : ''}
                            ${agent.suspendedBy ? `<p><strong>Suspended By:</strong> ${agent.suspendedBy}</p>` : ''}
                            ${agent.suspensionEnd ? `<p><strong>Suspension Ends:</strong> ${Utils.formatDate(agent.suspensionEnd)}</p>` : ''}
                        </div>
                        ` : ''}
                    `;
                    
                    // Setup action buttons
                    if (agent.status === 'active') {
                        document.getElementById('suspendAgentBtn').style.display = 'inline-flex';
                        document.getElementById('banAgentBtn').style.display = 'inline-flex';
                        document.getElementById('activateAgentBtn').style.display = 'none';
                    } else {
                        document.getElementById('suspendAgentBtn').style.display = 'none';
                        document.getElementById('banAgentBtn').style.display = 'none';
                        document.getElementById('activateAgentBtn').style.display = 'inline-flex';
                    }
                    
                    document.getElementById('suspendAgentBtn').onclick = () => showBanModal('agent', agentId);
                    document.getElementById('banAgentBtn').onclick = () => showBanModal('agent', agentId, true);
                    document.getElementById('activateAgentBtn').onclick = () => activateAgent(agentId);
                    
                    openModal('agentDetailsModal');
                } else {
                    Utils.showToast('Error', 'Failed to load agent details', 'error');
                }
            } catch (error) {
                console.error('Error viewing agent:', error);
                Utils.showToast('Error', 'Failed to load agent', 'error');
            }
        }
        
        function showBanModal(type, id, isBan = false) {
            AppState.currentUserId = type === 'customer' ? id : null;
            AppState.currentAgentId = type === 'agent' ? id : null;
            
            const user = type === 'customer' 
                ? AppState.customers.find(c => c.id === id) || AppState.bannedCustomers.find(c => c.id === id)
                : AppState.agents.find(a => a.id === id) || AppState.bannedAgents.find(a => a.id === id);
            
            if (!user) {
                Utils.showToast('Error', 'User not found', 'error');
                return;
            }
            
            // Update modal title
            document.getElementById('banModalTitle').textContent = isBan ? 'Ban User' : 'Suspend User';
            
            // Update user info
            document.getElementById('banUserInfo').innerHTML = `
                <p><strong>Name:</strong> ${user.fullName || 'N/A'}</p>
                <p><strong>${type === 'agent' ? 'Agent ID' : 'Customer ID'}:</strong> ${type === 'agent' ? (user.agentId || id) : id}</p>
                <p><strong>Email:</strong> ${user.email || 'N/A'}</p>
                <p><strong>Phone:</strong> ${Utils.formatPhoneNumber(user.phone)}</p>
            `;
            
            // Set default action type
            document.getElementById('banActionType').value = isBan ? 'ban' : 'suspend';
            
            // Clear previous inputs
            document.getElementById('banReason').value = '';
            document.getElementById('banNotes').value = '';
            
            // Setup confirm button
            document.getElementById('confirmBanBtn').onclick = () => confirmBanAction(type, id);
            
            openModal('banModal');
        }
        
        async function confirmBanAction(type, id) {
            const actionType = document.getElementById('banActionType').value;
            const duration = document.getElementById('banDuration').value;
            const reason = document.getElementById('banReason').value;
            const notes = document.getElementById('banNotes').value;
            const notifyUser = document.getElementById('notifyUser').checked;
            
            if (!reason.trim()) {
                Utils.showToast('Error', 'Please provide a reason for this action', 'error');
                return;
            }
            
            try {
                Utils.showToast('Processing', 'Processing request...', 'info');
                
                let result;
                if (type === 'agent') {
                    if (actionType === 'ban') {
                        result = await FirebaseService.banAgent(id, reason);
                    } else {
                        result = await FirebaseService.suspendAgent(id, reason, duration);
                    }
                } else {
                    if (actionType === 'ban') {
                        result = await FirebaseService.banCustomer(id, reason);
                    } else {
                        result = await FirebaseService.suspendCustomer(id, reason, duration);
                    }
                }
                
                if (result.success) {
                    Utils.showToast('Success', `${type} ${actionType === 'ban' ? 'banned' : 'suspended'} successfully`, 'success');
                    closeModal('banModal');
                    closeModal(type === 'agent' ? 'agentDetailsModal' : 'customerDetailsModal');
                } else {
                    Utils.showToast('Error', result.error || `Failed to ${actionType} ${type}`, 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || `Failed to ${actionType} ${type}`, 'error');
            }
        }
        
        async function activateCustomer(customerId) {
            try {
                Utils.showToast('Processing', 'Activating customer...', 'info');
                const result = await FirebaseService.activateCustomer(customerId);
                if (result.success) {
                    Utils.showToast('Success', 'Customer activated successfully', 'success');
                    closeModal('customerDetailsModal');
                } else {
                    Utils.showToast('Error', result.error || 'Failed to activate customer', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to activate customer', 'error');
            }
        }
        
        async function activateAgent(agentId) {
            try {
                Utils.showToast('Processing', 'Activating agent...', 'info');
                const result = await FirebaseService.activateAgent(agentId);
                if (result.success) {
                    Utils.showToast('Success', 'Agent activated successfully', 'success');
                    closeModal('agentDetailsModal');
                } else {
                    Utils.showToast('Error', result.error || 'Failed to activate agent', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to activate agent', 'error');
            }
        }
        
        async function viewDispute(disputeId) {
            try {
                const dispute = AppState.disputes.find(d => d.id === disputeId);
                if (!dispute) {
                    Utils.showToast('Error', 'Dispute not found', 'error');
                    return;
                }
                
                const container = document.getElementById('disputeDetailsContent');
                container.innerHTML = `
                    <div class="application-details-grid">
                        <div class="detail-card">
                            <h4>Case ID</h4>
                            <p><code>${dispute.id}</code></p>
                        </div>
                        <div class="detail-card">
                            <h4>Type</h4>
                            <p>${dispute.type || 'N/A'}</p>
                        </div>
                        <div class="detail-card">
                            <h4>Status</h4>
                            <p>${Utils.getStatusBadge(dispute.status)}</p>
                        </div>
                        <div class="detail-card">
                            <h4>Severity</h4>
                            <p><span class="status-badge status-${Utils.getStatusColor(dispute.severity)}">${dispute.severity || 'medium'}</span></p>
                        </div>
                        <div class="detail-card">
                            <h4>Amount</h4>
                            <p><strong>${Utils.formatCurrency(dispute.amount)}</strong></p>
                        </div>
                        <div class="detail-card">
                            <h4>Opened</h4>
                            <p>${Utils.formatDate(dispute.openedAt)}</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4>Parties Involved</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 12px;">
                            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px;">
                                <h5 style="margin-bottom: 8px;">Customer</h5>
                                <p><strong>Name:</strong> ${dispute.customerName || dispute.customer || 'N/A'}</p>
                                ${dispute.customerEmail ? `<p><strong>Email:</strong> ${dispute.customerEmail}</p>` : ''}
                                ${dispute.customerPhone ? `<p><strong>Phone:</strong> ${Utils.formatPhoneNumber(dispute.customerPhone)}</p>` : ''}
                            </div>
                            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px;">
                                <h5 style="margin-bottom: 8px;">Agent</h5>
                                <p><strong>Name:</strong> ${dispute.agentName || dispute.agent || 'N/A'}</p>
                                ${dispute.agentEmail ? `<p><strong>Email:</strong> ${dispute.agentEmail}</p>` : ''}
                                ${dispute.agentPhone ? `<p><strong>Phone:</strong> ${Utils.formatPhoneNumber(dispute.agentPhone)}</p>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    ${dispute.description ? `
                    <div style="margin-top: 20px;">
                        <h4>Description</h4>
                        <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 8px;">
                            <p>${dispute.description}</p>
                        </div>
                    </div>
                    ` : ''}
                    
                    ${dispute.evidence ? `
                    <div style="margin-top: 20px;">
                        <h4>Evidence</h4>
                        <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 8px;">
                            <p>${dispute.evidence}</p>
                        </div>
                    </div>
                    ` : ''}
                    
                    ${dispute.notes ? `
                    <div style="margin-top: 20px;">
                        <h4>Admin Notes</h4>
                        <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 8px;">
                            <p>${dispute.notes}</p>
                        </div>
                    </div>
                    ` : ''}
                `;
                
                // Setup resolve button
                document.getElementById('resolveDisputeBtn').onclick = () => resolveDisputePrompt(dispute.id);
                
                openModal('disputeDetailsModal');
            } catch (error) {
                console.error('Error viewing dispute:', error);
                Utils.showToast('Error', 'Failed to load dispute details', 'error');
            }
        }
        
        async function resolveDisputePrompt(disputeId) {
            const resolution = prompt('Please enter the resolution for this dispute:');
            if (resolution && resolution.trim()) {
                const notes = prompt('Add any additional notes:') || '';
                try {
                    Utils.showToast('Processing', 'Resolving dispute...', 'info');
                    const result = await FirebaseService.resolveDispute(disputeId, resolution, notes);
                    if (result.success) {
                        Utils.showToast('Success', 'Dispute resolved successfully', 'success');
                        closeModal('disputeDetailsModal');
                    } else {
                        Utils.showToast('Error', result.error || 'Failed to resolve dispute', 'error');
                    }
                } catch (error) {
                    Utils.showToast('Error', error.message || 'Failed to resolve dispute', 'error');
                }
            }
        }
        
        async function markNotificationRead(notificationId) {
            try {
                const result = await FirebaseService.markNotificationRead(notificationId);
                if (result.success) {
                    // Notification UI will update automatically via real-time listener
                }
            } catch (error) {
                console.error('Error marking notification read:', error);
            }
        }
        
        // ===== Navigation Functions =====
        function switchSection(sectionId) {
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.section === sectionId) {
                    link.classList.add('active');
                }
            });
            
            // Update active content section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
                if (section.id === sectionId) {
                    section.classList.add('active');
                }
            });
            
            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) {
                const activeLink = document.querySelector(`.nav-link[data-section="${sectionId}"] span`);
                pageTitle.textContent = activeLink ? activeLink.textContent : 'Dashboard';
            }
            
            // Update AppState
            AppState.currentView = sectionId;
            
            // Initialize charts if needed
            if (sectionId === 'overview' || sectionId === 'analytics') {
                setTimeout(initializeCharts, 100);
            }
            
            if (sectionId === 'performance') {
                setTimeout(initializePerformanceCharts, 100);
            }
            
            // Close sidebar on mobile
            if (window.innerWidth < 992) {
                document.querySelector('.sidebar').classList.remove('active');
            }
        }
        
        // ===== Tab Functions =====
        function initializeTabs() {
            document.querySelectorAll('.tabs').forEach(tabContainer => {
                const tabs = tabContainer.querySelectorAll('.tab');
                const tabContents = tabContainer.parentElement.querySelectorAll('.tab-content');
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabId = tab.dataset.tab;
                        
                        // Update active tab
                        tabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        
                        // Show corresponding content
                        tabContents.forEach(content => {
                            content.style.display = content.id === tabId ? 'block' : 'none';
                        });
                    });
                });
            });
        }
        
        // ===== Filter Functions =====
        function applyAppFilters() {
            AppState.filters.applications = {
                status: document.getElementById('filterAppStatus').value,
                dateFrom: document.getElementById('filterAppDateFrom').value,
                dateTo: document.getElementById('filterAppDateTo').value,
                sort: document.getElementById('filterAppSort').value
            };
            
            updateApplicationsUI();
            toggleFilter('appFilterPanel');
        }
        
        function resetAppFilters() {
            document.getElementById('filterAppStatus').value = '';
            document.getElementById('filterAppDateFrom').value = '';
            document.getElementById('filterAppDateTo').value = '';
            document.getElementById('filterAppSort').value = 'newest';
            
            AppState.filters.applications = {};
            updateApplicationsUI();
        }
        
        function applyAgentFilters() {
            AppState.filters.agents = {
                status: document.getElementById('filterAgentStatus').value,
                performance: document.getElementById('filterAgentPerformance').value,
                dateFrom: document.getElementById('filterAgentDateFrom').value,
                dateTo: document.getElementById('filterAgentDateTo').value
            };
            
            updateAgentsUI();
            toggleFilter('agentFilterPanel');
        }
        
        function resetAgentFilters() {
            document.getElementById('filterAgentStatus').value = '';
            document.getElementById('filterAgentPerformance').value = '';
            document.getElementById('filterAgentDateFrom').value = '';
            document.getElementById('filterAgentDateTo').value = '';
            
            AppState.filters.agents = {};
            updateAgentsUI();
        }
        
        function applyCustomerFilters() {
            AppState.filters.customers = {
                status: document.getElementById('filterCustomerStatus').value,
                balance: document.getElementById('filterCustomerBalance').value,
                dateFrom: document.getElementById('filterCustomerDateFrom').value,
                dateTo: document.getElementById('filterCustomerDateTo').value
            };
            
            updateCustomersUI();
            toggleFilter('customerFilterPanel');
        }
        
        function resetCustomerFilters() {
            document.getElementById('filterCustomerStatus').value = '';
            document.getElementById('filterCustomerBalance').value = '';
            document.getElementById('filterCustomerDateFrom').value = '';
            document.getElementById('filterCustomerDateTo').value = '';
            
            AppState.filters.customers = {};
            updateCustomersUI();
        }
        
        function applyTransactionFilters() {
            AppState.filters.transactions = {
                status: document.getElementById('filterTransactionStatus').value,
                type: document.getElementById('filterTransactionType').value,
                minAmount: document.getElementById('filterTransactionMin').value,
                maxAmount: document.getElementById('filterTransactionMax').value,
                dateFrom: document.getElementById('filterTransactionDateFrom').value,
                dateTo: document.getElementById('filterTransactionDateTo').value
            };
            
            updateTransactionsUI();
            toggleFilter('transactionFilterPanel');
        }
        
        function resetTransactionFilters() {
            document.getElementById('filterTransactionStatus').value = '';
            document.getElementById('filterTransactionType').value = '';
            document.getElementById('filterTransactionMin').value = '';
            document.getElementById('filterTransactionMax').value = '';
            document.getElementById('filterTransactionDateFrom').value = '';
            document.getElementById('filterTransactionDateTo').value = '';
            
            AppState.filters.transactions = {};
            updateTransactionsUI();
        }
        
        function applyDisputeFilters() {
            AppState.filters.disputes = {
                status: document.getElementById('filterDisputeStatus').value,
                type: document.getElementById('filterDisputeType').value,
                severity: document.getElementById('filterDisputeSeverity').value,
                dateFrom: document.getElementById('filterDisputeDateFrom').value,
                dateTo: document.getElementById('filterDisputeDateTo').value
            };
            
            updateDisputesUI();
            toggleFilter('disputeFilterPanel');
        }
        
        function resetDisputeFilters() {
            document.getElementById('filterDisputeStatus').value = '';
            document.getElementById('filterDisputeType').value = '';
            document.getElementById('filterDisputeSeverity').value = '';
            document.getElementById('filterDisputeDateFrom').value = '';
            document.getElementById('filterDisputeDateTo').value = '';
            
            AppState.filters.disputes = {};
            updateDisputesUI();
        }
        
        function applyAuditFilters() {
            AppState.filters.audit = {
                action: document.getElementById('filterAuditAction').value,
                userType: document.getElementById('filterAuditUserType').value,
                dateFrom: document.getElementById('filterAuditDateFrom').value,
                dateTo: document.getElementById('filterAuditDateTo').value,
                search: document.getElementById('filterAuditSearch').value
            };
            
            updateAuditLogsUI();
            toggleFilter('auditFilterPanel');
        }
        
        function resetAuditFilters() {
            document.getElementById('filterAuditAction').value = '';
            document.getElementById('filterAuditUserType').value = '';
            document.getElementById('filterAuditDateFrom').value = '';
            document.getElementById('filterAuditDateTo').value = '';
            document.getElementById('filterAuditSearch').value = '';
            
            AppState.filters.audit = {};
            updateAuditLogsUI();
        }
        
        // ===== Search Functions =====
        function setupSearch() {
            // Application search
            const appSearch = document.getElementById('appSearch');
            if (appSearch) {
                appSearch.addEventListener('input', Utils.debounce((e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#applicationsBody tr');
                    
                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(searchTerm) ? '' : 'none';
                    });
                }, 300));
            }
            
            // Agent search
            const agentSearch = document.getElementById('agentSearch');
            if (agentSearch) {
                agentSearch.addEventListener('input', Utils.debounce((e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#agentsBody tr');
                    
                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(searchTerm) ? '' : 'none';
                    });
                }, 300));
            }
            
            // Customer search
            const customerSearch = document.getElementById('customerSearch');
            if (customerSearch) {
                customerSearch.addEventListener('input', Utils.debounce((e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#customersBody tr');
                    
                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(searchTerm) ? '' : 'none';
                    });
                }, 300));
            }
            
            // Transaction search
            const transactionSearch = document.getElementById('transactionSearch');
            if (transactionSearch) {
                transactionSearch.addEventListener('input', Utils.debounce((e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#transactionsBody tr');
                    
                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(searchTerm) ? '' : 'none';
                    });
                }, 300));
            }
            
            // Dispute search
            const disputeSearch = document.getElementById('disputeSearch');
            if (disputeSearch) {
                disputeSearch.addEventListener('input', Utils.debounce((e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#disputesBody tr');
                    
                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(searchTerm) ? '' : 'none';
                    });
                }, 300));
            }
            
            // Audit search
            const auditSearch = document.getElementById('auditSearch');
            if (auditSearch) {
                auditSearch.addEventListener('input', Utils.debounce((e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#auditBody tr');
                    
                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(searchTerm) ? '' : 'none';
                    });
                }, 300));
            }
        }
        
        // ===== Settings Functions =====
        async function loadSettings() {
            try {
                const result = await FirebaseService.loadSettings();
                if (result.success) {
                    const settings = result.settings;
                    
                    // General settings
                    document.getElementById('systemName').value = settings.general?.systemName || '';
                    document.getElementById('supportEmail').value = settings.general?.supportEmail || '';
                    document.getElementById('supportPhone').value = settings.general?.supportPhone || '';
                    document.getElementById('systemTimezone').value = settings.general?.timezone || 'UTC';
                    
                    // Transaction settings
                    document.getElementById('minTransaction').value = settings.transactions?.minAmount || '';
                    document.getElementById('maxTransaction').value = settings.transactions?.maxAmount || '';
                    document.getElementById('dailyTransactionLimit').value = settings.transactions?.dailyLimit || '';
                    document.getElementById('monthlyTransactionLimit').value = settings.transactions?.monthlyLimit || '';
                    document.getElementById('transactionFee').value = settings.transactions?.transactionFee || '';
                    
                    // Commission settings
                    document.getElementById('standardCommission').value = settings.commissions?.standard || '';
                    document.getElementById('premiumCommission').value = settings.commissions?.premium || '';
                    document.getElementById('referralCommission').value = settings.commissions?.referral || '';
                    document.getElementById('commissionCycle').value = settings.commissions?.cycle || 'monthly';
                    
                    // Penalty settings
                    document.getElementById('latePenalty').value = settings.penalties?.latePayment || '';
                    document.getElementById('gracePeriod').value = settings.penalties?.gracePeriod || '';
                    document.getElementById('overdraftLimit').value = settings.penalties?.overdraftLimit || '';
                    
                    // Loan settings
                    document.getElementById('minLoanAmount').value = settings.loans?.minAmount || '';
                    document.getElementById('maxLoanAmount').value = settings.loans?.maxAmount || '';
                    document.getElementById('loanInterestRate').value = settings.loans?.interestRate || '';
                    document.getElementById('loanTerm').value = settings.loans?.term || '';
                    
                    // Security settings
                    document.getElementById('enable2FA').checked = settings.security?.enable2FA || false;
                    document.getElementById('sessionTimeout').value = settings.security?.sessionTimeout || '';
                    document.getElementById('maxLoginAttempts').value = settings.security?.maxLoginAttempts || '';
                    document.getElementById('requireStrongPassword').checked = settings.security?.requireStrongPassword || false;
                    document.getElementById('passwordExpiry').checked = settings.security?.passwordExpiry || false;
                    
                    // Notification settings
                    document.getElementById('emailNotifications').checked = settings.notifications?.email || false;
                    document.getElementById('smsNotifications').checked = settings.notifications?.sms || false;
                    document.getElementById('pushNotifications').checked = settings.notifications?.push || false;
                    document.getElementById('alertHighTransactions').checked = settings.notifications?.alertHighTransactions || false;
                    document.getElementById('alertSuspiciousActivity').checked = settings.notifications?.alertSuspiciousActivity || false;
                    document.getElementById('alertSystemErrors').checked = settings.notifications?.alertSystemErrors || false;
                    document.getElementById('transactionThreshold').value = settings.notifications?.transactionThreshold || '';
                    document.getElementById('loginAttemptThreshold').value = settings.notifications?.loginAttemptThreshold || '';
                    
                    // Maintenance settings
                    document.getElementById('maintenanceMode').checked = settings.maintenance?.enabled || false;
                    document.getElementById('maintenanceMessage').value = settings.maintenance?.message || '';
                    document.getElementById('dataRetention').value = settings.maintenance?.dataRetention || '';
                    document.getElementById('autoBackup').checked = settings.maintenance?.autoBackup || false;
                    document.getElementById('backupFrequency').value = settings.maintenance?.backupFrequency || 'daily';
                    document.getElementById('backupTime').value = settings.maintenance?.backupTime || '02:00';
                    
                    // API settings
                    document.getElementById('apiBaseUrl').value = settings.api?.baseUrl || '';
                    document.getElementById('apiVersion').value = settings.api?.version || '';
                    document.getElementById('apiRateLimit').value = settings.api?.rateLimit || '';
                    document.getElementById('apiKeyExpiry').value = settings.api?.keyExpiry || '';
                    
                    Utils.showToast('Settings Loaded', 'System settings loaded successfully', 'success');
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                Utils.showToast('Error', 'Failed to load settings', 'error');
            }
        }
        
        async function saveSettings() {
            try {
                const settings = {
                    general: {
                        systemName: document.getElementById('systemName').value,
                        supportEmail: document.getElementById('supportEmail').value,
                        supportPhone: document.getElementById('supportPhone').value,
                        timezone: document.getElementById('systemTimezone').value,
                        currency: 'USD',
                        language: 'en'
                    },
                    transactions: {
                        minAmount: parseFloat(document.getElementById('minTransaction').value) || 10,
                        maxAmount: parseFloat(document.getElementById('maxTransaction').value) || 10000,
                        dailyLimit: parseFloat(document.getElementById('dailyTransactionLimit').value) || 5000,
                        monthlyLimit: parseFloat(document.getElementById('monthlyTransactionLimit').value) || 50000,
                        transactionFee: parseFloat(document.getElementById('transactionFee').value) || 1.5,
                        processingFee: 0.5
                    },
                    commissions: {
                        standard: parseFloat(document.getElementById('standardCommission').value) || 5,
                        premium: parseFloat(document.getElementById('premiumCommission').value) || 7,
                        referral: parseFloat(document.getElementById('referralCommission').value) || 10,
                        cycle: document.getElementById('commissionCycle').value || 'monthly'
                    },
                    penalties: {
                        latePayment: parseFloat(document.getElementById('latePenalty').value) || 2,
                        gracePeriod: parseInt(document.getElementById('gracePeriod').value) || 7,
                        overdraftLimit: parseFloat(document.getElementById('overdraftLimit').value) || 100
                    },
                    loans: {
                        minAmount: parseFloat(document.getElementById('minLoanAmount').value) || 100,
                        maxAmount: parseFloat(document.getElementById('maxLoanAmount').value) || 5000,
                        interestRate: parseFloat(document.getElementById('loanInterestRate').value) || 10,
                        term: parseInt(document.getElementById('loanTerm').value) || 30
                    },
                    security: {
                        enable2FA: document.getElementById('enable2FA').checked,
                        sessionTimeout: parseInt(document.getElementById('sessionTimeout').value) || 30,
                        maxLoginAttempts: parseInt(document.getElementById('maxLoginAttempts').value) || 5,
                        requireStrongPassword: document.getElementById('requireStrongPassword').checked,
                        passwordExpiry: document.getElementById('passwordExpiry').checked ? 90 : null
                    },
                    notifications: {
                        email: document.getElementById('emailNotifications').checked,
                        sms: document.getElementById('smsNotifications').checked,
                        push: document.getElementById('pushNotifications').checked,
                        alertHighTransactions: document.getElementById('alertHighTransactions').checked,
                        alertSuspiciousActivity: document.getElementById('alertSuspiciousActivity').checked,
                        alertSystemErrors: document.getElementById('alertSystemErrors').checked,
                        transactionThreshold: parseFloat(document.getElementById('transactionThreshold').value) || 1000,
                        loginAttemptThreshold: parseInt(document.getElementById('loginAttemptThreshold').value) || 3
                    },
                    maintenance: {
                        enabled: document.getElementById('maintenanceMode').checked,
                        message: document.getElementById('maintenanceMessage').value || '',
                        dataRetention: parseInt(document.getElementById('dataRetention').value) || 365,
                        autoBackup: document.getElementById('autoBackup').checked,
                        backupFrequency: document.getElementById('backupFrequency').value || 'daily',
                        backupTime: document.getElementById('backupTime').value || '02:00'
                    },
                    api: {
                        baseUrl: document.getElementById('apiBaseUrl').value || '',
                        version: document.getElementById('apiVersion').value || 'v1',
                        rateLimit: parseInt(document.getElementById('apiRateLimit').value) || 60,
                        keyExpiry: parseInt(document.getElementById('apiKeyExpiry').value) || 90
                    }
                };
                
                const result = await FirebaseService.saveSettings(settings);
                if (result.success) {
                    Utils.showToast('Success', 'Settings saved successfully', 'success');
                } else {
                    Utils.showToast('Error', result.error || 'Failed to save settings', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to save settings', 'error');
            }
        }
        
        function generateAPIKey() {
            const apiKey = Utils.generateId('APIKEY');
            document.getElementById('apiKeyDisplay').value = apiKey;
            Utils.showToast('API Key Generated', 'New API key generated successfully', 'success');
        }
        
        // ===== Admin Management Functions =====
        async function updateAdminCredentials() {
            const email = document.getElementById('newAdminEmail').value;
            const password = document.getElementById('newAdminPassword').value;
            const confirmPassword = document.getElementById('confirmAdminPassword').value;
            
            if (email && !Utils.validateEmail(email)) {
                Utils.showToast('Error', 'Please enter a valid email address', 'error');
                return;
            }
            
            if (password && password !== confirmPassword) {
                Utils.showToast('Error', 'Passwords do not match', 'error');
                return;
            }
            
            if (password && !Utils.validatePassword(password)) {
                Utils.showToast('Error', 'Password must be at least 8 characters long', 'error');
                return;
            }
            
            try {
                Utils.showToast('Processing', 'Updating credentials...', 'info');
                const result = await FirebaseService.updateAdminCredentials(email || null, password || null);
                
                if (result.success) {
                    Utils.showToast('Success', 'Admin credentials updated successfully', 'success');
                    
                    // Clear form
                    document.getElementById('newAdminEmail').value = '';
                    document.getElementById('newAdminPassword').value = '';
                    document.getElementById('confirmAdminPassword').value = '';
                    
                    // Update current email display
                    document.getElementById('currentAdminEmail').value = email || AppState.currentUser.email;
                } else {
                    Utils.showToast('Error', result.error || 'Failed to update credentials', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to update credentials', 'error');
            }
        }
        
        async function createNewAdmin() {
            const name = document.getElementById('newAdminName').value;
            const email = document.getElementById('newAdminEmailCreate').value;
            const password = document.getElementById('newAdminPasswordCreate').value;
            const confirmPassword = document.getElementById('newAdminPasswordConfirm').value;
            const role = document.getElementById('newAdminRole').value;
            
            // Validate inputs
            if (!name || name.trim().length < 2) {
                Utils.showToast('Error', 'Name must be at least 2 characters long', 'error');
                return;
            }
            
            if (!Utils.validateEmail(email)) {
                Utils.showToast('Error', 'Please enter a valid email address', 'error');
                return;
            }
            
            if (!Utils.validatePassword(password)) {
                Utils.showToast('Error', 'Password must be at least 8 characters long', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                Utils.showToast('Error', 'Passwords do not match', 'error');
                return;
            }
            
            try {
                Utils.showToast('Processing', 'Creating new admin account...', 'info');
                const result = await FirebaseService.createNewAdmin(email, password, name, role);
                
                if (result.success) {
                    Utils.showToast('Success', 'New admin account created successfully', 'success');
                    
                    // Clear form
                    document.getElementById('newAdminName').value = '';
                    document.getElementById('newAdminEmailCreate').value = '';
                    document.getElementById('newAdminPasswordCreate').value = '';
                    document.getElementById('newAdminPasswordConfirm').value = '';
                    document.getElementById('newAdminRole').value = 'admin';
                    
                    // Show credentials
                    const message = `Admin Account Created Successfully!\n\n` +
                                   `Name: ${name}\n` +
                                   `Email: ${email}\n` +
                                   `Password: ${password}\n` +
                                   `Role: ${role}\n\n` +
                                   `Please save these credentials securely.`;
                    
                    if (confirm(message + '\n\nCopy credentials to clipboard?')) {
                        Utils.copyToClipboard(`Name: ${name}\nEmail: ${email}\nPassword: ${password}\nRole: ${role}`);
                    }
                } else {
                    Utils.showToast('Error', result.error || 'Failed to create admin account', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to create admin account', 'error');
            }
        }
        
        // ===== Export Functions =====
        async function exportApplications() {
            try {
                const result = await FirebaseService.exportData('applications', AppState.filters.applications);
                if (result.success) {
                    Utils.showToast('Success', 'Applications exported successfully', 'success');
                } else {
                    Utils.showToast('Error', result.error || 'Failed to export applications', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to export applications', 'error');
            }
        }
        
        async function exportAgents() {
            try {
                const result = await FirebaseService.exportData('agents', AppState.filters.agents);
                if (result.success) {
                    Utils.showToast('Success', 'Agents exported successfully', 'success');
                } else {
                    Utils.showToast('Error', result.error || 'Failed to export agents', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to export agents', 'error');
            }
        }
        
        async function exportCustomers() {
            try {
                const result = await FirebaseService.exportData('customers', AppState.filters.customers);
                if (result.success) {
                    Utils.showToast('Success', 'Customers exported successfully', 'success');
                } else {
                    Utils.showToast('Error', result.error || 'Failed to export customers', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to export customers', 'error');
            }
        }
        
        async function exportTransactions() {
            try {
                const result = await FirebaseService.exportData('transactions', AppState.filters.transactions);
                if (result.success) {
                    Utils.showToast('Success', 'Transactions exported successfully', 'success');
                } else {
                    Utils.showToast('Error', result.error || 'Failed to export transactions', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to export transactions', 'error');
            }
        }
        
        async function exportDisputes() {
            try {
                const result = await FirebaseService.exportData('disputes', AppState.filters.disputes);
                if (result.success) {
                    Utils.showToast('Success', 'Disputes exported successfully', 'success');
                } else {
                    Utils.showToast('Error', result.error || 'Failed to export disputes', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to export disputes', 'error');
            }
        }
        
        async function exportAuditLogs() {
            try {
                const result = await FirebaseService.exportData('audit', AppState.filters.audit);
                if (result.success) {
                    Utils.showToast('Success', 'Audit logs exported successfully', 'success');
                } else {
                    Utils.showToast('Error', result.error || 'Failed to export audit logs', 'error');
                }
            } catch (error) {
                Utils.showToast('Error', error.message || 'Failed to export audit logs', 'error');
            }
        }
        
        // ===== Quick Action Functions =====
        function showQuickAction(action) {
            switch(action) {
                case 'exportData':
                    if (confirm('Export all system data? This may take a moment.')) {
                        // Export all data
                        exportAllData();
                    }
                    break;
                case 'systemCheck':
                    performSystemCheck();
                    break;
                case 'backup':
                    if (confirm('Create a backup of the database?')) {
                        createBackup();
                    }
                    break;
                case 'maintenance':
                    toggleMaintenanceMode();
                    break;
            }
        }
        
        async function exportAllData() {
            try {
                Utils.showToast('Processing', 'Preparing data export...', 'info');
                
                // Create a comprehensive export
                const exportData = {
                    timestamp: Date.now(),
                    exportedBy: AppState.currentUser.email,
                    applications: AppState.applications,
                    agents: AppState.agents,
                    customers: AppState.customers,
                    transactions: AppState.transactions,
                    disputes: AppState.disputes,
                    auditLogs: AppState.auditLogs.slice(0, 1000), // Limit to 1000 logs
                    settings: AppState.settings,
                    stats: AppState.stats
                };
                
                // Create JSON string
                const jsonString = JSON.stringify(exportData, null, 2);
                
                // Create download link
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `trucash_export_${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                Utils.showToast('Success', 'All data exported successfully', 'success');
            } catch (error) {
                Utils.showToast('Error', 'Failed to export data', 'error');
            }
        }
        
        async function performSystemCheck() {
            try {
                Utils.showToast('Processing', 'Performing system check...', 'info');
                
                // Check Firebase connection
                const connectedRef = db.ref('.info/connected');
                const connectionPromise = new Promise((resolve) => {
                    const listener = connectedRef.on('value', (snap) => {
                        resolve(snap.val() === true);
                        connectedRef.off('value', listener);
                    });
                    
                    // Timeout after 5 seconds
                    setTimeout(() => resolve(false), 5000);
                });
                
                const isConnected = await connectionPromise;
                
                // Check database health
                const healthCheck = {
                    firebase: isConnected,
                    applications: AppState.applications.length,
                    agents: AppState.agents.length,
                    customers: AppState.customers.length,
                    transactions: AppState.transactions.length,
                    timestamp: Date.now()
                };
                
                if (isConnected) {
                    Utils.showToast('System Check', 'All systems operational ', 'success');
                } else {
                    Utils.showToast('System Check', 'Firebase connection issue detected', 'warning');
                }
                
                // Log system check
                await FirebaseService.createAuditLog({
                    action: 'SYSTEM_CHECK',
                    targetId: 'system',
                    targetType: 'system',
                    performedBy: AppState.currentUser.uid,
                    performedByEmail: AppState.currentUser.email,
                    details: healthCheck,
                    timestamp: Date.now(),
                    ipAddress: await FirebaseService.getClientIP()
                });
                
            } catch (error) {
                Utils.showToast('System Check', 'Error performing system check', 'error');
            }
        }
        
        async function createBackup() {
            try {
                Utils.showToast('Processing', 'Creating database backup...', 'info');
                
                // This is a simplified backup - in production, you'd want to use Firebase Backup service
                // or export to cloud storage
                const backupData = {
                    timestamp: Date.now(),
                    backupId: Utils.generateId('BACKUP'),
                    createdBy: AppState.currentUser.email,
                    summary: {
                        applications: AppState.applications.length,
                        agents: AppState.agents.length,
                        customers: AppState.customers.length,
                        transactions: AppState.transactions.length
                    }
                };
                
                // Save backup metadata to database
                const backupRef = db.ref('backups/' + backupData.backupId);
                await backupRef.set(backupData);
                
                Utils.showToast('Success', 'Backup created successfully', 'success');
                
                // Log backup creation
                await FirebaseService.createAuditLog({
                    action: 'CREATE_BACKUP',
                    targetId: backupData.backupId,
                    targetType: 'backup',
                    performedBy: AppState.currentUser.uid,
                    performedByEmail: AppState.currentUser.email,
                    details: backupData,
                    timestamp: Date.now(),
                    ipAddress: await FirebaseService.getClientIP()
                });
                
            } catch (error) {
                Utils.showToast('Error', 'Failed to create backup', 'error');
            }
        }
        
        function toggleMaintenanceMode() {
            const maintenanceMode = document.getElementById('maintenanceMode');
            maintenanceMode.checked = !maintenanceMode.checked;
            
            if (maintenanceMode.checked) {
                if (confirm('Enable maintenance mode? This will restrict user access to the system.')) {
                    document.getElementById('maintenanceMessage').focus();
                    Utils.showToast('Maintenance', 'Maintenance mode will be enabled after saving settings', 'warning');
                } else {
                    maintenanceMode.checked = false;
                }
            } else {
                Utils.showToast('Maintenance', 'Maintenance mode will be disabled after saving settings', 'info');
            }
        }
        
        function refreshActivity() {
            updateRecentActivity();
            Utils.showToast('Refreshed', 'Activity list updated', 'success');
        }
        
        // ===== Event Listeners =====
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = link.dataset.section;
                    switchSection(sectionId);
                });
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to logout?')) {
                    FirebaseService.logout();
                }
            });
            
            // Notification bell
            document.getElementById('notificationBell').addEventListener('click', (e) => {
                e.stopPropagation();
                const dropdown = document.getElementById('notificationDropdown');
                dropdown.classList.toggle('active');
            });
            
            // Mark all notifications as read
            document.getElementById('markAllRead')?.addEventListener('click', async () => {
                try {
                    const result = await FirebaseService.markAllNotificationsRead();
                    if (result.success) {
                        Utils.showToast('Success', 'All notifications marked as read', 'success');
                    }
                } catch (error) {
                    Utils.showToast('Error', 'Failed to mark notifications as read', 'error');
                }
            });
            
            // Clear all notifications
            document.getElementById('clearNotifications')?.addEventListener('click', async () => {
                if (confirm('Clear all notifications? This action cannot be undone.')) {
                    try {
                        const result = await FirebaseService.clearAllNotifications();
                        if (result.success) {
                            Utils.showToast('Success', 'All notifications cleared', 'success');
                        }
                    } catch (error) {
                        Utils.showToast('Error', 'Failed to clear notifications', 'error');
                    }
                }
            });
            
            // Mobile menu toggle
            document.getElementById('mobileMenuToggle').addEventListener('click', () => {
                document.querySelector('.sidebar').classList.toggle('active');
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.notification-container')) {
                    document.getElementById('notificationDropdown').classList.remove('active');
                }
            });
            
            // Settings save
            document.getElementById('saveSettings')?.addEventListener('click', saveSettings);
            
            // Settings reset
            document.getElementById('resetSettings')?.addEventListener('click', () => {
                if (confirm('Reset all settings to default values? This will override all current settings.')) {
                    loadSettings();
                }
            });
            
            // Admin credentials update
            document.getElementById('updateAdminCredentials')?.addEventListener('click', updateAdminCredentials);
            
            // New admin creation
            document.getElementById('createNewAdmin')?.addEventListener('click', createNewAdmin);
            
            // Save credentials button
            document.getElementById('saveCredentialsBtn')?.addEventListener('click', saveCredentialsAndApprove);
            
            // Generate random password toggle
            document.getElementById('generateRandomPassword')?.addEventListener('change', function() {
                const passwordField = document.getElementById('manualAgentPassword');
                const confirmField = document.getElementById('manualAgentPasswordConfirm');
                
                if (this.checked) {
                    const randomPassword = Utils.generatePassword();
                    passwordField.value = randomPassword;
                    confirmField.value = randomPassword;
                    passwordField.readOnly = true;
                    confirmField.readOnly = true;
                } else {
                    passwordField.value = '';
                    confirmField.value = '';
                    passwordField.readOnly = false;
                    confirmField.readOnly = false;
                }
            });
            
            // Window resize
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 992) {
                    document.querySelector('.sidebar').classList.remove('active');
                }
            });
            
            // Before unload
            window.addEventListener('beforeunload', () => {
                FirebaseService.cleanupListeners();
            });
            
            // Initialize search functionality
            setupSearch();
            
            // Initialize tabs
            initializeTabs();
            
            // Update current time
            function updateCurrentTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                const timeElement = document.getElementById('currentTime');
                if (timeElement) {
                    timeElement.textContent = timeString;
                }
            }
            
            // Update time every second
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
        }
        
        // ===== Initialize Application =====
        async function initializeApp() {
            try {
                console.log('Initializing admin dashboard...');
                
                // Check authentication
                const isAuthenticated = await FirebaseService.checkAuth();
                if (!isAuthenticated) {
                    console.log('Authentication failed, redirecting to login...');
                    return;
                }
                
                console.log('Admin authenticated successfully');
                
                // Setup event listeners
                setupEventListeners();
                
                // Load settings
                await loadSettings();
                
                // Initialize charts
                setTimeout(() => {
                    initializeCharts();
                    initializePerformanceCharts();
                }, 1000);
                
                // Update recent activity periodically
                setInterval(updateRecentActivity, 30000);
                
                // Show welcome message
                setTimeout(() => {
                    Utils.showToast('Welcome Back', `Hello ${AppState.adminData?.fullName || 'Admin'}!`, 'success');
                }, 1000);
                
                console.log('Admin dashboard initialized successfully');
                
            } catch (error) {
                console.error('Failed to initialize admin dashboard:', error);
                Utils.showToast('Initialization Error', 'Failed to load dashboard. Please refresh.', 'error');
            }
        }
        
        // ===== Start Application =====
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // Make functions available globally
        window.viewApplication = viewApplication;
        window.showCredentialsModal = showCredentialsModal;
        window.saveCredentialsAndApprove = saveCredentialsAndApprove;
        window.rejectApplicationPrompt = rejectApplicationPrompt;
        window.viewTransaction = viewTransaction;
        window.approveTransaction = approveTransaction;
        window.rejectTransactionPrompt = rejectTransactionPrompt;
        window.viewCustomer = viewCustomer;
        window.viewAgent = viewAgent;
        window.showBanModal = showBanModal;
        window.activateCustomer = activateCustomer;
        window.activateAgent = activateAgent;
        window.viewDispute = viewDispute;
        window.resolveDisputePrompt = resolveDisputePrompt;
        window.markNotificationRead = markNotificationRead;
        window.closeModal = closeModal;
        window.openModal = openModal;
        window.toggleFilter = toggleFilter;
        window.applyAppFilters = applyAppFilters;
        window.resetAppFilters = resetAppFilters;
        window.applyAgentFilters = applyAgentFilters;
        window.resetAgentFilters = resetAgentFilters;
        window.applyCustomerFilters = applyCustomerFilters;
        window.resetCustomerFilters = resetCustomerFilters;
        window.applyTransactionFilters = applyTransactionFilters;
        window.resetTransactionFilters = resetTransactionFilters;
        window.applyDisputeFilters = applyDisputeFilters;
        window.resetDisputeFilters = resetDisputeFilters;
        window.applyAuditFilters = applyAuditFilters;
        window.resetAuditFilters = resetAuditFilters;
        window.filterBannedAgents = () => {}; // Placeholder
        window.filterBannedCustomers = () => {}; // Placeholder
        window.exportApplications = exportApplications;
        window.exportAgents = exportAgents;
        window.exportCustomers = exportCustomers;
        window.exportTransactions = exportTransactions;
        window.exportDisputes = exportDisputes;
        window.exportAuditLogs = exportAuditLogs;
        window.showQuickAction = showQuickAction;
        window.refreshActivity = refreshActivity;
        window.generateAPIKey = generateAPIKey;
        
        // Global toast function
        window.showToast = Utils.showToast;
        
    </script>
</body>
</html>
